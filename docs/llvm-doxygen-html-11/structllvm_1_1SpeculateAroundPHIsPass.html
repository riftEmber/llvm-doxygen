<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: llvm::SpeculateAroundPHIsPass Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LLVM<span id="projectnumber">&#160;11.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacellvm.html">llvm</a></li><li class="navelem"><a class="el" href="structllvm_1_1SpeculateAroundPHIsPass.html">SpeculateAroundPHIsPass</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="structllvm_1_1SpeculateAroundPHIsPass-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">llvm::SpeculateAroundPHIsPass Struct Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This pass handles simple speculating of instructions around PHIs when doing so is profitable for a particular target despite duplicated instructions.  
 <a href="#details">More...</a></p>

<p><code>#include &quot;<a class="el" href="SpeculateAroundPHIs_8h_source.html">llvm/Transforms/Scalar/SpeculateAroundPHIs.h</a>&quot;</code></p>
<div class="dynheader">
Inheritance diagram for llvm::SpeculateAroundPHIsPass:</div>
<div class="dyncontent">
<div class="center"><img src="structllvm_1_1SpeculateAroundPHIsPass__inherit__graph.png" border="0" usemap="#allvm_1_1SpeculateAroundPHIsPass_inherit__map" alt="Inheritance graph"/></div>
<map name="allvm_1_1SpeculateAroundPHIsPass_inherit__map" id="allvm_1_1SpeculateAroundPHIsPass_inherit__map">
<area shape="rect" title="This pass handles simple speculating of instructions around PHIs when doing so is profitable for a pa..." alt="" coords="5,199,218,225"/>
<area shape="rect" href="structllvm_1_1PassInfoMixin.html" title=" " alt="" coords="9,109,214,150"/>
<area shape="poly" title=" " alt="" coords="114,165,114,199,109,199,109,165"/>
<area shape="rect" href="structllvm_1_1PassInfoMixin.html" title="A CRTP mix&#45;in to automatically provide informational APIs needed for passes." alt="" coords="43,5,180,46"/>
<area shape="poly" title=" " alt="" coords="114,61,114,109,109,109,109,61"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for llvm::SpeculateAroundPHIsPass:</div>
<div class="dyncontent">
<div class="center"><img src="structllvm_1_1SpeculateAroundPHIsPass__coll__graph.png" border="0" usemap="#allvm_1_1SpeculateAroundPHIsPass_coll__map" alt="Collaboration graph"/></div>
<map name="allvm_1_1SpeculateAroundPHIsPass_coll__map" id="allvm_1_1SpeculateAroundPHIsPass_coll__map">
<area shape="rect" title="This pass handles simple speculating of instructions around PHIs when doing so is profitable for a pa..." alt="" coords="5,199,218,225"/>
<area shape="rect" href="structllvm_1_1PassInfoMixin.html" title=" " alt="" coords="9,109,214,150"/>
<area shape="poly" title=" " alt="" coords="114,165,114,199,109,199,109,165"/>
<area shape="rect" href="structllvm_1_1PassInfoMixin.html" title="A CRTP mix&#45;in to automatically provide informational APIs needed for passes." alt="" coords="43,5,180,46"/>
<area shape="poly" title=" " alt="" coords="114,61,114,109,109,109,109,61"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a66fc2a9602c758a487805ce858d1415c" id="r_a66fc2a9602c758a487805ce858d1415c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a66fc2a9602c758a487805ce858d1415c">run</a> (<a class="el" href="classllvm_1_1Function.html">Function</a> &amp;<a class="el" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="el" href="namespacellvm.html#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM)</td></tr>
<tr class="memdesc:a66fc2a9602c758a487805ce858d1415c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run the pass over the function.  <br /></td></tr>
<tr class="separator:a66fc2a9602c758a487805ce858d1415c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="inherited" name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_static_methods_structllvm_1_1PassInfoMixin"><td colspan="2" onclick="javascript:dynsection.toggleInherit('pub_static_methods_structllvm_1_1PassInfoMixin')"><img src="closed.png" alt="-"/>&#160;Static Public Member Functions inherited from <a class="el" href="structllvm_1_1PassInfoMixin.html">llvm::PassInfoMixin&lt; SpeculateAroundPHIsPass &gt;</a></td></tr>
<tr class="memitem:a630e2eac0694bcbcfed653c6a7f616e3 inherit pub_static_methods_structllvm_1_1PassInfoMixin" id="r_a630e2eac0694bcbcfed653c6a7f616e3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classllvm_1_1ilist__node__impl.html">static</a> <a class="el" href="classllvm_1_1StringRef.html">StringRef</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structllvm_1_1PassInfoMixin.html#a630e2eac0694bcbcfed653c6a7f616e3">name</a> ()</td></tr>
<tr class="memdesc:a630e2eac0694bcbcfed653c6a7f616e3 inherit pub_static_methods_structllvm_1_1PassInfoMixin"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the name of the pass we are mixed into.  <br /></td></tr>
<tr class="separator:a630e2eac0694bcbcfed653c6a7f616e3 inherit pub_static_methods_structllvm_1_1PassInfoMixin"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This pass handles simple speculating of instructions around PHIs when doing so is profitable for a particular target despite duplicated instructions. </p>
<p>The motivating example are PHIs of constants which will require materializing the constants along each edge. If the PHI is used by an instruction where the target can materialize the constant as part of the instruction, it is profitable to speculate those instructions around the PHI node. This can reduce dynamic instruction count as well as decrease register pressure.</p>
<p>Consider this IR for example: </p><div class="fragment"><div class="line"><a class="code hl_variable" href="MustExecute_8cpp.html#ac00fd2bd5d2febf1f9988294a6c56b33">entry</a>:</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">br</a> i1 %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">flag</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">label</a> %a, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">label</a> %b</div>
<div class="line"> </div>
<div class="line">a:</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">br</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">label</a> %exit</div>
<div class="line"> </div>
<div class="line">b:</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">br</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">label</a> %exit</div>
<div class="line"> </div>
<div class="line">exit:</div>
<div class="line">  %p = phi i32 [ 7, %a ], [ 11, %b ]</div>
<div class="line">  %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">sum</a> = add i32 %arg, %p</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ret</a> i32 %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">sum</a></div>
<div class="ttc" id="aMustExecute_8cpp_html_ac00fd2bd5d2febf1f9988294a6c56b33"><div class="ttname"><a href="MustExecute_8cpp.html#ac00fd2bd5d2febf1f9988294a6c56b33">entry</a></div><div class="ttdeci">print Instructions which execute on loop entry</div><div class="ttdef"><b>Definition</b> <a href="MustExecute_8cpp_source.html#l00335">MustExecute.cpp:335</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__impl_html"><div class="ttname"><a href="classllvm_1_1ilist__node__impl.html">llvm::ilist_node_impl</a></div><div class="ttdoc">Implementation for an ilist node.</div><div class="ttdef"><b>Definition</b> <a href="ilist__node_8h_source.html#l00039">ilist_node.h:39</a></div></div>
</div><!-- fragment --><p> To materialize the inputs to this PHI node may require an explicit instruction. For example, on x86 this would turn into something like </p><div class="fragment"><div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">testq</a> %eax, %eax</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">movl</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">$7</a>, %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">rNN</a></div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">jne</a> .L</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">movl</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">$11</a>, %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">rNN</a></div>
<div class="line">.L:</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">addl</a> %edi, %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">rNN</a></div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">movl</a> %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">rNN</a>, %eax</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">retq</a></div>
</div><!-- fragment --><p> When these constants can be folded directly into another instruction, it would be preferable to avoid the potential for register pressure (above we can easily avoid it, but that isn't always true) and simply duplicate the instruction using the PHI: </p><div class="fragment"><div class="line"><a class="code hl_variable" href="MustExecute_8cpp.html#ac00fd2bd5d2febf1f9988294a6c56b33">entry</a>:</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">br</a> i1 %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">flag</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">label</a> %a, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">label</a> %b</div>
<div class="line"> </div>
<div class="line">a:</div>
<div class="line">  %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">sum</a>.1 = add i32 %arg, 7</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">br</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">label</a> %exit</div>
<div class="line"> </div>
<div class="line">b:</div>
<div class="line">  %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">sum</a>.2 = add i32 %arg, 11</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">br</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">label</a> %exit</div>
<div class="line"> </div>
<div class="line">exit:</div>
<div class="line">  %p = phi i32 [ %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">sum</a>.1, %a ], [ %<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">sum</a>.2, %b ]</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ret</a> i32 %p</div>
</div><!-- fragment --><p> Which will generate something like the following on x86: </p><div class="fragment"><div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">testq</a> %eax, %eax</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">addl</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">$7</a>, %edi</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">jne</a> .L</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">addl</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">$11</a>, %edi</div>
<div class="line">.L:</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">movl</a> %edi, %eax</div>
<div class="line">  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">retq</a></div>
</div><!-- fragment --><p>It is important to note that this pass is never intended to handle more complex cases where speculating around PHIs allows simplifications of the IR itself or other subsequent optimizations. Those can and should already be handled before this pass is ever run by a more powerful analysis that can reason about equivalences and common subexpressions. Classically, those cases would be handled by a GVN-powered PRE or similar transform. This pass, in contrast, is <em>only</em> interested in cases where despite no simplifications to the IR itself, speculation is <em>faster</em> to execute. The result of this is that the cost models which are appropriate to consider here are relatively simple ones around execution and codesize cost, without any need to consider simplifications or other transformations. </p>

<p class="definition">Definition at line <a class="el" href="SpeculateAroundPHIs_8h_source.html#l00103">103</a> of file <a class="el" href="SpeculateAroundPHIs_8h_source.html">SpeculateAroundPHIs.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a66fc2a9602c758a487805ce858d1415c" name="a66fc2a9602c758a487805ce858d1415c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66fc2a9602c758a487805ce858d1415c">&#9670;&#160;</a></span>run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a> SpeculateAroundPHIsPass::run </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllvm_1_1Function.html">Function</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>F</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacellvm.html#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>AM</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Run the pass over the function. </p>

<p class="definition">Definition at line <a class="el" href="SpeculateAroundPHIs_8cpp_source.html#l00808">808</a> of file <a class="el" href="SpeculateAroundPHIs_8cpp_source.html">SpeculateAroundPHIs.cpp</a>.</p>

<p class="reference">References <a class="el" href="PassManager_8h_source.html#l00160">llvm::PreservedAnalyses::all()</a>, <a class="el" href="CoroSplit_8cpp_source.html#l01637">Changed</a>, <a class="el" href="MD5_8cpp_source.html#l00056">F</a>, <a class="el" href="PassManager_8h_source.html#l00769">llvm::AnalysisManager&lt; IRUnitT, ExtraArgTs &gt;::getResult()</a>, and <a class="el" href="SpeculateAroundPHIs_8cpp_source.html#l00737">tryToSpeculatePHIs()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following files:<ul>
<li>include/llvm/Transforms/Scalar/<a class="el" href="SpeculateAroundPHIs_8h_source.html">SpeculateAroundPHIs.h</a></li>
<li>lib/Transforms/Scalar/<a class="el" href="SpeculateAroundPHIs_8cpp_source.html">SpeculateAroundPHIs.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Feb 20 2024 14:03:40 for LLVM by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
