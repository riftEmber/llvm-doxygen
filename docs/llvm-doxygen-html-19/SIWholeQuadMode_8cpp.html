<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Target/AMDGPU/SIWholeQuadMode.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LLVM<span id="projectnumber">&#160;19.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_794e483eb1cc7921d35fd149d9cc325b.html">Target</a></li><li class="navelem"><a class="el" href="dir_447ce995d6e35417de5ec3060e97c93e.html">AMDGPU</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">SIWholeQuadMode.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This pass adds instructions to enable whole quad mode (strict or non-strict) for pixel shaders, and strict whole wavefront mode for all programs.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="AMDGPU_8h_source.html">AMDGPU.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="GCNSubtarget_8h_source.html">GCNSubtarget.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="AMDGPUMCTargetDesc_8h_source.html">MCTargetDesc/AMDGPUMCTargetDesc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="MapVector_8h_source.html">llvm/ADT/MapVector.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="PostOrderIterator_8h_source.html">llvm/ADT/PostOrderIterator.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="LiveIntervals_8h_source.html">llvm/CodeGen/LiveIntervals.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="MachineBasicBlock_8h_source.html">llvm/CodeGen/MachineBasicBlock.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="MachineDominators_8h_source.html">llvm/CodeGen/MachineDominators.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="MachineFunctionPass_8h_source.html">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="MachineInstr_8h_source.html">llvm/CodeGen/MachineInstr.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="MachinePostDominators_8h_source.html">llvm/CodeGen/MachinePostDominators.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="CallingConv_8h_source.html">llvm/IR/CallingConv.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="InitializePasses_8h_source.html">llvm/InitializePasses.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="raw__ostream_8h_source.html">llvm/Support/raw_ostream.h</a>&quot;</code><br />
</div>
<p><a href="SIWholeQuadMode_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad78e062f62e0d6e453941fb4ca843e4d" id="r_ad78e062f62e0d6e453941fb4ca843e4d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>&#160;&#160;&#160;&quot;si-wqm&quot;</td></tr>
<tr class="separator:ad78e062f62e0d6e453941fb4ca843e4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a320bfee867eaf92bf11ea43d449609e5" id="r_a320bfee867eaf92bf11ea43d449609e5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a320bfee867eaf92bf11ea43d449609e5">INITIALIZE_PASS_BEGIN</a> (SIWholeQuadMode, <a class="el" href="GenericCycleImpl_8h.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>, &quot;SI Whole Quad Mode&quot;, false, false) <a class="el" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(SIWholeQuadMode</td></tr>
<tr class="separator:a320bfee867eaf92bf11ea43d449609e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a030569d5a541b6110f2ae1b6a3413a58" id="r_a030569d5a541b6110f2ae1b6a3413a58"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a030569d5a541b6110f2ae1b6a3413a58">DEBUG_TYPE</a></td></tr>
<tr class="separator:a030569d5a541b6110f2ae1b6a3413a58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c198437833c48138f49e3589bd08773" id="r_a0c198437833c48138f49e3589bd08773"><td class="memItemLeft" align="right" valign="top"><a class="el" href="PassBuilderBindings_8cpp.html#a10fde6bea2f819ef87db20d8fe3085c7">SI</a> Whole Quad&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0c198437833c48138f49e3589bd08773">Mode</a></td></tr>
<tr class="separator:a0c198437833c48138f49e3589bd08773"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a310b00b81884fd84664936c3474e1556" id="r_a310b00b81884fd84664936c3474e1556"><td class="memItemLeft" align="right" valign="top"><a class="el" href="PassBuilderBindings_8cpp.html#a10fde6bea2f819ef87db20d8fe3085c7">SI</a> Whole Quad&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a310b00b81884fd84664936c3474e1556">false</a></td></tr>
<tr class="separator:a310b00b81884fd84664936c3474e1556"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This pass adds instructions to enable whole quad mode (strict or non-strict) for pixel shaders, and strict whole wavefront mode for all programs. </p>
<p>The "strict" prefix indicates that inactive lanes do not take part in control flow, specifically an inactive lane enabled by a strict WQM/WWM will always be enabled irrespective of control flow decisions. Conversely in non-strict WQM inactive lanes may control flow decisions.</p>
<p>Whole quad mode is required for derivative computations, but it interferes with shader side effects (stores and atomics). It ensures that WQM is enabled when necessary, but disabled around stores and atomics.</p>
<p>When necessary, this pass creates a function prolog</p>
<p>S_MOV_B64 LiveMask, EXEC S_WQM_B64 EXEC, EXEC</p>
<p>to enter WQM at the top of the function and surrounds blocks of Exact instructions by</p>
<p>S_AND_SAVEEXEC_B64 Tmp, LiveMask ... S_MOV_B64 EXEC, Tmp</p>
<p>We also compute when a sequence of instructions requires strict whole wavefront mode (StrictWWM) and insert instructions to save and restore it:</p>
<p>S_OR_SAVEEXEC_B64 Tmp, -1 ... S_MOV_B64 EXEC, Tmp</p>
<p>When a sequence of instructions requires strict whole quad mode (StrictWQM) we use a similar save and restore mechanism and force whole quad mode for those instructions:</p>
<p>S_MOV_B64 Tmp, EXEC S_WQM_B64 EXEC, EXEC ... S_MOV_B64 EXEC, Tmp</p>
<p>In order to avoid excessive switching during sequences of Exact instructions, the pass first analyzes which instructions must be run in WQM (aka which instructions produce values that lead to derivative computations).</p>
<p>Basic blocks are always exited in WQM as long as some successor needs WQM.</p>
<p>There is room for improvement given better control flow analysis:</p>
<p>(1) at the top level (outside of control flow statements, and as long as kill hasn't been used), one SGPR can be saved by recovering WQM from the LiveMask (this is implemented for the entry block).</p>
<p>(2) when entire regions (e.g. if-else blocks or entire loops) only consist of exact and don't-care instructions, the switch only has to be done at the entry and exit points rather than potentially in each block of the region. </p>

<p class="definition">Definition in file <a class="el" href="SIWholeQuadMode_8cpp_source.html">SIWholeQuadMode.cpp</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ad78e062f62e0d6e453941fb4ca843e4d" name="ad78e062f62e0d6e453941fb4ca843e4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad78e062f62e0d6e453941fb4ca843e4d">&#9670;&#160;</a></span>DEBUG_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_TYPE&#160;&#160;&#160;&quot;si-wqm&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="SIWholeQuadMode_8cpp_source.html#l00087">87</a> of file <a class="el" href="SIWholeQuadMode_8cpp_source.html">SIWholeQuadMode.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a320bfee867eaf92bf11ea43d449609e5" name="a320bfee867eaf92bf11ea43d449609e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a320bfee867eaf92bf11ea43d449609e5">&#9670;&#160;</a></span>INITIALIZE_PASS_BEGIN()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INITIALIZE_PASS_BEGIN </td>
          <td>(</td>
          <td class="paramtype">SIWholeQuadMode</td>          <td class="paramname"><span class="paramname"><em></em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="GenericCycleImpl_8h.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a></td>          <td class="paramname"><span class="paramname"><em></em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;SI Whole Quad Mode&quot;</td>          <td class="paramname"><span class="paramname"><em></em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">false</td>          <td class="paramname"><span class="paramname"><em></em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">false</td>          <td class="paramname"><span class="paramname"><em></em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a030569d5a541b6110f2ae1b6a3413a58" name="a030569d5a541b6110f2ae1b6a3413a58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a030569d5a541b6110f2ae1b6a3413a58">&#9670;&#160;</a></span>DEBUG_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DEBUG_TYPE</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="SIWholeQuadMode_8cpp_source.html#l00263">263</a> of file <a class="el" href="SIWholeQuadMode_8cpp_source.html">SIWholeQuadMode.cpp</a>.</p>

</div>
</div>
<a id="a310b00b81884fd84664936c3474e1556" name="a310b00b81884fd84664936c3474e1556"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a310b00b81884fd84664936c3474e1556">&#9670;&#160;</a></span>false</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="PassBuilderBindings_8cpp.html#a10fde6bea2f819ef87db20d8fe3085c7">SI</a> Whole Quad false</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="SIWholeQuadMode_8cpp_source.html#l00263">263</a> of file <a class="el" href="SIWholeQuadMode_8cpp_source.html">SIWholeQuadMode.cpp</a>.</p>

</div>
</div>
<a id="a0c198437833c48138f49e3589bd08773" name="a0c198437833c48138f49e3589bd08773"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c198437833c48138f49e3589bd08773">&#9670;&#160;</a></span>Mode</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="PassBuilderBindings_8cpp.html#a10fde6bea2f819ef87db20d8fe3085c7">SI</a> Whole Quad Mode</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="SIWholeQuadMode_8cpp_source.html#l00263">263</a> of file <a class="el" href="SIWholeQuadMode_8cpp_source.html">SIWholeQuadMode.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Nov 1 2024 13:46:53 for LLVM by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
