<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Transforms/IPO/SampleProfile.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LLVM<span id="projectnumber">&#160;12.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a72932e0778af28115095468f6286ff8.html">Transforms</a></li><li class="navelem"><a class="el" href="dir_13abb262e9c52ddea8d07639819afd6c.html">IPO</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">SampleProfile.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="SampleProfile_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">//===- SampleProfile.cpp - Incorporate sample profiles into the IR --------===//</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">//</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">//</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">//</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">// This file implements the SampleProfileLoader transformation. This pass</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">// reads a profile file generated by a sampling profiler (e.g. Linux Perf -</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">// http://perf.wiki.kernel.org/) and generates IR metadata to reflect the</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">// profile information in the given profile.</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">//</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment">// This pass generates branch weight annotations on the IR:</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">//</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">// - prof: Represents branch weights. This annotation is added to branches</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">//      to indicate the weights of each edge coming out of the branch.</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">//      The weight of each edge is the weight of the target block for</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment">//      that edge. The weight of a block B is computed as the maximum</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment">//      number of samples found in B.</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">//</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span> </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;<a class="code" href="SampleProfile_8h.html">llvm/Transforms/IPO/SampleProfile.h</a>&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;<a class="code" href="ArrayRef_8h.html">llvm/ADT/ArrayRef.h</a>&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;<a class="code" href="DenseSet_8h.html">llvm/ADT/DenseSet.h</a>&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;<a class="code" href="None_8h.html">llvm/ADT/None.h</a>&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;<a class="code" href="PriorityQueue_8h.html">llvm/ADT/PriorityQueue.h</a>&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;<a class="code" href="SCCIterator_8h.html">llvm/ADT/SCCIterator.h</a>&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &quot;<a class="code" href="SmallPtrSet_8h.html">llvm/ADT/SmallPtrSet.h</a>&quot;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &quot;<a class="code" href="SmallSet_8h.html">llvm/ADT/SmallSet.h</a>&quot;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &quot;<a class="code" href="StringMap_8h.html">llvm/ADT/StringMap.h</a>&quot;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &quot;<a class="code" href="StringRef_8h.html">llvm/ADT/StringRef.h</a>&quot;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &quot;<a class="code" href="Twine_8h.html">llvm/ADT/Twine.h</a>&quot;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &quot;<a class="code" href="AssumptionCache_8h.html">llvm/Analysis/AssumptionCache.h</a>&quot;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &quot;<a class="code" href="CallGraph_8h.html">llvm/Analysis/CallGraph.h</a>&quot;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &quot;<a class="code" href="CallGraphSCCPass_8h.html">llvm/Analysis/CallGraphSCCPass.h</a>&quot;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &quot;<a class="code" href="InlineAdvisor_8h.html">llvm/Analysis/InlineAdvisor.h</a>&quot;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &quot;<a class="code" href="InlineCost_8h.html">llvm/Analysis/InlineCost.h</a>&quot;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &quot;<a class="code" href="LoopInfo_8h.html">llvm/Analysis/LoopInfo.h</a>&quot;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#include &quot;<a class="code" href="OptimizationRemarkEmitter_8h.html">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">#include &quot;<a class="code" href="PostDominators_8h.html">llvm/Analysis/PostDominators.h</a>&quot;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="preprocessor">#include &quot;<a class="code" href="ProfileSummaryInfo_8h.html">llvm/Analysis/ProfileSummaryInfo.h</a>&quot;</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="preprocessor">#include &quot;<a class="code" href="ReplayInlineAdvisor_8h.html">llvm/Analysis/ReplayInlineAdvisor.h</a>&quot;</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="preprocessor">#include &quot;<a class="code" href="TargetLibraryInfo_8h.html">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="preprocessor">#include &quot;<a class="code" href="TargetTransformInfo_8h.html">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="preprocessor">#include &quot;<a class="code" href="BasicBlock_8h.html">llvm/IR/BasicBlock.h</a>&quot;</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="preprocessor">#include &quot;<a class="code" href="IR_2CFG_8h.html">llvm/IR/CFG.h</a>&quot;</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="preprocessor">#include &quot;<a class="code" href="DebugInfoMetadata_8h.html">llvm/IR/DebugInfoMetadata.h</a>&quot;</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="preprocessor">#include &quot;<a class="code" href="DebugLoc_8h.html">llvm/IR/DebugLoc.h</a>&quot;</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="preprocessor">#include &quot;<a class="code" href="DiagnosticInfo_8h.html">llvm/IR/DiagnosticInfo.h</a>&quot;</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="preprocessor">#include &quot;<a class="code" href="Dominators_8h.html">llvm/IR/Dominators.h</a>&quot;</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span><span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="preprocessor">#include &quot;<a class="code" href="GlobalValue_8h.html">llvm/IR/GlobalValue.h</a>&quot;</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="preprocessor">#include &quot;<a class="code" href="InstrTypes_8h.html">llvm/IR/InstrTypes.h</a>&quot;</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="preprocessor">#include &quot;<a class="code" href="IR_2Instruction_8h.html">llvm/IR/Instruction.h</a>&quot;</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="preprocessor">#include &quot;<a class="code" href="LLVMContext_8h.html">llvm/IR/LLVMContext.h</a>&quot;</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="preprocessor">#include &quot;<a class="code" href="MDBuilder_8h.html">llvm/IR/MDBuilder.h</a>&quot;</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span><span class="preprocessor">#include &quot;<a class="code" href="PassManager_8h.html">llvm/IR/PassManager.h</a>&quot;</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="preprocessor">#include &quot;<a class="code" href="ValueSymbolTable_8h.html">llvm/IR/ValueSymbolTable.h</a>&quot;</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="preprocessor">#include &quot;<a class="code" href="InitializePasses_8h.html">llvm/InitializePasses.h</a>&quot;</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="preprocessor">#include &quot;<a class="code" href="InstrProf_8h.html">llvm/ProfileData/InstrProf.h</a>&quot;</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="preprocessor">#include &quot;<a class="code" href="SampleProf_8h.html">llvm/ProfileData/SampleProf.h</a>&quot;</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="preprocessor">#include &quot;<a class="code" href="SampleProfReader_8h.html">llvm/ProfileData/SampleProfReader.h</a>&quot;</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span><span class="preprocessor">#include &quot;<a class="code" href="Casting_8h.html">llvm/Support/Casting.h</a>&quot;</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="preprocessor">#include &quot;<a class="code" href="llvm_2Support_2ErrorHandling_8h.html">llvm/Support/ErrorHandling.h</a>&quot;</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span><span class="preprocessor">#include &quot;<a class="code" href="ErrorOr_8h.html">llvm/Support/ErrorOr.h</a>&quot;</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="preprocessor">#include &quot;<a class="code" href="GenericDomTree_8h.html">llvm/Support/GenericDomTree.h</a>&quot;</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span><span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span><span class="preprocessor">#include &quot;<a class="code" href="llvm_2Transforms_2IPO_8h.html">llvm/Transforms/IPO.h</a>&quot;</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span><span class="preprocessor">#include &quot;<a class="code" href="SampleContextTracker_8h.html">llvm/Transforms/IPO/SampleContextTracker.h</a>&quot;</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="preprocessor">#include &quot;<a class="code" href="SampleProfileProbe_8h.html">llvm/Transforms/IPO/SampleProfileProbe.h</a>&quot;</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="preprocessor">#include &quot;<a class="code" href="Instrumentation_8h.html">llvm/Transforms/Instrumentation.h</a>&quot;</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span><span class="preprocessor">#include &quot;<a class="code" href="CallPromotionUtils_8h.html">llvm/Transforms/Utils/CallPromotionUtils.h</a>&quot;</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="preprocessor">#include &quot;<a class="code" href="Cloning_8h.html">llvm/Transforms/Utils/Cloning.h</a>&quot;</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span><span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span><span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span><span class="preprocessor">#include &lt;functional&gt;</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span><span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="preprocessor">#include &lt;queue&gt;</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="preprocessor">#include &lt;system_error&gt;</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> </div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span><span class="keyword">using namespace </span>sampleprof;</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#ac57dae906fe8ac64efe52571121b0fe1">  100</a></span><span class="keyword">using </span><a class="code hl_class" href="classllvm_1_1Function_1_1ProfileCount.html">ProfileCount</a> = <a class="code hl_class" href="classllvm_1_1Function_1_1ProfileCount.html">Function::ProfileCount</a>;</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">  101</a></span><span class="preprocessor">#define DEBUG_TYPE &quot;sample-profile&quot;</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#ab4932d7673e6e1138d8a2671f16865d1">  102</a></span><span class="preprocessor">#define CSINLINE_DEBUG DEBUG_TYPE &quot;-inline&quot;</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a043ee38f41b13487f8e0ef4f74cc600d">  104</a></span><a class="code hl_define" href="Statistic_8h.html#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumCSInlined</a>,</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>          <span class="stringliteral">&quot;Number of functions inlined with context sensitive profile&quot;</span>);</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a645f77fa2f8d80cd7269b393eab19f76">  106</a></span><a class="code hl_define" href="Statistic_8h.html#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumCSNotInlined</a>,</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>          <span class="stringliteral">&quot;Number of functions not inlined with context sensitive profile&quot;</span>);</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a46c2637d19fc97fa8af274512b3d6fe9">  108</a></span><a class="code hl_define" href="Statistic_8h.html#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumMismatchedProfile</a>,</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>          <span class="stringliteral">&quot;Number of functions with CFG mismatched profile&quot;</span>);</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#ada628920f6270698bc899d52ce29f681">  110</a></span><a class="code hl_define" href="Statistic_8h.html#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumMatchedProfile</a>, <span class="stringliteral">&quot;Number of functions with CFG matched profile&quot;</span>);</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a185d42a572de583b7604376b4ea3660c">  111</a></span><a class="code hl_define" href="Statistic_8h.html#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumDuplicatedInlinesite</a>,</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>          <span class="stringliteral">&quot;Number of inlined callsites with a partial distribution factor&quot;</span>);</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a9c8fc785df9ca40ae647d7bd297edf4d">  114</a></span><a class="code hl_define" href="Statistic_8h.html#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumCSInlinedHitMinLimit</a>,</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>          <span class="stringliteral">&quot;Number of functions with FDO inline stopped due to min size limit&quot;</span>);</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a4df177ce3a429f975041e866a6cf0453">  116</a></span><a class="code hl_define" href="Statistic_8h.html#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumCSInlinedHitMaxLimit</a>,</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>          <span class="stringliteral">&quot;Number of functions with FDO inline stopped due to max size limit&quot;</span>);</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#acee6f38eb8e4ddba9973ec3c31d83b44">  118</a></span><a class="code hl_define" href="Statistic_8h.html#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumCSInlinedHitGrowthLimit</a>,</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="stringliteral">&quot;Number of functions with FDO inline stopped due to growth size limit&quot;</span>);</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span> </div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span><span class="comment">// Command line option to specify the file to read samples from. This is</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span><span class="comment">// mainly used for debugging.</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a055c6b7054a94b338830b3da8ecc4023">  124</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;std::string&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a055c6b7054a94b338830b3da8ecc4023">SampleProfileFile</a>(</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <span class="stringliteral">&quot;sample-profile-file&quot;</span>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="stringliteral">&quot;&quot;</span>), <a class="code hl_struct" href="structllvm_1_1cl_1_1value__desc.html">cl::value_desc</a>(<span class="stringliteral">&quot;filename&quot;</span>),</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Profile file loaded by -sample-profile&quot;</span>), <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span> </div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span><span class="comment">// The named file contains a set of transformations that may have been applied</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span><span class="comment">// to the symbol names between the program from which the sample data was</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="comment">// collected and the current program&#39;s symbols.</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#af8d3791537a44c00b699d28c4d978d82">  131</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;std::string&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#af8d3791537a44c00b699d28c4d978d82">SampleProfileRemappingFile</a>(</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <span class="stringliteral">&quot;sample-profile-remapping-file&quot;</span>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="stringliteral">&quot;&quot;</span>), <a class="code hl_struct" href="structllvm_1_1cl_1_1value__desc.html">cl::value_desc</a>(<span class="stringliteral">&quot;filename&quot;</span>),</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Profile remapping file loaded by -sample-profile&quot;</span>), <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span> </div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#aade7b2da98de69a3231e8205e9770963">  135</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#aade7b2da98de69a3231e8205e9770963">SampleProfileMaxPropagateIterations</a>(</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <span class="stringliteral">&quot;sample-profile-max-propagate-iterations&quot;</span>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(100),</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Maximum number of iterations to go through when propagating &quot;</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>             <span class="stringliteral">&quot;sample block/edge weights through the CFG.&quot;</span>));</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span> </div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a40954848b5b26403e461ce7a190243d4">  140</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a40954848b5b26403e461ce7a190243d4">SampleProfileRecordCoverage</a>(</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <span class="stringliteral">&quot;sample-profile-check-record-coverage&quot;</span>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a class="code hl_struct" href="structllvm_1_1cl_1_1value__desc.html">cl::value_desc</a>(<span class="stringliteral">&quot;N&quot;</span>),</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Emit a warning if less than N% of records in the input profile &quot;</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>             <span class="stringliteral">&quot;are matched to the IR.&quot;</span>));</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span> </div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a8ac02d9aff84c95f5894d9f7ef8c5e4a">  145</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a8ac02d9aff84c95f5894d9f7ef8c5e4a">SampleProfileSampleCoverage</a>(</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    <span class="stringliteral">&quot;sample-profile-check-sample-coverage&quot;</span>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a class="code hl_struct" href="structllvm_1_1cl_1_1value__desc.html">cl::value_desc</a>(<span class="stringliteral">&quot;N&quot;</span>),</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Emit a warning if less than N% of samples in the input profile &quot;</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>             <span class="stringliteral">&quot;are matched to the IR.&quot;</span>));</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span> </div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a0200f3202920f714e0b23c4606a27192">  150</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a0200f3202920f714e0b23c4606a27192">NoWarnSampleUnused</a>(</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <span class="stringliteral">&quot;no-warn-sample-unused&quot;</span>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="keyword">false</span>), <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Use this option to turn off/on warnings about function with &quot;</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>             <span class="stringliteral">&quot;samples but without debug information to use those samples. &quot;</span>));</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span> </div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#af00e1c8a074b97aedd1a2db33dea6753">  155</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#af00e1c8a074b97aedd1a2db33dea6753">ProfileSampleAccurate</a>(</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <span class="stringliteral">&quot;profile-sample-accurate&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;If the sample profile is accurate, we will mark all un-sampled &quot;</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>             <span class="stringliteral">&quot;callsite and function as having 0 samples. Otherwise, treat &quot;</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>             <span class="stringliteral">&quot;un-sampled callsites and functions conservatively as unknown. &quot;</span>));</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a8aa89f0866c6f65d2395b74e851e73f7">  161</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a8aa89f0866c6f65d2395b74e851e73f7">ProfileAccurateForSymsInList</a>(</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <span class="stringliteral">&quot;profile-accurate-for-symsinlist&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a492234b10e0c5918d72a3a15a6f0fa6ea61d3cb794533763159788c493ad266d9">cl::ZeroOrMore</a>,</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;For symbols in profile symbol list, regard their profiles to &quot;</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>             <span class="stringliteral">&quot;be accurate. It may be overriden by profile-sample-accurate. &quot;</span>));</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span> </div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a8b16dbb3ebefd05908afe3a7874d6353">  167</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a8b16dbb3ebefd05908afe3a7874d6353">ProfileMergeInlinee</a>(</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    <span class="stringliteral">&quot;sample-profile-merge-inlinee&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Merge past inlinee&#39;s profile to outline version if sample &quot;</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>             <span class="stringliteral">&quot;profile loader decided not to inline a call site. It will &quot;</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>             <span class="stringliteral">&quot;only be enabled when top-down order of profile loading is &quot;</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>             <span class="stringliteral">&quot;enabled. &quot;</span>));</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span> </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#aeeed05c14d5103af2df4ef16b3d12674">  174</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#aeeed05c14d5103af2df4ef16b3d12674">ProfileTopDownLoad</a>(</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <span class="stringliteral">&quot;sample-profile-top-down-load&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Do profile annotation and inlining for functions in top-down &quot;</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>             <span class="stringliteral">&quot;order of call graph during sample profile loading. It only &quot;</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>             <span class="stringliteral">&quot;works for new pass manager. &quot;</span>));</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a4e4de7b815d127b5177401937420c294">  180</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a4e4de7b815d127b5177401937420c294">UseProfileIndirectCallEdges</a>(</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <span class="stringliteral">&quot;use-profile-indirect-call-edges&quot;</span>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="keyword">true</span>), <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Considering indirect call samples from profile when top-down &quot;</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>             <span class="stringliteral">&quot;processing functions. Only CSSPGO is supported.&quot;</span>));</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span> </div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a3e3a587b7e1abc61882cb48ed0b5b3d2">  185</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a3e3a587b7e1abc61882cb48ed0b5b3d2">UseProfileTopDownOrder</a>(</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    <span class="stringliteral">&quot;use-profile-top-down-order&quot;</span>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="keyword">false</span>), <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Process functions in one SCC in a top-down order &quot;</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>             <span class="stringliteral">&quot;based on the input profile.&quot;</span>));</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#ada8f2c564085d598909fb28464614812">  190</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#ada8f2c564085d598909fb28464614812">ProfileSizeInline</a>(</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="stringliteral">&quot;sample-profile-inline-size&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Inline cold call sites in profile loader if it&#39;s beneficial &quot;</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>             <span class="stringliteral">&quot;for code size.&quot;</span>));</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span> </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a6f2891ea30bbf02e93cc94ca385d8d91">  195</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a6f2891ea30bbf02e93cc94ca385d8d91">ProfileInlineGrowthLimit</a>(</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    <span class="stringliteral">&quot;sample-profile-inline-growth-limit&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(12),</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;The size growth ratio limit for proirity-based sample profile &quot;</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>             <span class="stringliteral">&quot;loader inlining.&quot;</span>));</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span> </div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#ae2b46e6b1f93e3b18b20d0c0c0ac6151">  200</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#ae2b46e6b1f93e3b18b20d0c0c0ac6151">ProfileInlineLimitMin</a>(</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="stringliteral">&quot;sample-profile-inline-limit-min&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(100),</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;The lower bound of size growth limit for &quot;</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>             <span class="stringliteral">&quot;proirity-based sample profile loader inlining.&quot;</span>));</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a1fbf05aa3c19fb9ce58e03dcca69e493">  205</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a1fbf05aa3c19fb9ce58e03dcca69e493">ProfileInlineLimitMax</a>(</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <span class="stringliteral">&quot;sample-profile-inline-limit-max&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(10000),</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;The upper bound of size growth limit for &quot;</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>             <span class="stringliteral">&quot;proirity-based sample profile loader inlining.&quot;</span>));</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a9248a6cbd185564d6817d671ddc29c90">  210</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a9248a6cbd185564d6817d671ddc29c90">ProfileICPThreshold</a>(</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="stringliteral">&quot;sample-profile-icp-threshold&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(5),</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>        <span class="stringliteral">&quot;Relative hotness threshold for indirect &quot;</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>        <span class="stringliteral">&quot;call promotion in proirity-based sample profile loader inlining.&quot;</span>));</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a033aa3e7e3e183cec38f5a5e36e212c7">  216</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a033aa3e7e3e183cec38f5a5e36e212c7">SampleHotCallSiteThreshold</a>(</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    <span class="stringliteral">&quot;sample-profile-hot-inline-threshold&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(3000),</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Hot callsite threshold for proirity-based sample profile loader &quot;</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>             <span class="stringliteral">&quot;inlining.&quot;</span>));</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a582e224bc99dcf3ca6263cdd9b25d94f">  221</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a582e224bc99dcf3ca6263cdd9b25d94f">CallsitePrioritizedInline</a>(</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="stringliteral">&quot;sample-profile-prioritized-inline&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a492234b10e0c5918d72a3a15a6f0fa6ea61d3cb794533763159788c493ad266d9">cl::ZeroOrMore</a>,</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Use call site prioritized inlining for sample profile loader.&quot;</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>             <span class="stringliteral">&quot;Currently only CSSPGO is supported.&quot;</span>));</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a6c063cf654bf13a20d00365c2ef7b1da">  227</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a6c063cf654bf13a20d00365c2ef7b1da">SampleColdCallSiteThreshold</a>(</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    <span class="stringliteral">&quot;sample-profile-cold-inline-threshold&quot;</span>, <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(45),</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Threshold for inlining cold callsites&quot;</span>));</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a732d61bd469914910adee6ed8c8c4a38">  231</a></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;std::string&gt;</a> <a class="code hl_variable" href="SampleProfile_8cpp.html#a732d61bd469914910adee6ed8c8c4a38">ProfileInlineReplayFile</a>(</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    <span class="stringliteral">&quot;sample-profile-inline-replay&quot;</span>, <a class="code hl_function" href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<span class="stringliteral">&quot;&quot;</span>), <a class="code hl_struct" href="structllvm_1_1cl_1_1value__desc.html">cl::value_desc</a>(<span class="stringliteral">&quot;filename&quot;</span>),</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <a class="code hl_struct" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>        <span class="stringliteral">&quot;Optimization remarks file containing inline remarks to be replayed &quot;</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>        <span class="stringliteral">&quot;by inlining from sample profile loader.&quot;</span>),</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <a class="code hl_enumvalue" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span> </div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span><span class="keyword">using </span><a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BlockWeightMap</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;const BasicBlock *, uint64_t&gt;</a>;</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span><span class="keyword">using </span><a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">EquivalenceClassMap</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;const BasicBlock *, const BasicBlock *&gt;</a>;</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span><span class="keyword">using </span>Edge = std::pair&lt;const BasicBlock *, const BasicBlock *&gt;;</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span><span class="keyword">using </span><a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">EdgeWeightMap</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;Edge, uint64_t&gt;</a>;</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span><span class="keyword">using </span>BlockEdgeMap =</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;const BasicBlock *, SmallVector&lt;const BasicBlock *, 8&gt;</a>&gt;;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="keyword">class </span>SampleProfileLoader;</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span><span class="keyword">class </span>SampleCoverageTracker {</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>  SampleCoverageTracker(SampleProfileLoader &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SPL</a>) : SPLoader(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SPL</a>){};</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">markSamplesUsed</a>(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *FS, <a class="code hl_class" href="classuint32__t.html">uint32_t</a> LineOffset,</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>                       <a class="code hl_class" href="classuint32__t.html">uint32_t</a> Discriminator, uint64_t Samples);</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>  <span class="keywordtype">unsigned</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">computeCoverage</a>(<span class="keywordtype">unsigned</span> Used, <span class="keywordtype">unsigned</span> Total) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>  <span class="keywordtype">unsigned</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">countUsedRecords</a>(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *FS,</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>                            <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>  <span class="keywordtype">unsigned</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">countBodyRecords</a>(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *FS,</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>                            <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>  uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getTotalUsedSamples</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> TotalUsedSamples; }</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>  uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">countBodySamples</a>(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *FS,</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>                            <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  <span class="keywordtype">void</span> <a class="code hl_function" href="Coroutines_8cpp.html#ac781ce96aa25ba7f6fd38f72de665450">clear</a>() {</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    SampleCoverage.clear();</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>    TotalUsedSamples = 0;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>  }</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span> </div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>  <span class="keyword">using </span>BodySampleCoverageMap = std::map&lt;LineLocation, unsigned&gt;;</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>  <span class="keyword">using </span>FunctionSamplesCoverageMap =</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;const FunctionSamples *, BodySampleCoverageMap&gt;</a>;</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span><span class="comment"></span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span><span class="comment">  /// Coverage map for sampling records.</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span><span class="comment">  ///</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span><span class="comment">  /// This map keeps a record of sampling records that have been matched to</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="comment">  /// an IR instruction. This is used to detect some form of staleness in</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span><span class="comment">  /// profiles (see flag -sample-profile-check-coverage).</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span><span class="comment">  ///</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span><span class="comment">  /// Each entry in the map corresponds to a FunctionSamples instance.  This is</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span><span class="comment">  /// another map that counts how many times the sample record at the</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span><span class="comment">  /// given location has been used.</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span><span class="comment"></span>  FunctionSamplesCoverageMap SampleCoverage;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span><span class="comment"></span> </div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span><span class="comment">  /// Number of samples used from the profile.</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span><span class="comment">  ///</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span><span class="comment">  /// When a sampling record is used for the first time, the samples from</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span><span class="comment">  /// that record are added to this accumulator.  Coverage is later computed</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span><span class="comment">  /// based on the total number of samples available in this function and</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span><span class="comment">  /// its callsites.</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span><span class="comment">  ///</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span><span class="comment">  /// Note that this accumulator tracks samples used from a single function</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span><span class="comment">  /// and all the inlined callsites. Strictly, we should have a map of counters</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span><span class="comment">  /// keyed by FunctionSamples pointers, but these stats are cleared after</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span><span class="comment">  /// every function, so we just need to keep a single counter.</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span><span class="comment"></span>  uint64_t TotalUsedSamples = 0;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span> </div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>  SampleProfileLoader &amp;SPLoader;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>};</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span> </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span><span class="keyword">class </span>GUIDToFuncNameMapper {</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>  GUIDToFuncNameMapper(<a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;M, <a class="code hl_class" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html">SampleProfileReader</a> &amp;Reader,</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>                        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;uint64_t, StringRef&gt;</a> &amp;GUIDToFuncNameMap)</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>      : CurrentReader(Reader), CurrentModule(M),</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>      CurrentGUIDToFuncNameMap(GUIDToFuncNameMap) {</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    <span class="keywordflow">if</span> (!CurrentReader.useMD5())</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : CurrentModule) {</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>      <a class="code hl_class" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OrigName</a> = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName();</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>      CurrentGUIDToFuncNameMap.insert(</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>          {Function::getGUID(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OrigName</a>), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OrigName</a>});</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>      <span class="comment">// Local to global var promotion used by optimization like thinlto</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>      <span class="comment">// will rename the var and add suffix like &quot;.llvm.xxx&quot; to the</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>      <span class="comment">// original local name. In sample profile, the suffixes of function</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>      <span class="comment">// names are all stripped. Since it is possible that the mapper is</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>      <span class="comment">// built in post-thin-link phase and var promotion has been done,</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>      <span class="comment">// we need to add the substring of function name without the suffix</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>      <span class="comment">// into the GUIDToFuncNameMap.</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>      <a class="code hl_class" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CanonName</a> = <a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa7122a07ea48e47fc71083e68b829003">FunctionSamples::getCanonicalFnName</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CanonName</a> != <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OrigName</a>)</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>        CurrentGUIDToFuncNameMap.insert(</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>            {Function::getGUID(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CanonName</a>), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CanonName</a>});</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    }</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    <span class="comment">// Update GUIDToFuncNameMap for each function including inlinees.</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SetGUIDToFuncNameMapForAll</a>(&amp;CurrentGUIDToFuncNameMap);</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>  }</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>  ~GUIDToFuncNameMapper() {</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    <span class="keywordflow">if</span> (!CurrentReader.useMD5())</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>    CurrentGUIDToFuncNameMap.clear();</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span> </div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    <span class="comment">// Reset GUIDToFuncNameMap for of each function as they&#39;re no</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    <span class="comment">// longer valid at this point.</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SetGUIDToFuncNameMapForAll</a>(<span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>  }</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span> </div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>  <span class="keywordtype">void</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SetGUIDToFuncNameMapForAll</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;uint64_t, StringRef&gt;</a> *Map) {</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    std::queue&lt;FunctionSamples *&gt; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FSToUpdate</a>;</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IFS</a> : CurrentReader.getProfiles()) {</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FSToUpdate</a>.push(&amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IFS</a>.second);</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>    }</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span> </div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>    <span class="keywordflow">while</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FSToUpdate</a>.empty()) {</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>      <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FSToUpdate</a>.front();</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FSToUpdate</a>.pop();</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>      <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;GUIDToFuncNameMap = <a class="code hl_enumvalue" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>;</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ICS</a> : <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getCallsiteSamples()) {</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="namespacellvm_1_1sampleprof.html#a659a52f7008b83957eb326a57a737cf9">FunctionSamplesMap</a> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FSMap</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ICS</a>.second;</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IFS</a> : <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FSMap</a>) {</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>          <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> &amp;<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a> = <span class="keyword">const_cast&lt;</span><a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> &amp;<span class="keyword">&gt;</span>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IFS</a>.second);</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FSToUpdate</a>.push(&amp;FS);</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>        }</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>      }</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    }</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>  }</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>  <a class="code hl_class" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html">SampleProfileReader</a> &amp;CurrentReader;</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>  <a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;CurrentModule;</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;uint64_t, StringRef&gt;</a> &amp;CurrentGUIDToFuncNameMap;</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>};</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span><span class="comment">// Inline candidate used by iterative callsite prioritized inliner</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="keyword">struct </span>InlineCandidate {</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>  <a class="code hl_class" href="classllvm_1_1CallBase.html">CallBase</a> *CallInstr;</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *CalleeSamples;</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>  <span class="comment">// Prorated callsite count, which will be used to guide inlining. For example,</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>  <span class="comment">// if a callsite is duplicated in LTO prelink, then in LTO postlink the two</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>  <span class="comment">// copies will get their own distribution factors and their prorated counts</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>  <span class="comment">// will be used to decide if they should be inlined independently.</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>  uint64_t CallsiteCount;</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>  <span class="comment">// Call site distribution factor to prorate the profile samples for a</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>  <span class="comment">// duplicated callsite. Default value is 1.0.</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>  <span class="keywordtype">float</span> CallsiteDistribution;</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>};</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span><span class="comment">// Inline candidate comparer using call site weight</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span><span class="keyword">struct </span>CandidateComparer {</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>  <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> InlineCandidate &amp;LHS, <span class="keyword">const</span> InlineCandidate &amp;RHS) {</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    <span class="keywordflow">if</span> (LHS.CallsiteCount != RHS.CallsiteCount)</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>      <span class="keywordflow">return</span> LHS.CallsiteCount &lt; RHS.CallsiteCount;</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span> </div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="comment">// Tie breaker using GUID so we have stable/deterministic inlining order</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LHS.CalleeSamples &amp;&amp; RHS.CalleeSamples &amp;&amp;</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>           <span class="stringliteral">&quot;Expect non-null FunctionSamples&quot;</span>);</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    <span class="keywordflow">return</span> LHS.CalleeSamples-&gt;getGUID(LHS.CalleeSamples-&gt;getName()) &lt;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>           RHS.CalleeSamples-&gt;getGUID(RHS.CalleeSamples-&gt;getName());</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>  }</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>};</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span> </div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span><span class="keyword">using </span><a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CandidateQueue</a> =</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">PriorityQueue&lt;InlineCandidate, std::vector&lt;InlineCandidate&gt;</a>,</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>                  CandidateComparer&gt;;</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span><span class="comment"></span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span><span class="comment">/// Sample profile pass.</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span><span class="comment">///</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span><span class="comment">/// This pass reads profile data from the file specified by</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span><span class="comment">/// -sample-profile-file and annotates every affected function with the</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span><span class="comment">/// profile information found in that file.</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span><span class="comment"></span><span class="keyword">class </span>SampleProfileLoader {</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>  SampleProfileLoader(</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>      <a class="code hl_class" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code hl_variable" href="ELFObjHandler_8cpp.html#adc852f586959ce13117d737cf3f14899">Name</a>, <a class="code hl_class" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">RemapName</a>, <a class="code hl_enumeration" href="namespacellvm.html#a5d737fb4258bb27586a1bffd557fbb49">ThinOrFullLTOPhase</a> LTOPhase,</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>      std::function&lt;<a class="code hl_class" href="classllvm_1_1AssumptionCache.html">AssumptionCache</a> &amp;(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;)&gt; GetAssumptionCache,</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>      std::function&lt;<a class="code hl_class" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;)&gt; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">GetTargetTransformInfo</a>,</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>      std::function&lt;<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;)&gt; GetTLI)</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>      : GetAC(<a class="code hl_namespace" href="namespacestd.html">std</a>::<a class="code hl_function" href="namespacellvm.html#abfc9c7ecf70f66901e439f7c04ef3dbb">move</a>(GetAssumptionCache)),</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>        GetTTI(<a class="code hl_namespace" href="namespacestd.html">std</a>::<a class="code hl_function" href="namespacellvm.html#abfc9c7ecf70f66901e439f7c04ef3dbb">move</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">GetTargetTransformInfo</a>)), GetTLI(<a class="code hl_namespace" href="namespacestd.html">std</a>::<a class="code hl_function" href="namespacellvm.html#abfc9c7ecf70f66901e439f7c04ef3dbb">move</a>(GetTLI)),</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>        CoverageTracker(*<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">this</a>), Filename(<a class="code hl_namespace" href="namespacestd.html">std</a>::string(<a class="code hl_variable" href="ELFObjHandler_8cpp.html#adc852f586959ce13117d737cf3f14899">Name</a>)),</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>        RemappingFilename(<a class="code hl_namespace" href="namespacestd.html">std</a>::string(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">RemapName</a>)), LTOPhase(LTOPhase) {}</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span> </div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>  <span class="keywordtype">bool</span> doInitialization(<a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;M, <a class="code hl_class" href="classllvm_1_1AnalysisManager.html">FunctionAnalysisManager</a> *FAM = <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>  <span class="keywordtype">bool</span> runOnModule(<a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;M, <a class="code hl_class" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> *AM,</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>                   <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">_PSI</a>, <a class="code hl_class" href="classllvm_1_1CallGraph.html">CallGraph</a> *<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>);</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span> </div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>  <span class="keywordtype">void</span> <a class="code hl_function" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() { Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a241493be5796817782fda51d1b3fa61d">dump</a>(); }</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span> </div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span><span class="keyword">protected</span>:</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>  <span class="keyword">friend</span> <span class="keyword">class </span>SampleCoverageTracker;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span> </div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a>(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code hl_class" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> *AM);</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>  <span class="keywordtype">unsigned</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getFunctionLoc</a>(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">emitAnnotations</a>(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getInstWeight</a>(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getProbeWeight</a>(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getBlockWeight</a>(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB);</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findCalleeFunctionSamples</a>(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1CallBase.html">CallBase</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>  std::vector&lt;const FunctionSamples *&gt;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findIndirectCallFunctionSamples</a>(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, uint64_t &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>  <span class="keyword">mutable</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;const DILocation *, const FunctionSamples *&gt;</a> DILocation2SampleMap;</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *findFunctionSamples(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>  <span class="comment">// Attempt to promote indirect call and also inline the promoted call</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">tryPromoteAndInlineCandidate</a>(</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>      <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, InlineCandidate &amp;Candidate, uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SumOrigin</a>,</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>      uint64_t &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseSet&lt;Instruction *&gt;</a> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">PromotedInsns</a>,</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;CallBase *, 8&gt;</a> *InlinedCallSites = <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">inlineHotFunctions</a>(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>                          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseSet&lt;GlobalValue::GUID&gt;</a> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>);</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>  <a class="code hl_class" href="classllvm_1_1InlineCost.html">InlineCost</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">shouldInlineCandidate</a>(InlineCandidate &amp;Candidate);</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getInlineCandidate</a>(InlineCandidate *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewCandidate</a>, <a class="code hl_class" href="classllvm_1_1CallBase.html">CallBase</a> *CB);</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>  <span class="keywordtype">bool</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">tryInlineCandidate</a>(InlineCandidate &amp;Candidate,</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>                     <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;CallBase *, 8&gt;</a> *InlinedCallSites = <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>  <span class="keywordtype">bool</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">inlineHotFunctionsWithPriority</a>(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>                                 <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseSet&lt;GlobalValue::GUID&gt;</a> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>);</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>  <span class="comment">// Inline cold/small functions in addition to hot ones</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">shouldInlineColdCallee</a>(<a class="code hl_class" href="classllvm_1_1CallBase.html">CallBase</a> &amp;<a class="code hl_class" href="classllvm_1_1CallInst.html">CallInst</a>);</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>  <span class="keywordtype">void</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">emitOptimizationRemarksForInlineCandidates</a>(</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>      <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVectorImpl&lt;CallBase *&gt;</a> &amp;Candidates, <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>      <span class="keywordtype">bool</span> Hot);</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>  <span class="keywordtype">void</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">printEdgeWeight</a>(<a class="code hl_class" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS, Edge <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>);</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>  <span class="keywordtype">void</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">printBlockWeight</a>(<a class="code hl_class" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS, <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>  <span class="keywordtype">void</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">printBlockEquivalence</a>(<a class="code hl_class" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS, <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB);</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">computeBlockWeights</a>(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>  <span class="keywordtype">void</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findEquivalenceClasses</a>(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>  <span class="keyword">template</span> &lt;<span class="keywordtype">bool</span> IsPostDom&gt;</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>  <span class="keywordtype">void</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findEquivalencesFor</a>(<a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ArrayRef&lt;BasicBlock *&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Descendants</a>,</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>                           <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DominatorTreeBase&lt;BasicBlock, IsPostDom&gt;</a> *DomTree);</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span> </div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>  <span class="keywordtype">void</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">propagateWeights</a>(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>  uint64_t visitEdge(Edge <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>, <span class="keywordtype">unsigned</span> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumUnknownEdges</a>, Edge *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>);</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>  <span class="keywordtype">void</span> buildEdges(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>  std::vector&lt;Function *&gt; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">buildFunctionOrder</a>(<a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;M, <a class="code hl_class" href="classllvm_1_1CallGraph.html">CallGraph</a> *<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>);</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>  <span class="keywordtype">void</span> addCallGraphEdges(<a class="code hl_class" href="classllvm_1_1CallGraph.html">CallGraph</a> &amp;<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>, <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> &amp;Samples);</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>  <span class="keywordtype">void</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">replaceCallGraphEdges</a>(<a class="code hl_class" href="classllvm_1_1CallGraph.html">CallGraph</a> &amp;<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">StringMap&lt;Function *&gt;</a> &amp;SymbolMap);</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">propagateThroughEdges</a>(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UpdateBlockCount</a>);</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>  <span class="keywordtype">void</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">computeDominanceAndLoopInfo</a>(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>  <span class="keywordtype">void</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">clearFunctionData</a>();</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">callsiteIsHot</a>(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CallsiteFS</a>,</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>                     <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI);</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span><span class="comment"></span> </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span><span class="comment">  /// Map basic blocks to their computed weights.</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span><span class="comment">  ///</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span><span class="comment">  /// The weight of a basic block is defined to be the maximum</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span><span class="comment">  /// of all the instruction weights in that block.</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span><span class="comment"></span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BlockWeightMap</a> BlockWeights;</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span><span class="comment"></span> </div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span><span class="comment">  /// Map edges to their computed weights.</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span><span class="comment">  ///</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span><span class="comment">  /// Edge weights are computed by propagating basic block weights in</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span><span class="comment">  /// SampleProfile::propagateWeights.</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span><span class="comment"></span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">EdgeWeightMap</a> EdgeWeights;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span><span class="comment"></span> </div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span><span class="comment">  /// Set of visited blocks during propagation.</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="comment"></span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallPtrSet&lt;const BasicBlock *, 32&gt;</a> VisitedBlocks;</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span><span class="comment"></span> </div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span><span class="comment">  /// Set of visited edges during propagation.</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span><span class="comment"></span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallSet&lt;Edge, 32&gt;</a> VisitedEdges;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span><span class="comment"></span> </div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span><span class="comment">  /// Equivalence classes for block weights.</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span><span class="comment">  ///</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span><span class="comment">  /// Two blocks BB1 and BB2 are in the same equivalence class if they</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span><span class="comment">  /// dominate and post-dominate each other, and they are in the same loop</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span><span class="comment">  /// nest. When this happens, the two blocks are guaranteed to execute</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span><span class="comment">  /// the same number of times.</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span><span class="comment"></span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">EquivalenceClassMap</a> EquivalenceClass;</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span><span class="comment"></span> </div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span><span class="comment">  /// Map from function name to Function *. Used to find the function from</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span><span class="comment">  /// the function name. If the function name contains suffix, additional</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="comment">  /// entry is added to map from the stripped name to the function if there</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span><span class="comment">  /// is one-to-one mapping.</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span><span class="comment"></span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">StringMap&lt;Function *&gt;</a> <a class="code hl_typedef" href="namespacellvm_1_1orc.html#a6a31d56a05a94b79b1c5eb0b85ae0283">SymbolMap</a>;</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span><span class="comment"></span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span><span class="comment">  /// Dominance, post-dominance and loop information.</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span><span class="comment"></span>  std::unique_ptr&lt;DominatorTree&gt; DT;</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>  std::unique_ptr&lt;PostDominatorTree&gt; PDT;</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>  std::unique_ptr&lt;LoopInfo&gt; LI;</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span> </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>  std::function&lt;<a class="code hl_class" href="classllvm_1_1AssumptionCache.html">AssumptionCache</a> &amp;(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;)&gt; GetAC;</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>  std::function&lt;<a class="code hl_class" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;)&gt; GetTTI;</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>  std::function&lt;<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;)&gt; GetTLI;</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="comment"></span> </div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="comment">  /// Predecessors for each basic block in the CFG.</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="comment"></span>  BlockEdgeMap Predecessors;</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="comment"></span> </div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span><span class="comment">  /// Successors for each basic block in the CFG.</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span><span class="comment"></span>  BlockEdgeMap Successors;</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span> </div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>  SampleCoverageTracker CoverageTracker;</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span><span class="comment"></span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="comment">  /// Profile reader object.</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span><span class="comment"></span>  std::unique_ptr&lt;SampleProfileReader&gt; Reader;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span><span class="comment"></span> </div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span><span class="comment">  /// Profile tracker for different context.</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span><span class="comment"></span>  std::unique_ptr&lt;SampleContextTracker&gt; ContextTracker;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span><span class="comment"></span> </div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span><span class="comment">  /// Samples collected for the body of this function.</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="comment"></span>  <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *Samples = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span><span class="comment"></span> </div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span><span class="comment">  /// Name of the profile file to load.</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="comment"></span>  std::string Filename;</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span><span class="comment"></span> </div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span><span class="comment">  /// Name of the profile remapping file to load.</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span><span class="comment"></span>  std::string RemappingFilename;</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span><span class="comment"></span> </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span><span class="comment">  /// Flag indicating whether the profile input loaded successfully.</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span><span class="comment"></span>  <span class="keywordtype">bool</span> ProfileIsValid = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span><span class="comment"></span> </div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span><span class="comment">  /// Flag indicating whether input profile is context-sensitive</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span><span class="comment"></span>  <span class="keywordtype">bool</span> ProfileIsCS = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span><span class="comment"></span> </div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span><span class="comment">  /// Flag indicating which LTO/ThinLTO phase the pass is invoked in.</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span><span class="comment">  ///</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span><span class="comment">  /// We need to know the LTO phase because for example in ThinLTOPrelink</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span><span class="comment">  /// phase, in annotation, we should not promote indirect calls. Instead,</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span><span class="comment">  /// we will mark GUIDs that needs to be annotated to the function.</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span><span class="comment"></span>  <a class="code hl_enumeration" href="namespacellvm.html#a5d737fb4258bb27586a1bffd557fbb49">ThinOrFullLTOPhase</a> LTOPhase;</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span><span class="comment"></span> </div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span><span class="comment">  /// Profile Summary Info computed from sample profile.</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span><span class="comment"></span>  <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span><span class="comment"></span> </div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span><span class="comment">  /// Profle Symbol list tells whether a function name appears in the binary</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span><span class="comment">  /// used to generate the current profile.</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span><span class="comment"></span>  std::unique_ptr&lt;ProfileSymbolList&gt; PSL;</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span><span class="comment"></span> </div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span><span class="comment">  /// Total number of samples collected in this profile.</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span><span class="comment">  ///</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span><span class="comment">  /// This is the sum of all the samples collected in all the functions executed</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span><span class="comment">  /// at runtime.</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span><span class="comment"></span>  uint64_t TotalCollectedSamples = 0;</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span><span class="comment"></span> </div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span><span class="comment">  /// Optimization Remark Emitter used to emit diagnostic remarks.</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span><span class="comment"></span>  <a class="code hl_class" href="classllvm_1_1OptimizationRemarkEmitter.html">OptimizationRemarkEmitter</a> *ORE = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span> </div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>  <span class="comment">// Information recorded when we declined to inline a call site</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>  <span class="comment">// because we have determined it is too cold is accumulated for</span></div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>  <span class="comment">// each callee function. Initially this is just the entry count.</span></div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>  <span class="keyword">struct </span>NotInlinedProfileInfo {</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    uint64_t entryCount;</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>  };</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;Function *, NotInlinedProfileInfo&gt;</a> notInlinedCallInfo;</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span> </div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>  <span class="comment">// GUIDToFuncNameMap saves the mapping from GUID to the symbol name, for</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>  <span class="comment">// all the function symbols defined or declared in current module.</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;uint64_t, StringRef&gt;</a> GUIDToFuncNameMap;</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span> </div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>  <span class="comment">// All the Names used in FunctionSamples including outline function</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>  <span class="comment">// names, inline instance names and call target names.</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">StringSet&lt;&gt;</a> NamesInProfile;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span> </div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>  <span class="comment">// For symbol in profile symbol list, whether to regard their profiles</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>  <span class="comment">// to be accurate. It is mainly decided by existance of profile symbol</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>  <span class="comment">// list and -profile-accurate-for-symsinlist flag, but it can be</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>  <span class="comment">// overriden by -profile-sample-accurate or profile-sample-accurate</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>  <span class="comment">// attribute.</span></div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>  <span class="keywordtype">bool</span> ProfAccForSymsInList;</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span> </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>  <span class="comment">// External inline advisor used to replay inline decision from remarks.</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>  std::unique_ptr&lt;ReplayInlineAdvisor&gt; ExternalInlineAdvisor;</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span> </div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>  <span class="comment">// A pseudo probe helper to correlate the imported sample counts.</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>  std::unique_ptr&lt;PseudoProbeManager&gt; ProbeManager;</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>};</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span> </div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span><span class="keyword">class </span>SampleProfileLoaderLegacyPass : <span class="keyword">public</span> <a class="code hl_class" href="classllvm_1_1ModulePass.html">ModulePass</a> {</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>  <span class="comment">// Class identification, replacement for typeinfo</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code hl_typedef" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">ID</a>;</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span> </div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>  SampleProfileLoaderLegacyPass(</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>      <a class="code hl_class" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code hl_variable" href="ELFObjHandler_8cpp.html#adc852f586959ce13117d737cf3f14899">Name</a> = <a class="code hl_variable" href="SampleProfile_8cpp.html#a055c6b7054a94b338830b3da8ecc4023">SampleProfileFile</a>,</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>      <a class="code hl_enumeration" href="namespacellvm.html#a5d737fb4258bb27586a1bffd557fbb49">ThinOrFullLTOPhase</a> LTOPhase = ThinOrFullLTOPhase::None)</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>      : <a class="code hl_class" href="classllvm_1_1ModulePass.html">ModulePass</a>(<a class="code hl_typedef" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">ID</a>), SampleLoader(</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>                            <a class="code hl_variable" href="ELFObjHandler_8cpp.html#adc852f586959ce13117d737cf3f14899">Name</a>, <a class="code hl_variable" href="SampleProfile_8cpp.html#af8d3791537a44c00b699d28c4d978d82">SampleProfileRemappingFile</a>, LTOPhase,</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>                            [&amp;](<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a class="code hl_class" href="classllvm_1_1AssumptionCache.html">AssumptionCache</a> &amp; {</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>                              <span class="keywordflow">return</span> ACT-&gt;getAssumptionCache(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>                            },</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>                            [&amp;](<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a class="code hl_class" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp; {</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>                              <span class="keywordflow">return</span> TTIWP-&gt;getTTI(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>                            },</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>                            [&amp;](<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a class="code hl_class" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp; {</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>                              <span class="keywordflow">return</span> TLIWP-&gt;getTLI(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>                            }) {</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>    <a class="code hl_function" href="namespacellvm.html#ad579b1aaccc266c26012224c61ce29da">initializeSampleProfileLoaderLegacyPassPass</a>(</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>        *<a class="code hl_function" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>  }</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span> </div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>  <span class="keywordtype">void</span> <a class="code hl_function" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() { SampleLoader.dump(); }</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span> </div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>  <span class="keywordtype">bool</span> doInitialization(<a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;M)<span class="keyword"> override </span>{</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>    <span class="keywordflow">return</span> SampleLoader.doInitialization(M);</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>  }</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span> </div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>  <a class="code hl_class" href="classllvm_1_1StringRef.html">StringRef</a> getPassName()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;Sample profile pass&quot;</span>; }</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>  <span class="keywordtype">bool</span> runOnModule(<a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;M) <span class="keyword">override</span>;</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span> </div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>  <span class="keywordtype">void</span> getAnalysisUsage(<a class="code hl_class" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const override </span>{</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>    AU.<a class="code hl_function" href="classllvm_1_1AnalysisUsage.html#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a class="code hl_class" href="classllvm_1_1AssumptionCacheTracker.html">AssumptionCacheTracker</a>&gt;();</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    AU.<a class="code hl_function" href="classllvm_1_1AnalysisUsage.html#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a class="code hl_class" href="classllvm_1_1TargetTransformInfoWrapperPass.html">TargetTransformInfoWrapperPass</a>&gt;();</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    AU.<a class="code hl_function" href="classllvm_1_1AnalysisUsage.html#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a class="code hl_class" href="classllvm_1_1TargetLibraryInfoWrapperPass.html">TargetLibraryInfoWrapperPass</a>&gt;();</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>    AU.<a class="code hl_function" href="classllvm_1_1AnalysisUsage.html#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a class="code hl_class" href="classllvm_1_1ProfileSummaryInfoWrapperPass.html">ProfileSummaryInfoWrapperPass</a>&gt;();</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>  }</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span> </div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>  SampleProfileLoader SampleLoader;</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>  <a class="code hl_class" href="classllvm_1_1AssumptionCacheTracker.html">AssumptionCacheTracker</a> *ACT = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>  <a class="code hl_class" href="classllvm_1_1TargetTransformInfoWrapperPass.html">TargetTransformInfoWrapperPass</a> *TTIWP = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>  <a class="code hl_class" href="classllvm_1_1TargetLibraryInfoWrapperPass.html">TargetLibraryInfoWrapperPass</a> *TLIWP = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>};</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span> </div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span><span class="comment"></span> </div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span><span class="comment">/// Return true if the given callsite is hot wrt to hot cutoff threshold.</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span><span class="comment">///</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span><span class="comment">/// Functions that were inlined in the original binary will be represented</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span><span class="comment">/// in the inline stack in the sample profile. If the profile shows that</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span><span class="comment">/// the original inline decision was &quot;good&quot; (i.e., the callsite is executed</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span><span class="comment">/// frequently), then we will recreate the inline decision and apply the</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span><span class="comment">/// profile from the inlined callsite.</span></div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span><span class="comment">///</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span><span class="comment">/// To decide whether an inlined callsite is hot, we compare the callsite</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span><span class="comment">/// sample count with the hot cutoff computed by ProfileSummaryInfo, it is</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span><span class="comment">/// regarded as hot if the count is above the cutoff value.</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span><span class="comment">///</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span><span class="comment">/// When ProfileAccurateForSymsInList is enabled and profile symbol list</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span><span class="comment">/// is present, functions in the profile symbol list but without profile will</span></div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span><span class="comment">/// be regarded as cold and much less inlining will happen in CGSCC inlining</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span><span class="comment">/// pass, so we tend to lower the hot criteria here to allow more early</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span><span class="comment">/// inlining to happen for warm callsites and it is helpful for performance.</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span><span class="comment"></span><span class="keywordtype">bool</span> SampleProfileLoader::callsiteIsHot(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CallsiteFS</a>,</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>                                        <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI) {</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>  <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CallsiteFS</a>)</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// The callsite was not inlined in the original binary.</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span> </div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>  <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PSI &amp;&amp; <span class="stringliteral">&quot;PSI is expected to be non null&quot;</span>);</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>  uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CallsiteTotalSamples</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CallsiteFS</a>-&gt;getTotalSamples();</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>  <span class="keywordflow">if</span> (ProfAccForSymsInList)</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>    <span class="keywordflow">return</span> !PSI-&gt;<a class="code hl_function" href="classllvm_1_1ProfileSummaryInfo.html#a5f58eb949321536363605ac9920a95cb">isColdCount</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CallsiteTotalSamples</a>);</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>    <span class="keywordflow">return</span> PSI-&gt;<a class="code hl_function" href="classllvm_1_1ProfileSummaryInfo.html#ac46d4d55dd867977ba88d57a170e31de">isHotCount</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CallsiteTotalSamples</a>);</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>}</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span><span class="comment"></span> </div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span><span class="comment">/// Mark as used the sample record for the given function samples at</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span><span class="comment">/// (LineOffset, Discriminator).</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span><span class="comment">///</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span><span class="comment">/// \returns true if this is the first time we mark the given record.</span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span><span class="comment"></span><span class="keywordtype">bool</span> SampleCoverageTracker::markSamplesUsed(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *FS,</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>                                            <a class="code hl_class" href="classuint32__t.html">uint32_t</a> LineOffset,</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>                                            <a class="code hl_class" href="classuint32__t.html">uint32_t</a> Discriminator,</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>                                            uint64_t Samples) {</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>  <a class="code hl_struct" href="structllvm_1_1sampleprof_1_1LineLocation.html">LineLocation</a> Loc(LineOffset, Discriminator);</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>  <span class="keywordtype">unsigned</span> &amp;Count = SampleCoverage[<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>][Loc];</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FirstTime</a> = (++Count == 1);</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>  <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FirstTime</a>)</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>    TotalUsedSamples += Samples;</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>  <span class="keywordflow">return</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FirstTime</a>;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>}</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span><span class="comment"></span> </div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span><span class="comment">/// Return the number of sample records that were applied from this profile.</span></div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span><span class="comment">///</span></div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span><span class="comment">/// This count does not include records from cold inlined callsites.</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span><span class="comment"></span><span class="keywordtype">unsigned</span></div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>SampleCoverageTracker::countUsedRecords(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *FS,</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>                                        <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>  <span class="keyword">auto</span> <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = SampleCoverage.find(FS);</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span> </div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>  <span class="comment">// The size of the coverage map for FS represents the number of records</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>  <span class="comment">// that were marked used at least once.</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>  <span class="keywordtype">unsigned</span> Count = (<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != SampleCoverage.end()) ? <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.size() : 0;</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span> </div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>  <span class="comment">// If there are inlined callsites in this function, count the samples found</span></div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>  <span class="comment">// in the respective bodies. However, do not bother counting callees with 0</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>  <span class="comment">// total samples, these are callees that were never invoked at runtime.</span></div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getCallsiteSamples())</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>    <a class="code hl_function" href="BasicBlockSections_8cpp.html#a5e5c642a0309c0657f3efa8a8b687008">for</a> (<a class="code hl_variable" href="AArch64PromoteConstant_8cpp.html#a90f8350fecae261c25be85d38b451bff">const</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">auto</a> &amp;J : <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second) {</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>      <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *CalleeSamples = &amp;J.second;</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>      <span class="keywordflow">if</span> (SPLoader.callsiteIsHot(CalleeSamples, PSI))</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>        Count += <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">countUsedRecords</a>(CalleeSamples, PSI);</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>    }</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span> </div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>  <span class="keywordflow">return</span> Count;</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>}</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span><span class="comment"></span> </div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span><span class="comment">/// Return the number of sample records in the body of this profile.</span></div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span><span class="comment">///</span></div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span><span class="comment">/// This count does not include records from cold inlined callsites.</span></div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span><span class="comment"></span><span class="keywordtype">unsigned</span></div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>SampleCoverageTracker::countBodyRecords(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *FS,</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>                                        <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>  <span class="keywordtype">unsigned</span> Count = <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getBodySamples().size();</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span> </div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>  <span class="comment">// Only count records in hot callsites.</span></div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getCallsiteSamples())</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    <a class="code hl_function" href="BasicBlockSections_8cpp.html#a5e5c642a0309c0657f3efa8a8b687008">for</a> (<a class="code hl_variable" href="AArch64PromoteConstant_8cpp.html#a90f8350fecae261c25be85d38b451bff">const</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">auto</a> &amp;J : <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second) {</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>      <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *CalleeSamples = &amp;J.second;</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>      <span class="keywordflow">if</span> (SPLoader.callsiteIsHot(CalleeSamples, PSI))</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>        Count += <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">countBodyRecords</a>(CalleeSamples, PSI);</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    }</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span> </div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>  <span class="keywordflow">return</span> Count;</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>}</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span><span class="comment"></span> </div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span><span class="comment">/// Return the number of samples collected in the body of this profile.</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span><span class="comment">///</span></div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span><span class="comment">/// This count does not include samples from cold inlined callsites.</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span><span class="comment"></span>uint64_t</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>SampleCoverageTracker::countBodySamples(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *FS,</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>                                        <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>  uint64_t Total = 0;</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getBodySamples())</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>    Total += <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second.getSamples();</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span> </div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>  <span class="comment">// Only count samples in hot callsites.</span></div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getCallsiteSamples())</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>    <a class="code hl_function" href="BasicBlockSections_8cpp.html#a5e5c642a0309c0657f3efa8a8b687008">for</a> (<a class="code hl_variable" href="AArch64PromoteConstant_8cpp.html#a90f8350fecae261c25be85d38b451bff">const</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">auto</a> &amp;J : <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second) {</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>      <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *CalleeSamples = &amp;J.second;</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>      <span class="keywordflow">if</span> (SPLoader.callsiteIsHot(CalleeSamples, PSI))</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>        Total += <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">countBodySamples</a>(CalleeSamples, PSI);</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>    }</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span> </div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>  <span class="keywordflow">return</span> Total;</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>}</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span><span class="comment"></span> </div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span><span class="comment">/// Return the fraction of sample records used in this profile.</span></div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span><span class="comment">///</span></div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span><span class="comment">/// The returned value is an unsigned integer in the range 0-100 indicating</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span><span class="comment">/// the percentage of sample records that were used while applying this</span></div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span><span class="comment">/// profile to the associated function.</span></div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span><span class="comment"></span><span class="keywordtype">unsigned</span> SampleCoverageTracker::computeCoverage(<span class="keywordtype">unsigned</span> Used,</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>                                                <span class="keywordtype">unsigned</span> Total)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>  <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Used &lt;= Total &amp;&amp;</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>         <span class="stringliteral">&quot;number of used records cannot exceed the total number of records&quot;</span>);</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>  <span class="keywordflow">return</span> Total &gt; 0 ? Used * 100 / Total : 100;</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>}</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span><span class="comment"></span> </div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span><span class="comment">/// Clear all the per-function data used to load samples and propagate weights.</span></div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span><span class="comment"></span><span class="keywordtype">void</span> SampleProfileLoader::clearFunctionData() {</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>  BlockWeights.clear();</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>  EdgeWeights.clear();</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>  VisitedBlocks.clear();</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>  VisitedEdges.clear();</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>  EquivalenceClass.clear();</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>  DT = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>  PDT = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>  LI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>  Predecessors.clear();</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>  Successors.clear();</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>  CoverageTracker.clear();</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>}</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span> </div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span><span class="preprocessor">#ifndef NDEBUG</span><span class="comment"></span></div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span><span class="comment">/// Print the weight of edge \p E on stream \p OS.</span></div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span><span class="comment">///</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span><span class="comment">/// \param OS  Stream to emit the output to.</span></div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span><span class="comment">/// \param E  Edge to print.</span></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span><span class="comment"></span><span class="keywordtype">void</span> SampleProfileLoader::printEdgeWeight(<a class="code hl_class" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS, Edge <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>) {</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>  OS &lt;&lt; <span class="stringliteral">&quot;weight[&quot;</span> &lt;&lt; <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>.first-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;-&gt;&quot;</span> &lt;&lt; <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>.second-&gt;getName()</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>     &lt;&lt; <span class="stringliteral">&quot;]: &quot;</span> &lt;&lt; EdgeWeights[<a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>}</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span><span class="comment"></span> </div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span><span class="comment">/// Print the equivalence class of block \p BB on stream \p OS.</span></div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span><span class="comment">///</span></div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span><span class="comment">/// \param OS  Stream to emit the output to.</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span><span class="comment">/// \param BB  Block to print.</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span><span class="comment"></span><span class="keywordtype">void</span> SampleProfileLoader::printBlockEquivalence(<a class="code hl_class" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS,</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>                                                <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB) {</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Equiv</a> = EquivalenceClass[BB];</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>  OS &lt;&lt; <span class="stringliteral">&quot;equivalence[&quot;</span> &lt;&lt; BB-&gt;<a class="code hl_function" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>     &lt;&lt; <span class="stringliteral">&quot;]: &quot;</span> &lt;&lt; ((<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Equiv</a>) ? EquivalenceClass[BB]-&gt;<a class="code hl_function" href="ProvenanceAnalysisEvaluator_8cpp.html#a2ee79648e8bce3ddbb26358ff10e3e82">getName</a>() : <span class="stringliteral">&quot;NONE&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>}</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span><span class="comment"></span> </div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span><span class="comment">/// Print the weight of block \p BB on stream \p OS.</span></div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span><span class="comment">///</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span><span class="comment">/// \param OS  Stream to emit the output to.</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span><span class="comment">/// \param BB  Block to print.</span></div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span><span class="comment"></span><span class="keywordtype">void</span> SampleProfileLoader::printBlockWeight(<a class="code hl_class" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS,</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>                                           <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>  <span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BlockWeights.find(BB);</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>  uint64_t <a class="code hl_enumvalue" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf">W</a> = (<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == BlockWeights.end() ? 0 : <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second);</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>  OS &lt;&lt; <span class="stringliteral">&quot;weight[&quot;</span> &lt;&lt; BB-&gt;<a class="code hl_function" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; <span class="stringliteral">&quot;]: &quot;</span> &lt;&lt; <a class="code hl_enumvalue" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf">W</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>}</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span><span class="comment"></span> </div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span><span class="comment">/// Get the weight for an instruction.</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span><span class="comment">///</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span><span class="comment">/// The &quot;weight&quot; of an instruction \p Inst is the number of samples</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span><span class="comment">/// collected on that instruction at runtime. To retrieve it, we</span></div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span><span class="comment">/// need to compute the line number of \p Inst relative to the start of its</span></div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span><span class="comment">/// function. We use HeaderLineno to compute the offset. We then</span></div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span><span class="comment">/// look up the samples collected for \p Inst using BodySamples.</span></div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span><span class="comment">///</span></div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span><span class="comment">/// \param Inst Instruction to query.</span></div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span><span class="comment">///</span></div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span><span class="comment">/// \returns the weight of \p Inst.</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span><span class="comment"></span><a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a> SampleProfileLoader::getInstWeight(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1Instruction.html">Instruction</a> &amp;Inst) {</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa37fe7429ffcf70c306c27a55d714d31">FunctionSamples::ProfileIsProbeBased</a>)</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>    <span class="keywordflow">return</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getProbeWeight</a>(Inst);</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span> </div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1DebugLoc.html">DebugLoc</a> &amp;DLoc = Inst.<a class="code hl_function" href="classllvm_1_1Instruction.html#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>();</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>  <span class="keywordflow">if</span> (!DLoc)</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>    <span class="keywordflow">return</span> std::error_code();</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span> </div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a> = findFunctionSamples(Inst);</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>  <span class="keywordflow">if</span> (!FS)</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>    <span class="keywordflow">return</span> std::error_code();</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span> </div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>  <span class="comment">// Ignore all intrinsics, phinodes and branch instructions.</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>  <span class="comment">// Branch and phinodes instruction usually contains debug info from sources outside of</span></div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>  <span class="comment">// the residing basic block, thus we ignore them during annotation.</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>  <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;BranchInst&gt;</a>(Inst) || <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;IntrinsicInst&gt;</a>(Inst) || <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;PHINode&gt;</a>(Inst))</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>    <span class="keywordflow">return</span> std::error_code();</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span> </div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>  <span class="comment">// If a direct call/invoke instruction is inlined in profile</span></div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>  <span class="comment">// (findCalleeFunctionSamples returns non-empty result), but not inlined here,</span></div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>  <span class="comment">// it means that the inlined callsite has no sample, thus the call</span></div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>  <span class="comment">// instruction should have 0 count.</span></div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>  <span class="keywordflow">if</span> (!ProfileIsCS)</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *CB = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">dyn_cast&lt;CallBase&gt;</a>(&amp;Inst))</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>      <span class="keywordflow">if</span> (!CB-&gt;isIndirectCall() &amp;&amp; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findCalleeFunctionSamples</a>(*CB))</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span> </div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1DILocation.html">DILocation</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a> = DLoc;</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>  <a class="code hl_class" href="classuint32__t.html">uint32_t</a> LineOffset = <a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#ab6f00f222e6f6d30bc6a0fc7bf8396de">FunctionSamples::getOffset</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>);</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>  <a class="code hl_class" href="classuint32__t.html">uint32_t</a> Discriminator = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>-&gt;getBaseDiscriminator();</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a> R = <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;findSamplesAt(LineOffset, Discriminator);</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>  <span class="keywordflow">if</span> (R) {</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>    <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FirstMark</a> =</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>        CoverageTracker.markSamplesUsed(FS, LineOffset, Discriminator, R.get());</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FirstMark</a>) {</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>      ORE-&gt;<a class="code hl_function" href="classllvm_1_1OptimizationRemarkEmitter.html#aae6a98aea85aa3af87357cc5448db499">emit</a>([&amp;]() {</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>        <a class="code hl_class" href="classllvm_1_1OptimizationRemarkAnalysis.html">OptimizationRemarkAnalysis</a> <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a>(<a class="code hl_define" href="BlockFrequencyInfoImpl_8h.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>, <span class="stringliteral">&quot;AppliedSamples&quot;</span>, &amp;Inst);</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <span class="stringliteral">&quot;Applied &quot;</span> &lt;&lt; <a class="code hl_typedef" href="namespacellvm_1_1ore.html#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(<span class="stringliteral">&quot;NumSamples&quot;</span>, *R);</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <span class="stringliteral">&quot; samples from profile (offset: &quot;</span>;</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <a class="code hl_typedef" href="namespacellvm_1_1ore.html#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(<span class="stringliteral">&quot;LineOffset&quot;</span>, LineOffset);</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>        <span class="keywordflow">if</span> (Discriminator) {</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>          <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>;</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>          <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <a class="code hl_typedef" href="namespacellvm_1_1ore.html#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(<span class="stringliteral">&quot;Discriminator&quot;</span>, Discriminator);</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>        }</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a>;</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>      });</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>    }</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>    <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; DLoc.<a class="code hl_function" href="classllvm_1_1DebugLoc.html#a427c256af834975c7869ad28fac00563">getLine</a>() &lt;&lt; <span class="stringliteral">&quot;.&quot;</span></div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>                      &lt;&lt; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>-&gt;getBaseDiscriminator() &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; Inst</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>                      &lt;&lt; <span class="stringliteral">&quot; (line offset: &quot;</span> &lt;&lt; LineOffset &lt;&lt; <span class="stringliteral">&quot;.&quot;</span></div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>                      &lt;&lt; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>-&gt;getBaseDiscriminator() &lt;&lt; <span class="stringliteral">&quot; - weight: &quot;</span> &lt;&lt; R.get()</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>                      &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>  }</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>  <span class="keywordflow">return</span> R;</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>}</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span> </div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span><a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a> SampleProfileLoader::getProbeWeight(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1Instruction.html">Instruction</a> &amp;Inst) {</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>  <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code hl_variable" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa37fe7429ffcf70c306c27a55d714d31">FunctionSamples::ProfileIsProbeBased</a> &amp;&amp;</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>         <span class="stringliteral">&quot;Profile is not pseudo probe based&quot;</span>);</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Optional&lt;PseudoProbe&gt;</a> Probe = <a class="code hl_function" href="namespacellvm.html#a00fba4013f1a5b882b91cad397791f9f">extractProbe</a>(Inst);</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>  <span class="keywordflow">if</span> (!Probe)</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>    <span class="keywordflow">return</span> std::error_code();</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span> </div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a> = findFunctionSamples(Inst);</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>  <span class="keywordflow">if</span> (!FS)</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>    <span class="keywordflow">return</span> std::error_code();</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span> </div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>  <span class="comment">// If a direct call/invoke instruction is inlined in profile</span></div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>  <span class="comment">// (findCalleeFunctionSamples returns non-empty result), but not inlined here,</span></div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>  <span class="comment">// it means that the inlined callsite has no sample, thus the call</span></div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>  <span class="comment">// instruction should have 0 count.</span></div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>  <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *CB = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">dyn_cast&lt;CallBase&gt;</a>(&amp;Inst))</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>    <span class="keywordflow">if</span> (!CB-&gt;isIndirectCall() &amp;&amp; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findCalleeFunctionSamples</a>(*CB))</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span> </div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a> &amp;R = <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;findSamplesAt(Probe-&gt;Id, 0);</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>  <span class="keywordflow">if</span> (R) {</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>    uint64_t Samples = R.get() * Probe-&gt;Factor;</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>    <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FirstMark</a> = CoverageTracker.markSamplesUsed(FS, Probe-&gt;Id, 0, Samples);</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FirstMark</a>) {</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>      ORE-&gt;<a class="code hl_function" href="classllvm_1_1OptimizationRemarkEmitter.html#aae6a98aea85aa3af87357cc5448db499">emit</a>([&amp;]() {</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>        <a class="code hl_class" href="classllvm_1_1OptimizationRemarkAnalysis.html">OptimizationRemarkAnalysis</a> <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a>(<a class="code hl_define" href="BlockFrequencyInfoImpl_8h.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>, <span class="stringliteral">&quot;AppliedSamples&quot;</span>, &amp;Inst);</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <span class="stringliteral">&quot;Applied &quot;</span> &lt;&lt; <a class="code hl_typedef" href="namespacellvm_1_1ore.html#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(<span class="stringliteral">&quot;NumSamples&quot;</span>, Samples);</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <span class="stringliteral">&quot; samples from profile (ProbeId=&quot;</span>;</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <a class="code hl_typedef" href="namespacellvm_1_1ore.html#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(<span class="stringliteral">&quot;ProbeId&quot;</span>, Probe-&gt;Id);</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <span class="stringliteral">&quot;, Factor=&quot;</span>;</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <a class="code hl_typedef" href="namespacellvm_1_1ore.html#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(<span class="stringliteral">&quot;Factor&quot;</span>, Probe-&gt;Factor);</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <span class="stringliteral">&quot;, OriginalSamples=&quot;</span>;</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <a class="code hl_typedef" href="namespacellvm_1_1ore.html#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(<span class="stringliteral">&quot;OriginalSamples&quot;</span>, R.get());</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>        <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">Remark</a>;</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>      });</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>    }</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>    <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; Probe-&gt;Id &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; Inst</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>                      &lt;&lt; <span class="stringliteral">&quot; - weight: &quot;</span> &lt;&lt; R.get() &lt;&lt; <span class="stringliteral">&quot; - factor: &quot;</span></div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>                      &lt;&lt; <a class="code hl_function" href="namespacellvm.html#a939bc2108d47080767f0c06ba56caec7">format</a>(<span class="stringliteral">&quot;%0.2f&quot;</span>, Probe-&gt;Factor) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>    <span class="keywordflow">return</span> Samples;</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>  }</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>  <span class="keywordflow">return</span> R;</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>}</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span><span class="comment"></span> </div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span><span class="comment">/// Compute the weight of a basic block.</span></div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span><span class="comment">///</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span><span class="comment">/// The weight of basic block \p BB is the maximum weight of all the</span></div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span><span class="comment">/// instructions in BB.</span></div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span><span class="comment">///</span></div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span><span class="comment">/// \param BB The basic block to query.</span></div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span><span class="comment">///</span></div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span><span class="comment">/// \returns the weight for \p BB.</span></div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span><span class="comment"></span><a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a> SampleProfileLoader::getBlockWeight(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB) {</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>  uint64_t <a class="code hl_enumvalue" href="namespacellvm_1_1pdb.html#a81a0fae24e6bdfe240da4249a8da5978a6a061313d22e51e0f25b7cd4dc065233">Max</a> = 0;</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">HasWeight</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB-&gt;getInstList()) {</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a> &amp;R = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getInstWeight</a>(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    <span class="keywordflow">if</span> (R) {</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>      <a class="code hl_enumvalue" href="namespacellvm_1_1pdb.html#a81a0fae24e6bdfe240da4249a8da5978a6a061313d22e51e0f25b7cd4dc065233">Max</a> = std::max(Max, R.get());</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">HasWeight</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>    }</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>  }</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>  <span class="keywordflow">return</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">HasWeight</a> ? <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a>(Max) : <a class="code hl_namespace" href="namespacestd.html">std</a>::error_code();</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>}</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span><span class="comment"></span> </div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span><span class="comment">/// Compute and store the weights of every basic block.</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span><span class="comment">///</span></div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span><span class="comment">/// This populates the BlockWeights map by computing</span></div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span><span class="comment">/// the weights of every basic block in the CFG.</span></div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span><span class="comment">///</span></div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span><span class="comment">/// \param F The function to query.</span></div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span><span class="comment"></span><span class="keywordtype">bool</span> SampleProfileLoader::computeBlockWeights(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>  <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Block weights\n&quot;</span>);</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;BB : <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a> Weight = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getBlockWeight</a>(&amp;BB);</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>    <span class="keywordflow">if</span> (Weight) {</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>      BlockWeights[&amp;BB] = Weight.get();</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>      VisitedBlocks.insert(&amp;BB);</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>      <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>    }</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>    <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">printBlockWeight</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), &amp;BB));</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>  }</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span> </div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a>;</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>}</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span><span class="comment"></span> </div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span><span class="comment">/// Get the FunctionSamples for a call instruction.</span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span><span class="comment">///</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span><span class="comment">/// The FunctionSamples of a call/invoke instruction \p Inst is the inlined</span></div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span><span class="comment">/// instance in which that call instruction is calling to. It contains</span></div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span><span class="comment">/// all samples that resides in the inlined instance. We first find the</span></div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span><span class="comment">/// inlined instance in which the call instruction is from, then we</span></div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span><span class="comment">/// traverse its children to find the callsite with the matching</span></div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span><span class="comment">/// location.</span></div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span><span class="comment">///</span></div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span><span class="comment">/// \param Inst Call/Invoke instruction to query.</span></div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span><span class="comment">///</span></div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span><span class="comment">/// \returns The FunctionSamples pointer to the inlined instance.</span></div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span><span class="comment"></span><span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>SampleProfileLoader::findCalleeFunctionSamples(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1CallBase.html">CallBase</a> &amp;Inst)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1DILocation.html">DILocation</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a> = Inst.<a class="code hl_function" href="classllvm_1_1Instruction.html#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>();</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>  <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>) {</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>  }</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span> </div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>  <a class="code hl_class" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalleeName</a>;</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>  <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> = Inst.<a class="code hl_function" href="classllvm_1_1CallBase.html#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>())</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalleeName</a> = <a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa7122a07ea48e47fc71083e68b829003">FunctionSamples::getCanonicalFnName</a>(*<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>);</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span> </div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>  <span class="keywordflow">if</span> (ProfileIsCS)</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>    <span class="keywordflow">return</span> ContextTracker-&gt;getCalleeContextSamplesFor(Inst, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalleeName</a>);</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span> </div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a> = findFunctionSamples(Inst);</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>  <span class="keywordflow">if</span> (FS == <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span> </div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;findFunctionSamplesAt(<a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#ad38ceb01e0a46ee074bf51d9fb136d8f">FunctionSamples::getCallSiteIdentifier</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>),</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>                                   <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalleeName</a>, Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a530222c3b645acc9170003d046753e94">getRemapper</a>());</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>}</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span><span class="comment"></span> </div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span><span class="comment">/// Returns a vector of FunctionSamples that are the indirect call targets</span></div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span><span class="comment">/// of \p Inst. The vector is sorted by the total number of samples. Stores</span></div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span><span class="comment">/// the total call count of the indirect call in \p Sum.</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span><span class="comment"></span>std::vector&lt;const FunctionSamples *&gt;</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>SampleProfileLoader::findIndirectCallFunctionSamples(</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>    <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1Instruction.html">Instruction</a> &amp;Inst, uint64_t &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1DILocation.html">DILocation</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a> = Inst.<a class="code hl_function" href="classllvm_1_1Instruction.html#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>();</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>  std::vector&lt;const FunctionSamples *&gt; R;</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span> </div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>  <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>) {</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>    <span class="keywordflow">return</span> R;</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>  }</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span> </div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>  <span class="keyword">auto</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FSCompare</a> = [](<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *L, <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *R) {</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>    <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L &amp;&amp; R &amp;&amp; <span class="stringliteral">&quot;Expect non-null FunctionSamples&quot;</span>);</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    <span class="keywordflow">if</span> (L-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aac9d9812a5a2e1902e92b485bbf6819b">getEntrySamples</a>() != R-&gt;getEntrySamples())</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>      <span class="keywordflow">return</span> L-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aac9d9812a5a2e1902e92b485bbf6819b">getEntrySamples</a>() &gt; R-&gt;getEntrySamples();</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#a2b2898e95dd1947ace149447cb9ef137">FunctionSamples::getGUID</a>(L-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#afb88e30fa94efb7c7f12c84b52b61b3d">getName</a>()) &lt;</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>           <a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#a2b2898e95dd1947ace149447cb9ef137">FunctionSamples::getGUID</a>(R-&gt;getName());</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>  };</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span> </div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>  <span class="keywordflow">if</span> (ProfileIsCS) {</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>    <span class="keyword">auto</span> CalleeSamples =</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>        ContextTracker-&gt;getIndirectCalleeContextSamplesFor(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>);</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>    <span class="keywordflow">if</span> (CalleeSamples.empty())</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>      <span class="keywordflow">return</span> R;</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span> </div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    <span class="comment">// For CSSPGO, we only use target context profile&#39;s entry count</span></div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>    <span class="comment">// as that already includes both inlined callee and non-inlined ones..</span></div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a> = 0;</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *<span class="keyword">const</span> FS : CalleeSamples) {</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a> += <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getEntrySamples();</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>      R.push_back(FS);</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>    }</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>    <a class="code hl_function" href="namespacellvm.html#a830041552b81a6cea1f497490d0f41d9">llvm::sort</a>(R, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FSCompare</a>);</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>    <span class="keywordflow">return</span> R;</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>  }</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span> </div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a> = findFunctionSamples(Inst);</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>  <span class="keywordflow">if</span> (FS == <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>    <span class="keywordflow">return</span> R;</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span> </div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>  <span class="keyword">auto</span> <a class="code hl_enumvalue" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bad7a2c9c146ac9c6636e1a009ca1e9413">CallSite</a> = <a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#ad38ceb01e0a46ee074bf51d9fb136d8f">FunctionSamples::getCallSiteIdentifier</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>);</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>  <span class="keyword">auto</span> <a class="code hl_class" href="classT.html">T</a> = <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;findCallTargetMapAt(CallSite);</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a> = 0;</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>  <span class="keywordflow">if</span> (<a class="code hl_class" href="classT.html">T</a>)</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">T_C</a> : <a class="code hl_class" href="classT.html">T</a>.get())</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a> += <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">T_C</a>.second;</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code hl_typedef" href="namespacellvm_1_1sampleprof.html#a659a52f7008b83957eb326a57a737cf9">FunctionSamplesMap</a> *M = <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;findFunctionSamplesMapAt(CallSite)) {</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>    <span class="keywordflow">if</span> (M-&gt;empty())</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>      <span class="keywordflow">return</span> R;</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NameFS</a> : *M) {</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a> += <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NameFS</a>.second.getEntrySamples();</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>      R.push_back(&amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NameFS</a>.second);</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>    }</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>    <a class="code hl_function" href="namespacellvm.html#a830041552b81a6cea1f497490d0f41d9">llvm::sort</a>(R, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FSCompare</a>);</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>  }</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>  <span class="keywordflow">return</span> R;</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>}</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span><span class="comment"></span> </div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span><span class="comment">/// Get the FunctionSamples for an instruction.</span></div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span><span class="comment">///</span></div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span><span class="comment">/// The FunctionSamples of an instruction \p Inst is the inlined instance</span></div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span><span class="comment">/// in which that instruction is coming from. We traverse the inline stack</span></div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span><span class="comment">/// of that instruction, and match it with the tree nodes in the profile.</span></div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span><span class="comment">///</span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span><span class="comment">/// \param Inst Instruction to query.</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span><span class="comment">///</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span><span class="comment">/// \returns the FunctionSamples pointer to the inlined instance.</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span><span class="comment"></span><span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>SampleProfileLoader::findFunctionSamples(<span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1Instruction.html">Instruction</a> &amp;Inst)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa37fe7429ffcf70c306c27a55d714d31">FunctionSamples::ProfileIsProbeBased</a>) {</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Optional&lt;PseudoProbe&gt;</a> Probe = <a class="code hl_function" href="namespacellvm.html#a00fba4013f1a5b882b91cad397791f9f">extractProbe</a>(Inst);</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>    <span class="keywordflow">if</span> (!Probe)</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>  }</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span> </div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1DILocation.html">DILocation</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a> = Inst.<a class="code hl_function" href="classllvm_1_1Instruction.html#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>();</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>  <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>)</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>    <span class="keywordflow">return</span> Samples;</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span> </div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>  <span class="keyword">auto</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">it</a> = DILocation2SampleMap.try_emplace(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>,<span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>  <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">it</a>.second) {</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>    <span class="keywordflow">if</span> (ProfileIsCS)</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">it</a>.first-&gt;second = ContextTracker-&gt;getContextSamplesFor(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>);</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">it</a>.first-&gt;second =</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>          Samples-&gt;findFunctionSamples(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>, Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a530222c3b645acc9170003d046753e94">getRemapper</a>());</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>  }</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>  <span class="keywordflow">return</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">it</a>.first-&gt;second;</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>}</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span><span class="comment"></span> </div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span><span class="comment">/// Attempt to promote indirect call and also inline the promoted call.</span></div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span><span class="comment">///</span></div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span><span class="comment">/// \param F  Caller function.</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span><span class="comment">/// \param Candidate  ICP and inline candidate.</span></div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span><span class="comment">/// \param Sum  Sum of target counts for indirect call.</span></div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span><span class="comment">/// \param PromotedInsns  Map to keep track of indirect call already processed.</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span><span class="comment">/// \param Candidate  ICP and inline candidate.</span></div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span><span class="comment">/// \param InlinedCallSite  Output vector for new call sites exposed after</span></div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span><span class="comment">/// inlining.</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span><span class="comment"></span><span class="keywordtype">bool</span> SampleProfileLoader::tryPromoteAndInlineCandidate(</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>    <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, InlineCandidate &amp;Candidate, uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SumOrigin</a>, uint64_t &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>,</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseSet&lt;Instruction *&gt;</a> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">PromotedInsns</a>,</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;CallBase *, 8&gt;</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedCallSite</a>) {</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *Reason = <span class="stringliteral">&quot;Callee function not available&quot;</span>;</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>  <span class="comment">// R-&gt;getValue() != &amp;F is to prevent promoting a recursive call.</span></div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>  <span class="comment">// If it is a recursive call, we do not inline it as it could bloat</span></div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>  <span class="comment">// the code exponentially. There is way to better handle this, e.g.</span></div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>  <span class="comment">// clone the caller first, and inline the cloned caller if it is</span></div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>  <span class="comment">// recursive. As llvm does not inline recursive calls, we will</span></div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>  <span class="comment">// simply ignore it instead of handling it explicitly.</span></div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>  <span class="keyword">auto</span> R = SymbolMap.find(Candidate.CalleeSamples-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa9a46c80625ff1813b321b3a1d46ee37">getFuncName</a>());</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>  <span class="keywordflow">if</span> (R != SymbolMap.end() &amp;&amp; R-&gt;getValue() &amp;&amp;</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>      !R-&gt;getValue()-&gt;isDeclaration() &amp;&amp; R-&gt;getValue()-&gt;getSubprogram() &amp;&amp;</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>      R-&gt;getValue()-&gt;hasFnAttribute(<span class="stringliteral">&quot;use-sample-profile&quot;</span>) &amp;&amp;</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>      R-&gt;getValue() != &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> &amp;&amp;</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>      <a class="code hl_function" href="namespacellvm.html#a0e5b9e42ea84622605acea0b0d721fda">isLegalToPromote</a>(*Candidate.CallInstr, R-&gt;getValue(), &amp;Reason)) {</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>    <span class="keyword">auto</span> *DI =</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>        &amp;<a class="code hl_function" href="namespacellvm_1_1pgo.html#ac3ab1f99a5d99ba23fcfec6044ebc805">pgo::promoteIndirectCall</a>(*Candidate.CallInstr, R-&gt;getValue(),</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>                                  Candidate.CallsiteCount, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>, <span class="keyword">false</span>, ORE);</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>    <span class="keywordflow">if</span> (DI) {</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a> -= Candidate.CallsiteCount;</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>      <span class="comment">// Prorate the indirect callsite distribution.</span></div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>      <span class="comment">// Do not update the promoted direct callsite distribution at this</span></div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>      <span class="comment">// point since the original distribution combined with the callee</span></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>      <span class="comment">// profile will be used to prorate callsites from the callee if</span></div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>      <span class="comment">// inlined. Once not inlined, the direct callsite distribution should</span></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>      <span class="comment">// be prorated so that the it will reflect the real callsite counts.</span></div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>      <a class="code hl_function" href="namespacellvm.html#a4fb32c986b105bb7a53700e5988aab6e">setProbeDistributionFactor</a>(*Candidate.CallInstr,</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>                                 Candidate.CallsiteDistribution * <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a> /</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>                                     <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SumOrigin</a>);</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">PromotedInsns</a>.insert(Candidate.CallInstr);</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>      Candidate.CallInstr = DI;</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;CallInst&gt;</a>(DI) || <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;InvokeInst&gt;</a>(DI)) {</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>        <span class="keywordtype">bool</span> <a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#ad25a1310d512e19d2f6318e963dcb30bafc6d010fc5b3d8ff4400670e597c4e7b">Inlined</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">tryInlineCandidate</a>(Candidate, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedCallSite</a>);</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>        <span class="keywordflow">if</span> (!Inlined) {</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>          <span class="comment">// Prorate the direct callsite distribution so that it reflects real</span></div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>          <span class="comment">// callsite counts.</span></div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>          <a class="code hl_function" href="namespacellvm.html#a4fb32c986b105bb7a53700e5988aab6e">setProbeDistributionFactor</a>(*DI, Candidate.CallsiteDistribution *</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>                                              Candidate.CallsiteCount /</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>                                              <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SumOrigin</a>);</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>        }</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#ad25a1310d512e19d2f6318e963dcb30bafc6d010fc5b3d8ff4400670e597c4e7b">Inlined</a>;</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>      }</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>    }</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>    <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\nFailed to promote indirect call to &quot;</span></div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>                      &lt;&lt; Candidate.CalleeSamples-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa9a46c80625ff1813b321b3a1d46ee37">getFuncName</a>() &lt;&lt; <span class="stringliteral">&quot; because &quot;</span></div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>                      &lt;&lt; Reason &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>  }</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>}</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span> </div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span><span class="keywordtype">bool</span> SampleProfileLoader::shouldInlineColdCallee(<a class="code hl_class" href="classllvm_1_1CallBase.html">CallBase</a> &amp;<a class="code hl_class" href="classllvm_1_1CallInst.html">CallInst</a>) {</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SampleProfile_8cpp.html#ada8f2c564085d598909fb28464614812">ProfileSizeInline</a>)</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span> </div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>  <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> = <a class="code hl_class" href="classllvm_1_1CallInst.html">CallInst</a>.<a class="code hl_function" href="classllvm_1_1CallBase.html#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> == <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span> </div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>  <a class="code hl_class" href="classllvm_1_1InlineCost.html">InlineCost</a> Cost = <a class="code hl_function" href="namespacellvm.html#a5f5f248d08aa55c63e5bc7a8304a7319">getInlineCost</a>(<a class="code hl_class" href="classllvm_1_1CallInst.html">CallInst</a>, <a class="code hl_function" href="namespacellvm.html#aba7063dea024346c7b70099c63703f50">getInlineParams</a>(), GetTTI(*<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>),</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>                                  GetAC, GetTLI);</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span> </div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>  <span class="keywordflow">if</span> (Cost.isNever())</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span> </div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>  <span class="keywordflow">if</span> (Cost.isAlways())</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span> </div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>  <span class="keywordflow">return</span> Cost.getCost() &lt;= <a class="code hl_variable" href="SampleProfile_8cpp.html#a6c063cf654bf13a20d00365c2ef7b1da">SampleColdCallSiteThreshold</a>;</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>}</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span> </div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span><span class="keywordtype">void</span> SampleProfileLoader::emitOptimizationRemarksForInlineCandidates(</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>    <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVectorImpl&lt;CallBase *&gt;</a> &amp;Candidates, <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>    <span class="keywordtype">bool</span> Hot) {</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Candidates) {</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>    <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a> = <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getCalledFunction();</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a>) {</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>      ORE-&gt;<a class="code hl_function" href="classllvm_1_1OptimizationRemarkEmitter.html#aae6a98aea85aa3af87357cc5448db499">emit</a>(<a class="code hl_class" href="classllvm_1_1OptimizationRemarkAnalysis.html">OptimizationRemarkAnalysis</a>(<a class="code hl_define" href="SampleProfile_8cpp.html#ab4932d7673e6e1138d8a2671f16865d1">CSINLINE_DEBUG</a>, <span class="stringliteral">&quot;InlineAttempt&quot;</span>,</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>                                           <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc(), <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent())</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>                &lt;&lt; <span class="stringliteral">&quot;previous inlining reattempted for &quot;</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>                &lt;&lt; (Hot ? <span class="stringliteral">&quot;hotness: &#39;&quot;</span> : <span class="stringliteral">&quot;size: &#39;&quot;</span>)</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>                &lt;&lt; ore::<a class="code hl_typedef" href="namespacellvm_1_1ore.html#a5ca06dfbc998afac005414d8e9b7c234">NV</a>(<span class="stringliteral">&quot;Callee&quot;</span>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a>) &lt;&lt; <span class="stringliteral">&quot;&#39; into &#39;&quot;</span></div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>                &lt;&lt; ore::<a class="code hl_typedef" href="namespacellvm_1_1ore.html#a5ca06dfbc998afac005414d8e9b7c234">NV</a>(<span class="stringliteral">&quot;Caller&quot;</span>, &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>    }</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>  }</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>}</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span><span class="comment"></span> </div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span><span class="comment">/// Iteratively inline hot callsites of a function.</span></div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span><span class="comment">///</span></div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span><span class="comment">/// Iteratively traverse all callsites of the function \p F, and find if</span></div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span><span class="comment">/// the corresponding inlined instance exists and is hot in profile. If</span></div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span><span class="comment">/// it is hot enough, inline the callsites and adds new callsites of the</span></div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span><span class="comment">/// callee into the caller. If the call is an indirect call, first promote</span></div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span><span class="comment">/// it to direct call. Each indirect call is limited with a single target.</span></div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span><span class="comment">///</span></div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span><span class="comment">/// \param F function to perform iterative inlining.</span></div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span><span class="comment">/// \param InlinedGUIDs a set to be updated to include all GUIDs that are</span></div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span><span class="comment">///     inlined in the profiled binary.</span></div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span><span class="comment">///</span></div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span><span class="comment">/// \returns True if there is any inline happened.</span></div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span><span class="comment"></span><span class="keywordtype">bool</span> SampleProfileLoader::inlineHotFunctions(</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>    <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseSet&lt;GlobalValue::GUID&gt;</a> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>) {</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseSet&lt;Instruction *&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">PromotedInsns</a>;</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span> </div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>  <span class="comment">// ProfAccForSymsInList is used in callsiteIsHot. The assertion makes sure</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>  <span class="comment">// Profile symbol list is ignored when profile-sample-accurate is on.</span></div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>  <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!ProfAccForSymsInList ||</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>          (!<a class="code hl_variable" href="SampleProfile_8cpp.html#af00e1c8a074b97aedd1a2db33dea6753">ProfileSampleAccurate</a> &amp;&amp;</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>           !<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(<span class="stringliteral">&quot;profile-sample-accurate&quot;</span>))) &amp;&amp;</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>         <span class="stringliteral">&quot;ProfAccForSymsInList should be false when profile-sample-accurate &quot;</span></div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>         <span class="stringliteral">&quot;is enabled&quot;</span>);</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span> </div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;CallBase *, const FunctionSamples *&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalNotInlinedCallSites</a>;</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalChanged</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>  <span class="keywordflow">while</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalChanged</a>) {</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalChanged</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;CallBase *, 10&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CIS</a>;</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;BB : <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>      <span class="keywordtype">bool</span> Hot = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;CallBase *, 10&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">AllCandidates</a>;</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;CallBase *, 10&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ColdCandidates</a>;</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB.getInstList()) {</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>        <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CB = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">dyn_cast&lt;CallBase&gt;</a>(&amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>          <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;IntrinsicInst&gt;</a>(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; (FS = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findCalleeFunctionSamples</a>(*CB))) {</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>            <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a class="code hl_variable" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#afddaa81316d56f125de69793e0ddb33c">FunctionSamples::UseMD5</a> || <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;GUIDToFuncNameMap) &amp;&amp;</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>                   <span class="stringliteral">&quot;GUIDToFuncNameMap has to be populated&quot;</span>);</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>            <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">AllCandidates</a>.push_back(CB);</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>            <span class="keywordflow">if</span> (<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getEntrySamples() &gt; 0 || ProfileIsCS)</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>              <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalNotInlinedCallSites</a>.try_emplace(CB, FS);</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>            <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">callsiteIsHot</a>(FS, PSI))</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>              Hot = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">shouldInlineColdCallee</a>(*CB))</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>              <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ColdCandidates</a>.push_back(CB);</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>          }</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>        }</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>      }</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>      <span class="keywordflow">if</span> (Hot || ExternalInlineAdvisor) {</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CIS</a>.insert(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CIS</a>.begin(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">AllCandidates</a>.begin(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">AllCandidates</a>.end());</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">emitOptimizationRemarksForInlineCandidates</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">AllCandidates</a>, <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CIS</a>.insert(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CIS</a>.begin(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ColdCandidates</a>.begin(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ColdCandidates</a>.end());</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">emitOptimizationRemarksForInlineCandidates</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ColdCandidates</a>, <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>      }</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>    }</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>    <span class="keywordflow">for</span> (<a class="code hl_class" href="classllvm_1_1CallBase.html">CallBase</a> *<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CIS</a>) {</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>      <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a> = <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getCalledFunction();</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>      InlineCandidate Candidate = {</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>          <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalNotInlinedCallSites</a>.count(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalNotInlinedCallSites</a>[<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>                                            : <span class="keyword">nullptr</span>,</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>          0 <span class="comment">/* dummy count */</span>, 1.0 <span class="comment">/* dummy distribution factor */</span>};</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>      <span class="comment">// Do not inline recursive calls.</span></div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a> == &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>      <span class="keywordflow">if</span> (<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isIndirectCall()) {</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">PromotedInsns</a>.count(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>        uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>;</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *FS : <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findIndirectCallFunctionSamples</a>(*<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>)) {</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>          uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SumOrigin</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>;</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>          <span class="keywordflow">if</span> (LTOPhase == ThinOrFullLTOPhase::ThinLTOPreLink) {</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>            <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;findInlinedFunctions(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>, <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent(),</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>                                     PSI-&gt;<a class="code hl_function" href="classllvm_1_1ProfileSummaryInfo.html#ae48ebfb8f85e9b59325d20cdc9299f0e">getOrCompHotCountThreshold</a>());</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>          }</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>          <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">callsiteIsHot</a>(FS, PSI))</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span> </div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>          Candidate = {<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>, <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getEntrySamples(), 1.0};</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>          <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">tryPromoteAndInlineCandidate</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Candidate, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SumOrigin</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>,</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>                                           <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">PromotedInsns</a>)) {</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>            <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalNotInlinedCallSites</a>.erase(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>            <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalChanged</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>          }</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>        }</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a> &amp;&amp; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a>-&gt;getSubprogram() &amp;&amp;</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>                 !<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a>-&gt;isDeclaration()) {</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">tryInlineCandidate</a>(Candidate)) {</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalNotInlinedCallSites</a>.erase(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalChanged</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>        }</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (LTOPhase == ThinOrFullLTOPhase::ThinLTOPreLink) {</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findCalleeFunctionSamples</a>(*I)-&gt;findInlinedFunctions(</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>            <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>, <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent(), PSI-&gt;<a class="code hl_function" href="classllvm_1_1ProfileSummaryInfo.html#ae48ebfb8f85e9b59325d20cdc9299f0e">getOrCompHotCountThreshold</a>());</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>      }</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>    }</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>    <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> |= <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalChanged</a>;</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>  }</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span> </div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>  <span class="comment">// For CS profile, profile for not inlined context will be merged when</span></div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>  <span class="comment">// base profile is being trieved</span></div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>  <span class="keywordflow">if</span> (ProfileIsCS)</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a>;</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span> </div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>  <span class="comment">// Accumulate not inlined callsite information into notInlinedSamples</span></div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Pair : <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">LocalNotInlinedCallSites</a>) {</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>    <a class="code hl_class" href="classllvm_1_1CallBase.html">CallBase</a> *<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Pair.getFirst();</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>    <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> = <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getCalledFunction();</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> || <a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>-&gt;isDeclaration())</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span> </div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>    ORE-&gt;<a class="code hl_function" href="classllvm_1_1OptimizationRemarkEmitter.html#aae6a98aea85aa3af87357cc5448db499">emit</a>(<a class="code hl_class" href="classllvm_1_1OptimizationRemarkAnalysis.html">OptimizationRemarkAnalysis</a>(<a class="code hl_define" href="SampleProfile_8cpp.html#ab4932d7673e6e1138d8a2671f16865d1">CSINLINE_DEBUG</a>, <span class="stringliteral">&quot;NotInline&quot;</span>,</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>                                         <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc(), <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent())</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>              &lt;&lt; <span class="stringliteral">&quot;previous inlining not repeated: &#39;&quot;</span></div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>              &lt;&lt; <a class="code hl_struct" href="structllvm_1_1DiagnosticInfoOptimizationBase_1_1Argument.html">ore::NV</a>(<span class="stringliteral">&quot;Callee&quot;</span>, <a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>) &lt;&lt; <span class="stringliteral">&quot;&#39; into &#39;&quot;</span></div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>              &lt;&lt; <a class="code hl_struct" href="structllvm_1_1DiagnosticInfoOptimizationBase_1_1Argument.html">ore::NV</a>(<span class="stringliteral">&quot;Caller&quot;</span>, &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span> </div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>    ++<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumCSNotInlined</a>;</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>    <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a> = Pair.getSecond();</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>    <span class="keywordflow">if</span> (<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getTotalSamples() == 0 &amp;&amp; <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getEntrySamples() == 0) {</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>    }</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span> </div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="SampleProfile_8cpp.html#a8b16dbb3ebefd05908afe3a7874d6353">ProfileMergeInlinee</a>) {</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>      <span class="comment">// A function call can be replicated by optimizations like callsite</span></div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>      <span class="comment">// splitting or jump threading and the replicates end up sharing the</span></div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>      <span class="comment">// sample nested callee profile instead of slicing the original inlinee&#39;s</span></div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>      <span class="comment">// profile. We want to do merge exactly once by filtering out callee</span></div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>      <span class="comment">// profiles with a non-zero head sample count.</span></div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>      <span class="keywordflow">if</span> (<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getHeadSamples() == 0) {</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>        <span class="comment">// Use entry samples as head samples during the merge, as inlinees</span></div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>        <span class="comment">// don&#39;t have head samples.</span></div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>        <span class="keyword">const_cast&lt;</span><a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<span class="keyword">&gt;</span>(<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>)-&gt;addHeadSamples(</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>            <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getEntrySamples());</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span> </div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>        <span class="comment">// Note that we have to do the merge right after processing function.</span></div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>        <span class="comment">// This allows OutlineFS&#39;s profile to be used for annotation during</span></div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>        <span class="comment">// top-down processing of functions&#39; annotation.</span></div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>        <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OutlineFS</a> = Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a3af68fe6182b0855269ef3578910df4c">getOrCreateSamplesFor</a>(*<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>);</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OutlineFS</a>-&gt;merge(*FS);</div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>      }</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>      <span class="keyword">auto</span> pair =</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>          notInlinedCallInfo.try_emplace(<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>, NotInlinedProfileInfo{0});</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>      pair.first-&gt;second.entryCount += <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getEntrySamples();</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>    }</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>  }</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a>;</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>}</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span> </div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span><span class="keywordtype">bool</span> SampleProfileLoader::tryInlineCandidate(</div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>    InlineCandidate &amp;Candidate, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;CallBase *, 8&gt;</a> *InlinedCallSites) {</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span> </div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>  <a class="code hl_class" href="classllvm_1_1CallBase.html">CallBase</a> &amp;CB = *Candidate.CallInstr;</div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>  <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a> = CB.<a class="code hl_function" href="classllvm_1_1CallBase.html#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>  <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a> &amp;&amp; <span class="stringliteral">&quot;Expect a callee with definition&quot;</span>);</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>  <a class="code hl_class" href="classllvm_1_1DebugLoc.html">DebugLoc</a> DLoc = CB.<a class="code hl_function" href="classllvm_1_1Instruction.html#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>();</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>  <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB = CB.<a class="code hl_function" href="classllvm_1_1Instruction.html#a5e6364c710de3afb5449588baab260fd">getParent</a>();</div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span> </div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>  <a class="code hl_class" href="classllvm_1_1InlineCost.html">InlineCost</a> Cost = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">shouldInlineCandidate</a>(Candidate);</div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>  <span class="keywordflow">if</span> (Cost.isNever()) {</div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>    ORE-&gt;<a class="code hl_function" href="classllvm_1_1OptimizationRemarkEmitter.html#aae6a98aea85aa3af87357cc5448db499">emit</a>(<a class="code hl_class" href="classllvm_1_1OptimizationRemarkAnalysis.html">OptimizationRemarkAnalysis</a>(<a class="code hl_define" href="SampleProfile_8cpp.html#ab4932d7673e6e1138d8a2671f16865d1">CSINLINE_DEBUG</a>, <span class="stringliteral">&quot;InlineFail&quot;</span>, DLoc, BB)</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>              &lt;&lt; <span class="stringliteral">&quot;incompatible inlining&quot;</span>);</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>  }</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span> </div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>  <span class="keywordflow">if</span> (!Cost)</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span> </div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>  <a class="code hl_class" href="classllvm_1_1InlineFunctionInfo.html">InlineFunctionInfo</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IFI</a>(<span class="keyword">nullptr</span>, GetAC);</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacellvm.html#a7e39b6f753eab4236840973d7f6ddbfe">InlineFunction</a>(CB, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IFI</a>).isSuccess()) {</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>    <span class="comment">// The call to InlineFunction erases I, so we can&#39;t pass it here.</span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>    <a class="code hl_function" href="namespacellvm.html#a900f3a78adcdae820536c776900726fc">emitInlinedInto</a>(*ORE, DLoc, BB, *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a>, *BB-&gt;<a class="code hl_function" href="classllvm_1_1BasicBlock.html#a80069e261aca5e34cffcc2ef67cfa29b">getParent</a>(), Cost,</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>                    <span class="keyword">true</span>, <a class="code hl_define" href="SampleProfile_8cpp.html#ab4932d7673e6e1138d8a2671f16865d1">CSINLINE_DEBUG</a>);</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span> </div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>    <span class="comment">// Now populate the list of newly exposed call sites.</span></div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>    <span class="keywordflow">if</span> (InlinedCallSites) {</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>      InlinedCallSites-&gt;clear();</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IFI</a>.InlinedCallSites)</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>        InlinedCallSites-&gt;push_back(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>    }</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span> </div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>    <span class="keywordflow">if</span> (ProfileIsCS)</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>      ContextTracker-&gt;markContextSamplesInlined(Candidate.CalleeSamples);</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>    ++<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumCSInlined</a>;</div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span> </div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>    <span class="comment">// Prorate inlined probes for a duplicated inlining callsite which probably</span></div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>    <span class="comment">// has a distribution less than 100%. Samples for an inlinee should be</span></div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>    <span class="comment">// distributed among the copies of the original callsite based on each</span></div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>    <span class="comment">// callsite&#39;s distribution factor for counts accuracy. Note that an inlined</span></div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>    <span class="comment">// probe may come with its own distribution factor if it has been duplicated</span></div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>    <span class="comment">// in the inlinee body. The two factor are multiplied to reflect the</span></div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>    <span class="comment">// aggregation of duplication.</span></div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>    <span class="keywordflow">if</span> (Candidate.CallsiteDistribution &lt; 1) {</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IFI</a>.InlinedCallSites) {</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Optional&lt;PseudoProbe&gt;</a> Probe = <a class="code hl_function" href="namespacellvm.html#a00fba4013f1a5b882b91cad397791f9f">extractProbe</a>(*<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>          <a class="code hl_function" href="namespacellvm.html#a4fb32c986b105bb7a53700e5988aab6e">setProbeDistributionFactor</a>(*<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Probe-&gt;Factor *</div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>                                             Candidate.CallsiteDistribution);</div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>      }</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumDuplicatedInlinesite</a>++;</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>    }</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span> </div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>  }</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>}</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span> </div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span><span class="keywordtype">bool</span> SampleProfileLoader::getInlineCandidate(InlineCandidate *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewCandidate</a>,</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>                                             <a class="code hl_class" href="classllvm_1_1CallBase.html">CallBase</a> *CB) {</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>  <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CB &amp;&amp; <span class="stringliteral">&quot;Expect non-null call instruction&quot;</span>);</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span> </div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>  <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;IntrinsicInst&gt;</a>(CB))</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span> </div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>  <span class="comment">// Find the callee&#39;s profile. For indirect call, find hottest target profile.</span></div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *CalleeSamples = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findCalleeFunctionSamples</a>(*CB);</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>  <span class="keywordflow">if</span> (!CalleeSamples)</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span> </div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>  <span class="keywordtype">float</span> Factor = 1.0;</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>  <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Optional&lt;PseudoProbe&gt;</a> Probe = <a class="code hl_function" href="namespacellvm.html#a00fba4013f1a5b882b91cad397791f9f">extractProbe</a>(*CB))</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>    Factor = Probe-&gt;Factor;</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span> </div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>  uint64_t CallsiteCount = 0;</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ErrorOr&lt;uint64_t&gt;</a> Weight = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getBlockWeight</a>(CB-&gt;<a class="code hl_function" href="classllvm_1_1Instruction.html#a5e6364c710de3afb5449588baab260fd">getParent</a>());</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span>  <span class="keywordflow">if</span> (Weight)</div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>    CallsiteCount = Weight.get();</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>  <span class="keywordflow">if</span> (CalleeSamples)</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>    CallsiteCount = std::max(</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>        CallsiteCount, uint64_t(CalleeSamples-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aac9d9812a5a2e1902e92b485bbf6819b">getEntrySamples</a>() * Factor));</div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span> </div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span>  *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewCandidate</a> = {CB, CalleeSamples, CallsiteCount, Factor};</div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>}</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span> </div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span><a class="code hl_class" href="classllvm_1_1InlineCost.html">InlineCost</a></div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>SampleProfileLoader::shouldInlineCandidate(InlineCandidate &amp;Candidate) {</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>  std::unique_ptr&lt;InlineAdvice&gt; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Advice</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>  <span class="keywordflow">if</span> (ExternalInlineAdvisor) {</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Advice</a> = ExternalInlineAdvisor-&gt;getAdvice(*Candidate.CallInstr);</div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>    <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Advice</a>-&gt;isInliningRecommended()) {</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Advice</a>-&gt;recordUnattemptedInlining();</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>      <span class="keywordflow">return</span> <a class="code hl_function" href="classllvm_1_1InlineCost.html#a7a81805a6584dbd95ea13ecd57ec7b9a">InlineCost::getNever</a>(<span class="stringliteral">&quot;not previously inlined&quot;</span>);</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>    }</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Advice</a>-&gt;recordInlining();</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classllvm_1_1InlineCost.html#afbef5b1bdefbcd81cbd1bab57f83ed45">InlineCost::getAlways</a>(<span class="stringliteral">&quot;previously inlined&quot;</span>);</div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>  }</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span> </div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>  <span class="comment">// Adjust threshold based on call site hotness, only do this for callsite</span></div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>  <span class="comment">// prioritized inliner because otherwise cost-benefit check is done earlier.</span></div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>  <span class="keywordtype">int</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SampleThreshold</a> = <a class="code hl_variable" href="SampleProfile_8cpp.html#a6c063cf654bf13a20d00365c2ef7b1da">SampleColdCallSiteThreshold</a>;</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="SampleProfile_8cpp.html#a582e224bc99dcf3ca6263cdd9b25d94f">CallsitePrioritizedInline</a>) {</div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>    <span class="keywordflow">if</span> (Candidate.CallsiteCount &gt; PSI-&gt;<a class="code hl_function" href="classllvm_1_1ProfileSummaryInfo.html#abd23a0c84ddc290f08599b62968af701">getHotCountThreshold</a>())</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SampleThreshold</a> = <a class="code hl_variable" href="SampleProfile_8cpp.html#a033aa3e7e3e183cec38f5a5e36e212c7">SampleHotCallSiteThreshold</a>;</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SampleProfile_8cpp.html#ada8f2c564085d598909fb28464614812">ProfileSizeInline</a>)</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>      <span class="keywordflow">return</span> <a class="code hl_function" href="classllvm_1_1InlineCost.html#a7a81805a6584dbd95ea13ecd57ec7b9a">InlineCost::getNever</a>(<span class="stringliteral">&quot;cold callsite&quot;</span>);</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>  }</div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span> </div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>  <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> = Candidate.CallInstr-&gt;<a class="code hl_function" href="classllvm_1_1CallBase.html#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>  <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> &amp;&amp; <span class="stringliteral">&quot;Expect a definition for inline candidate of direct call&quot;</span>);</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span> </div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span>  <a class="code hl_struct" href="structllvm_1_1InlineParams.html">InlineParams</a> Params = <a class="code hl_function" href="namespacellvm.html#aba7063dea024346c7b70099c63703f50">getInlineParams</a>();</div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>  Params.<a class="code hl_variable" href="structllvm_1_1InlineParams.html#afbfdb6bed9436fc13b4df5ac67f8b9f7">ComputeFullInlineCost</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>  <span class="comment">// Checks if there is anything in the reachable portion of the callee at</span></div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>  <span class="comment">// this callsite that makes this inlining potentially illegal. Need to</span></div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>  <span class="comment">// set ComputeFullInlineCost, otherwise getInlineCost may return early</span></div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>  <span class="comment">// when cost exceeds threshold without checking all IRs in the callee.</span></div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>  <span class="comment">// The acutal cost does not matter because we only checks isNever() to</span></div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>  <span class="comment">// see if it is legal to inline the callsite.</span></div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>  <a class="code hl_class" href="classllvm_1_1InlineCost.html">InlineCost</a> Cost = <a class="code hl_function" href="namespacellvm.html#a5f5f248d08aa55c63e5bc7a8304a7319">getInlineCost</a>(*Candidate.CallInstr, <a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>, Params,</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>                                  GetTTI(*<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>), GetAC, GetTLI);</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span> </div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>  <span class="comment">// Honor always inline and never inline from call analyzer</span></div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>  <span class="keywordflow">if</span> (Cost.isNever() || Cost.isAlways())</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>    <span class="keywordflow">return</span> Cost;</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span> </div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>  <span class="comment">// For old FDO inliner, we inline the call site as long as cost is not</span></div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>  <span class="comment">// &quot;Never&quot;. The cost-benefit check is done earlier.</span></div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SampleProfile_8cpp.html#a582e224bc99dcf3ca6263cdd9b25d94f">CallsitePrioritizedInline</a>) {</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classllvm_1_1InlineCost.html#ac7c62ec9e2cd5d974f662038b8c8951f">InlineCost::get</a>(Cost.getCost(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">INT_MAX</a>);</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>  }</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span> </div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>  <span class="comment">// Otherwise only use the cost from call analyzer, but overwite threshold with</span></div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>  <span class="comment">// Sample PGO threshold.</span></div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="classllvm_1_1InlineCost.html#ac7c62ec9e2cd5d974f662038b8c8951f">InlineCost::get</a>(Cost.getCost(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SampleThreshold</a>);</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>}</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span> </div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span><span class="keywordtype">bool</span> SampleProfileLoader::inlineHotFunctionsWithPriority(</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>    <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseSet&lt;GlobalValue::GUID&gt;</a> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>) {</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseSet&lt;Instruction *&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">PromotedInsns</a>;</div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>  <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ProfileIsCS &amp;&amp; <span class="stringliteral">&quot;Prioritiy based inliner only works with CSSPGO now&quot;</span>);</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span> </div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>  <span class="comment">// ProfAccForSymsInList is used in callsiteIsHot. The assertion makes sure</span></div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span>  <span class="comment">// Profile symbol list is ignored when profile-sample-accurate is on.</span></div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>  <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!ProfAccForSymsInList ||</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>          (!<a class="code hl_variable" href="SampleProfile_8cpp.html#af00e1c8a074b97aedd1a2db33dea6753">ProfileSampleAccurate</a> &amp;&amp;</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>           !<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(<span class="stringliteral">&quot;profile-sample-accurate&quot;</span>))) &amp;&amp;</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>         <span class="stringliteral">&quot;ProfAccForSymsInList should be false when profile-sample-accurate &quot;</span></div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>         <span class="stringliteral">&quot;is enabled&quot;</span>);</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span> </div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>  <span class="comment">// Populating worklist with initial call sites from root inliner, along</span></div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span>  <span class="comment">// with call site weights.</span></div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CandidateQueue</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CQueue</a>;</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>  InlineCandidate <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewCandidate</a>;</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;BB : <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB.getInstList()) {</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>      <span class="keyword">auto</span> *CB = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">dyn_cast&lt;CallBase&gt;</a>(&amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>      <span class="keywordflow">if</span> (!CB)</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getInlineCandidate</a>(&amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewCandidate</a>, CB))</div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CQueue</a>.push(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewCandidate</a>);</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>    }</div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>  }</div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span> </div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>  <span class="comment">// Cap the size growth from profile guided inlining. This is needed even</span></div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>  <span class="comment">// though cost of each inline candidate already accounts for callee size,</span></div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>  <span class="comment">// because with top-down inlining, we can grow inliner size significantly</span></div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>  <span class="comment">// with large number of smaller inlinees each pass the cost check.</span></div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>  <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code hl_variable" href="SampleProfile_8cpp.html#a1fbf05aa3c19fb9ce58e03dcca69e493">ProfileInlineLimitMax</a> &gt;= <a class="code hl_variable" href="SampleProfile_8cpp.html#ae2b46e6b1f93e3b18b20d0c0c0ac6151">ProfileInlineLimitMin</a> &amp;&amp;</div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>         <span class="stringliteral">&quot;Max inline size limit should not be smaller than min inline size &quot;</span></div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>         <span class="stringliteral">&quot;limit.&quot;</span>);</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>  <span class="keywordtype">unsigned</span> <a class="code hl_variable" href="HexagonEarlyIfConv_8cpp.html#a69e1845bcbb3948c6e36bbbfb71e8024">SizeLimit</a> = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getInstructionCount() * <a class="code hl_variable" href="SampleProfile_8cpp.html#a6f2891ea30bbf02e93cc94ca385d8d91">ProfileInlineGrowthLimit</a>;</div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>  <a class="code hl_variable" href="HexagonEarlyIfConv_8cpp.html#a69e1845bcbb3948c6e36bbbfb71e8024">SizeLimit</a> = std::min(<a class="code hl_variable" href="HexagonEarlyIfConv_8cpp.html#a69e1845bcbb3948c6e36bbbfb71e8024">SizeLimit</a>, (<span class="keywordtype">unsigned</span>)<a class="code hl_variable" href="SampleProfile_8cpp.html#a1fbf05aa3c19fb9ce58e03dcca69e493">ProfileInlineLimitMax</a>);</div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>  <a class="code hl_variable" href="HexagonEarlyIfConv_8cpp.html#a69e1845bcbb3948c6e36bbbfb71e8024">SizeLimit</a> = std::max(<a class="code hl_variable" href="HexagonEarlyIfConv_8cpp.html#a69e1845bcbb3948c6e36bbbfb71e8024">SizeLimit</a>, (<span class="keywordtype">unsigned</span>)<a class="code hl_variable" href="SampleProfile_8cpp.html#ae2b46e6b1f93e3b18b20d0c0c0ac6151">ProfileInlineLimitMin</a>);</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>  <span class="keywordflow">if</span> (ExternalInlineAdvisor)</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>    <a class="code hl_variable" href="HexagonEarlyIfConv_8cpp.html#a69e1845bcbb3948c6e36bbbfb71e8024">SizeLimit</a> = std::numeric_limits&lt;unsigned&gt;::max();</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span> </div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>  <span class="comment">// Perform iterative BFS call site prioritized inlining</span></div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>  <span class="keywordflow">while</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CQueue</a>.empty() &amp;&amp; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getInstructionCount() &lt; <a class="code hl_variable" href="HexagonEarlyIfConv_8cpp.html#a69e1845bcbb3948c6e36bbbfb71e8024">SizeLimit</a>) {</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>    InlineCandidate Candidate = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CQueue</a>.top();</div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CQueue</a>.pop();</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>    <a class="code hl_class" href="classllvm_1_1CallBase.html">CallBase</a> *<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Candidate.CallInstr;</div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>    <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a> = <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getCalledFunction();</div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span> </div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a> == &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>    <span class="keywordflow">if</span> (<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isIndirectCall()) {</div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">PromotedInsns</a>.count(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>      uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>;</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>      <span class="keyword">auto</span> CalleeSamples = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findIndirectCallFunctionSamples</a>(*<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>);</div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>      uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SumOrigin</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>;</div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a> *= Candidate.CallsiteDistribution;</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *FS : CalleeSamples) {</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>        <span class="comment">// TODO: Consider disable pre-lTO ICP for MonoLTO as well</span></div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>        <span class="keywordflow">if</span> (LTOPhase == ThinOrFullLTOPhase::ThinLTOPreLink) {</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>          <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;findInlinedFunctions(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>, <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent(),</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>                                   PSI-&gt;<a class="code hl_function" href="classllvm_1_1ProfileSummaryInfo.html#ae48ebfb8f85e9b59325d20cdc9299f0e">getOrCompHotCountThreshold</a>());</div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>        }</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>        uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">EntryCountDistributed</a> =</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>            <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;getEntrySamples() * Candidate.CallsiteDistribution;</div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>        <span class="comment">// In addition to regular inline cost check, we also need to make sure</span></div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>        <span class="comment">// ICP isn&#39;t introducing excessive speculative checks even if individual</span></div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>        <span class="comment">// target looks beneficial to promote and inline. That means we should</span></div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>        <span class="comment">// only do ICP when there&#39;s a small number dominant targets.</span></div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">EntryCountDistributed</a> &lt; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SumOrigin</a> / <a class="code hl_variable" href="SampleProfile_8cpp.html#a9248a6cbd185564d6817d671ddc29c90">ProfileICPThreshold</a>)</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>        <span class="comment">// TODO: Fix CallAnalyzer to handle all indirect calls.</span></div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>        <span class="comment">// For indirect call, we don&#39;t run CallAnalyzer to get InlineCost</span></div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span>        <span class="comment">// before actual inlining. This is because we could see two different</span></div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>        <span class="comment">// types from the same definition, which makes CallAnalyzer choke as</span></div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>        <span class="comment">// it&#39;s expecting matching parameter type on both caller and callee</span></div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>        <span class="comment">// side. See example from PR18962 for the triggering cases (the bug was</span></div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>        <span class="comment">// fixed, but we generate different types).</span></div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>        <span class="keywordflow">if</span> (!PSI-&gt;<a class="code hl_function" href="classllvm_1_1ProfileSummaryInfo.html#ac46d4d55dd867977ba88d57a170e31de">isHotCount</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">EntryCountDistributed</a>))</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;CallBase *, 8&gt;</a> InlinedCallSites;</div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>        <span class="comment">// Attach function profile for promoted indirect callee, and update</span></div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>        <span class="comment">// call site count for the promoted inline candidate too.</span></div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>        Candidate = {<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">EntryCountDistributed</a>,</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>                     Candidate.CallsiteDistribution};</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">tryPromoteAndInlineCandidate</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Candidate, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SumOrigin</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>,</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>                                         <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">PromotedInsns</a>, &amp;InlinedCallSites)) {</div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>          <span class="keywordflow">for</span> (<span class="keyword">auto</span> *CB : InlinedCallSites) {</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>            <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getInlineCandidate</a>(&amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewCandidate</a>, CB))</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>              <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CQueue</a>.emplace(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewCandidate</a>);</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>          }</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>          <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>        }</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>      }</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a> &amp;&amp; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a>-&gt;getSubprogram() &amp;&amp;</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>               !<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CalledFunction</a>-&gt;isDeclaration()) {</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;CallBase *, 8&gt;</a> InlinedCallSites;</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">tryInlineCandidate</a>(Candidate, &amp;InlinedCallSites)) {</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> *CB : InlinedCallSites) {</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>          <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getInlineCandidate</a>(&amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewCandidate</a>, CB))</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>            <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CQueue</a>.emplace(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewCandidate</a>);</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>        }</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>        <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>      }</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (LTOPhase == ThinOrFullLTOPhase::ThinLTOPreLink) {</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findCalleeFunctionSamples</a>(*I)-&gt;findInlinedFunctions(</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>, <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent(), PSI-&gt;<a class="code hl_function" href="classllvm_1_1ProfileSummaryInfo.html#ae48ebfb8f85e9b59325d20cdc9299f0e">getOrCompHotCountThreshold</a>());</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>    }</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>  }</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span> </div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>  <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CQueue</a>.empty()) {</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="HexagonEarlyIfConv_8cpp.html#a69e1845bcbb3948c6e36bbbfb71e8024">SizeLimit</a> == (<span class="keywordtype">unsigned</span>)<a class="code hl_variable" href="SampleProfile_8cpp.html#a1fbf05aa3c19fb9ce58e03dcca69e493">ProfileInlineLimitMax</a>)</div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>      ++<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumCSInlinedHitMaxLimit</a>;</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="HexagonEarlyIfConv_8cpp.html#a69e1845bcbb3948c6e36bbbfb71e8024">SizeLimit</a> == (<span class="keywordtype">unsigned</span>)<a class="code hl_variable" href="SampleProfile_8cpp.html#ae2b46e6b1f93e3b18b20d0c0c0ac6151">ProfileInlineLimitMin</a>)</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>      ++<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumCSInlinedHitMinLimit</a>;</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>      ++<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumCSInlinedHitGrowthLimit</a>;</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>  }</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span> </div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a>;</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>}</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span><span class="comment"></span> </div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span><span class="comment">/// Find equivalence classes for the given block.</span></div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span><span class="comment">///</span></div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span><span class="comment">/// This finds all the blocks that are guaranteed to execute the same</span></div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span><span class="comment">/// number of times as \p BB1. To do this, it traverses all the</span></div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span><span class="comment">/// descendants of \p BB1 in the dominator or post-dominator tree.</span></div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span><span class="comment">///</span></div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span><span class="comment">/// A block BB2 will be in the same equivalence class as \p BB1 if</span></div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span><span class="comment">/// the following holds:</span></div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span><span class="comment">///</span></div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span><span class="comment">/// 1- \p BB1 is a descendant of BB2 in the opposite tree. So, if BB2</span></div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span><span class="comment">///    is a descendant of \p BB1 in the dominator tree, then BB2 should</span></div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span><span class="comment">///    dominate BB1 in the post-dominator tree.</span></div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span><span class="comment">///</span></div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span><span class="comment">/// 2- Both BB2 and \p BB1 must be in the same loop.</span></div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span><span class="comment">///</span></div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span><span class="comment">/// For every block BB2 that meets those two requirements, we set BB2&#39;s</span></div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span><span class="comment">/// equivalence class to \p BB1.</span></div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span><span class="comment">///</span></div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span><span class="comment">/// \param BB1  Block to check.</span></div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span><span class="comment">/// \param Descendants  Descendants of \p BB1 in either the dom or pdom tree.</span></div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span><span class="comment">/// \param DomTree  Opposite dominator tree. If \p Descendants is filled</span></div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span><span class="comment">///                 with blocks from \p BB1&#39;s dominator tree, then</span></div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span><span class="comment">///                 this is the post-dominator tree, and vice versa.</span></div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span><span class="comment"></span><span class="keyword">template</span> &lt;<span class="keywordtype">bool</span> IsPostDom&gt;</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span><span class="keywordtype">void</span> SampleProfileLoader::findEquivalencesFor(</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>    <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ArrayRef&lt;BasicBlock *&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Descendants</a>,</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DominatorTreeBase&lt;BasicBlock, IsPostDom&gt;</a> *DomTree) {</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>  <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a> = EquivalenceClass[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>];</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>  uint64_t Weight = BlockWeights[<a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>];</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB2</a> : <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Descendants</a>) {</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>    <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IsDomParent</a> = DomTree-&gt;dominates(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB2</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>);</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>    <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IsInSameLoop</a> = LI-&gt;getLoopFor(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>) == LI-&gt;getLoopFor(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB2</a>);</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a> != <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB2</a> &amp;&amp; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IsDomParent</a> &amp;&amp; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IsInSameLoop</a>) {</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>      EquivalenceClass[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB2</a>] = <a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>;</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>      <span class="comment">// If BB2 is visited, then the entire EC should be marked as visited.</span></div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>      <span class="keywordflow">if</span> (VisitedBlocks.count(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB2</a>)) {</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>        VisitedBlocks.insert(EC);</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>      }</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span> </div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>      <span class="comment">// If BB2 is heavier than BB1, make BB2 have the same weight</span></div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>      <span class="comment">// as BB1.</span></div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>      <span class="comment">//</span></div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>      <span class="comment">// Note that we don&#39;t worry about the opposite situation here</span></div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>      <span class="comment">// (when BB2 is lighter than BB1). We will deal with this</span></div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>      <span class="comment">// during the propagation phase. Right now, we just want to</span></div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>      <span class="comment">// make sure that BB1 has the largest weight of all the</span></div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>      <span class="comment">// members of its equivalence set.</span></div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>      Weight = std::max(Weight, BlockWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB2</a>]);</div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>    }</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>  }</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>  <span class="keywordflow">if</span> (EC == &amp;<a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>-&gt;getParent()-&gt;getEntryBlock()) {</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>    BlockWeights[<a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>] = Samples-&gt;getHeadSamples() + 1;</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>    BlockWeights[<a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>] = Weight;</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>  }</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>}</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span><span class="comment"></span> </div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span><span class="comment">/// Find equivalence classes.</span></div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span><span class="comment">///</span></div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span><span class="comment">/// Since samples may be missing from blocks, we can fill in the gaps by setting</span></div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span><span class="comment">/// the weights of all the blocks in the same equivalence class to the same</span></div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span><span class="comment">/// weight. To compute the concept of equivalence, we use dominance and loop</span></div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span><span class="comment">/// information. Two blocks B1 and B2 are in the same equivalence class if B1</span></div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span><span class="comment">/// dominates B2, B2 post-dominates B1 and both are in the same loop.</span></div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span><span class="comment">///</span></div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span><span class="comment">/// \param F The function to query.</span></div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span><span class="comment"></span><span class="keywordtype">void</span> SampleProfileLoader::findEquivalenceClasses(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;BasicBlock *, 8&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DominatedBBs</a>;</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>  <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\nBlock equivalence classes\n&quot;</span>);</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>  <span class="comment">// Find equivalence sets based on dominance and post-dominance information.</span></div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;BB : <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span>    <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a> = &amp;BB;</div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span> </div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span>    <span class="comment">// Compute BB1&#39;s equivalence class once.</span></div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span>    <span class="keywordflow">if</span> (EquivalenceClass.count(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>)) {</div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span>      <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">printBlockEquivalence</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>));</div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>    }</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span> </div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>    <span class="comment">// By default, blocks are in their own equivalence class.</span></div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>    EquivalenceClass[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>] = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>;</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span> </div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>    <span class="comment">// Traverse all the blocks dominated by BB1. We are looking for</span></div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>    <span class="comment">// every basic block BB2 such that:</span></div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>    <span class="comment">//</span></div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>    <span class="comment">// 1- BB1 dominates BB2.</span></div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>    <span class="comment">// 2- BB2 post-dominates BB1.</span></div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>    <span class="comment">// 3- BB1 and BB2 are in the same loop nest.</span></div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>    <span class="comment">//</span></div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>    <span class="comment">// If all those conditions hold, it means that BB2 is executed</span></div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>    <span class="comment">// as many times as BB1, so they are placed in the same equivalence</span></div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>    <span class="comment">// class by making BB2&#39;s equivalence class be BB1.</span></div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DominatedBBs</a>.clear();</div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>    DT-&gt;getDescendants(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DominatedBBs</a>);</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findEquivalencesFor</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DominatedBBs</a>, PDT.get());</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span> </div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span>    <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">printBlockEquivalence</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BB1</a>));</div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>  }</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span> </div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span>  <span class="comment">// Assign weights to equivalence classes.</span></div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>  <span class="comment">//</span></div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>  <span class="comment">// All the basic blocks in the same equivalence class will execute</span></div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>  <span class="comment">// the same number of times. Since we know that the head block in</span></div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>  <span class="comment">// each equivalence class has the largest weight, assign that weight</span></div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span>  <span class="comment">// to all the blocks in that equivalence class.</span></div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>  <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>      <a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\nAssign the same weight to all blocks in the same class\n&quot;</span>);</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;BI : <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>    <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB = &amp;BI;</div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>    <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">EquivBB</a> = EquivalenceClass[BB];</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>    <span class="keywordflow">if</span> (BB != <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">EquivBB</a>)</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>      BlockWeights[BB] = BlockWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">EquivBB</a>];</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>    <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">printBlockWeight</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), BB));</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>  }</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>}</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span><span class="comment"></span> </div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span><span class="comment">/// Visit the given edge to decide if it has a valid weight.</span></div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span><span class="comment">///</span></div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span><span class="comment">/// If \p E has not been visited before, we copy to \p UnknownEdge</span></div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span><span class="comment">/// and increment the count of unknown edges.</span></div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span><span class="comment">///</span></div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span><span class="comment">/// \param E  Edge to visit.</span></div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span><span class="comment">/// \param NumUnknownEdges  Current number of unknown edges.</span></div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span><span class="comment">/// \param UnknownEdge  Set if E has not been visited before.</span></div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span><span class="comment">///</span></div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span><span class="comment">/// \returns E&#39;s weight, if known. Otherwise, return 0.</span></div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span><span class="comment"></span>uint64_t SampleProfileLoader::visitEdge(Edge <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>, <span class="keywordtype">unsigned</span> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumUnknownEdges</a>,</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>                                        Edge *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>) {</div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>  <span class="keywordflow">if</span> (!VisitedEdges.count(<a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>)) {</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>    (*NumUnknownEdges)++;</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>    *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a> = <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>;</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>  }</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span> </div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>  <span class="keywordflow">return</span> EdgeWeights[<a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>];</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>}</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span><span class="comment"></span> </div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span><span class="comment">/// Propagate weights through incoming/outgoing edges.</span></div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span><span class="comment">///</span></div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span><span class="comment">/// If the weight of a basic block is known, and there is only one edge</span></div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span><span class="comment">/// with an unknown weight, we can calculate the weight of that edge.</span></div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span><span class="comment">///</span></div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span><span class="comment">/// Similarly, if all the edges have a known count, we can calculate the</span></div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span><span class="comment">/// count of the basic block, if needed.</span></div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span><span class="comment">///</span></div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span><span class="comment">/// \param F  Function to process.</span></div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span><span class="comment">/// \param UpdateBlockCount  Whether we should update basic block counts that</span></div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span><span class="comment">///                          has already been annotated.</span></div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span><span class="comment">///</span></div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span><span class="comment">/// \returns  True if new weights were assigned to edges or blocks.</span></div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span><span class="comment"></span><span class="keywordtype">bool</span> SampleProfileLoader::propagateThroughEdges(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>                                                <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UpdateBlockCount</a>) {</div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span>  <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\nPropagation through edges\n&quot;</span>);</div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;BI : <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>    <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB = &amp;BI;</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>    <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a> = EquivalenceClass[BB];</div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span> </div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>    <span class="comment">// Visit all the predecessor and successor edges to determine</span></div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>    <span class="comment">// which ones have a weight assigned already. Note that it doesn&#39;t</span></div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span>    <span class="comment">// matter that we only keep track of a single unknown edge. The</span></div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>    <span class="comment">// only case we are interested in handling is when only a single</span></div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span>    <span class="comment">// edge is unknown (see setEdgeOrBlockWeight).</span></div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">i</a> = 0; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">i</a> &lt; 2; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">i</a>++) {</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>      uint64_t TotalWeight = 0;</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>      <span class="keywordtype">unsigned</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumUnknownEdges</a> = 0, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumTotalEdges</a> = 0;</div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>      Edge <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SelfReferentialEdge</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SingleEdge</a>;</div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span> </div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">i</a> == 0) {</div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>        <span class="comment">// First, visit all predecessor edges.</span></div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumTotalEdges</a> = Predecessors[BB].size();</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Pred : Predecessors[BB]) {</div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>          Edge <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a> = std::make_pair(Pred, BB);</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>          TotalWeight += visitEdge(<a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>, &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumUnknownEdges</a>, &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>);</div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>.first == <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>.second)</div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span>            <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SelfReferentialEdge</a> = <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>;</div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>        }</div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumTotalEdges</a> == 1) {</div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SingleEdge</a> = std::make_pair(Predecessors[BB][0], BB);</div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>        }</div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span>        <span class="comment">// On the second round, visit all successor edges.</span></div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumTotalEdges</a> = Successors[BB].size();</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Succ : Successors[BB]) {</div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>          Edge <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a> = std::make_pair(BB, Succ);</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>          TotalWeight += visitEdge(<a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>, &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumUnknownEdges</a>, &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>);</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>        }</div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumTotalEdges</a> == 1) {</div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SingleEdge</a> = std::make_pair(BB, Successors[BB][0]);</div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>        }</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>      }</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span> </div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>      <span class="comment">// After visiting all the edges, there are three cases that we</span></div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>      <span class="comment">// can handle immediately:</span></div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>      <span class="comment">//</span></div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>      <span class="comment">// - All the edge weights are known (i.e., NumUnknownEdges == 0).</span></div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>      <span class="comment">//   In this case, we simply check that the sum of all the edges</span></div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>      <span class="comment">//   is the same as BB&#39;s weight. If not, we change BB&#39;s weight</span></div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>      <span class="comment">//   to match. Additionally, if BB had not been visited before,</span></div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>      <span class="comment">//   we mark it visited.</span></div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span>      <span class="comment">//</span></div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>      <span class="comment">// - Only one edge is unknown and BB has already been visited.</span></div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>      <span class="comment">//   In this case, we can compute the weight of the edge by</span></div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>      <span class="comment">//   subtracting the total block weight from all the known</span></div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span>      <span class="comment">//   edge weights. If the edges weight more than BB, then the</span></div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>      <span class="comment">//   edge of the last remaining edge is set to zero.</span></div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>      <span class="comment">//</span></div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>      <span class="comment">// - There exists a self-referential edge and the weight of BB is</span></div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span>      <span class="comment">//   known. In this case, this edge can be based on BB&#39;s weight.</span></div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>      <span class="comment">//   We add up all the other known edges and set the weight on</span></div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>      <span class="comment">//   the self-referential edge as we did in the previous case.</span></div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>      <span class="comment">//</span></div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>      <span class="comment">// In any other case, we must continue iterating. Eventually,</span></div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>      <span class="comment">// all edges will get a weight, or iteration will stop when</span></div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>      <span class="comment">// it reaches SampleProfileMaxPropagateIterations.</span></div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumUnknownEdges</a> &lt;= 1) {</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span>        uint64_t &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BBWeight</a> = BlockWeights[<a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>];</div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumUnknownEdges</a> == 0) {</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>          <span class="keywordflow">if</span> (!VisitedBlocks.count(EC)) {</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span>            <span class="comment">// If we already know the weight of all edges, the weight of the</span></div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>            <span class="comment">// basic block can be computed. It should be no larger than the sum</span></div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>            <span class="comment">// of all edge weights.</span></div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>            <span class="keywordflow">if</span> (TotalWeight &gt; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BBWeight</a>) {</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span>              <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BBWeight</a> = TotalWeight;</div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>              <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>              <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;All edge weights for &quot;</span> &lt;&lt; BB-&gt;<a class="code hl_function" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>                                &lt;&lt; <span class="stringliteral">&quot; known. Set weight for block: &quot;</span>;</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>                         <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">printBlockWeight</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), BB););</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>            }</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumTotalEdges</a> == 1 &amp;&amp;</div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span>                     EdgeWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SingleEdge</a>] &lt; BlockWeights[EC]) {</div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span>            <span class="comment">// If there is only one edge for the visited basic block, use the</span></div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span>            <span class="comment">// block weight to adjust edge weight if edge weight is smaller.</span></div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span>            EdgeWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SingleEdge</a>] = BlockWeights[<a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>];</div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span>            <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span>          }</div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumUnknownEdges</a> == 1 &amp;&amp; VisitedBlocks.count(EC)) {</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span>          <span class="comment">// If there is a single unknown edge and the block has been</span></div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span>          <span class="comment">// visited, then we can compute E&#39;s weight.</span></div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>          <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BBWeight</a> &gt;= TotalWeight)</div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span>            EdgeWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>] = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BBWeight</a> - TotalWeight;</div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span>            EdgeWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>] = 0;</div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span>          <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OtherEC</a>;</div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span>          <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">i</a> == 0)</div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span>            <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OtherEC</a> = EquivalenceClass[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>.first];</div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span>            <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OtherEC</a> = EquivalenceClass[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>.second];</div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span>          <span class="comment">// Edge weights should never exceed the BB weights it connects.</span></div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span>          <span class="keywordflow">if</span> (VisitedBlocks.count(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OtherEC</a>) &amp;&amp;</div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span>              EdgeWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>] &gt; BlockWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OtherEC</a>])</div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span>            EdgeWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>] = BlockWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OtherEC</a>];</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span>          VisitedEdges.insert(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>);</div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span>          <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span>          <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Set weight for edge: &quot;</span>;</div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span>                     <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">printEdgeWeight</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UnknownEdge</a>));</div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span>        }</div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (VisitedBlocks.count(EC) &amp;&amp; BlockWeights[<a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>] == 0) {</div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span>        <span class="comment">// If a block Weights 0, all its in/out edges should weight 0.</span></div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">i</a> == 0) {</div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span>          <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Pred : Predecessors[BB]) {</div>
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"> 1877</span>            Edge <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a> = std::make_pair(Pred, BB);</div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span>            EdgeWeights[<a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>] = 0;</div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span>            VisitedEdges.insert(<a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>);</div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span>          }</div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span>          <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Succ : Successors[BB]) {</div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"> 1883</span>            Edge <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a> = std::make_pair(BB, Succ);</div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span>            EdgeWeights[<a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>] = 0;</div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span>            VisitedEdges.insert(<a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>);</div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span>          }</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>        }</div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SelfReferentialEdge</a>.first &amp;&amp; VisitedBlocks.count(EC)) {</div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span>        uint64_t &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BBWeight</a> = BlockWeights[BB];</div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span>        <span class="comment">// We have a self-referential edge and the weight of BB is known.</span></div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BBWeight</a> &gt;= TotalWeight)</div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span>          EdgeWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SelfReferentialEdge</a>] = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BBWeight</a> - TotalWeight;</div>
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"> 1893</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span>          EdgeWeights[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SelfReferentialEdge</a>] = 0;</div>
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"> 1895</span>        VisitedEdges.insert(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SelfReferentialEdge</a>);</div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span>        <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span>        <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Set self-referential edge weight to: &quot;</span>;</div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span>                   <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">printEdgeWeight</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SelfReferentialEdge</a>));</div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span>      }</div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">UpdateBlockCount</a> &amp;&amp; !VisitedBlocks.count(EC) &amp;&amp; TotalWeight &gt; 0) {</div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span>        BlockWeights[<a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>] = TotalWeight;</div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span>        VisitedBlocks.insert(EC);</div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span>        <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span>      }</div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span>    }</div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span>  }</div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span> </div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a>;</div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span>}</div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"> 1910</span><span class="comment"></span> </div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span><span class="comment">/// Build in/out edge lists for each basic block in the CFG.</span></div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span><span class="comment">///</span></div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span><span class="comment">/// We are interested in unique edges. If a block B1 has multiple</span></div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span><span class="comment">/// edges to another block B2, we only add a single B1-&gt;B2 edge.</span></div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span><span class="comment"></span><span class="keywordtype">void</span> SampleProfileLoader::buildEdges(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;BI : <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span>    <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code hl_class" href="classB1.html">B1</a> = &amp;BI;</div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span> </div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span>    <span class="comment">// Add predecessors for B1.</span></div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallPtrSet&lt;BasicBlock *, 16&gt;</a> Visited;</div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span>    <span class="keywordflow">if</span> (!Predecessors[<a class="code hl_class" href="classB1.html">B1</a>].<a class="code hl_function" href="namespacellvm.html#a824f3e0d9eb261d9345fcc96b36852f5">empty</a>())</div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span>      <a class="code hl_define" href="llvm_2Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Found a stale predecessors list in a basic block.&quot;</span>);</div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span>    <span class="keywordflow">for</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">pred_iterator</a> PI = <a class="code hl_function" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(<a class="code hl_class" href="classB1.html">B1</a>), PE = <a class="code hl_function" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(<a class="code hl_class" href="classB1.html">B1</a>); PI != PE; ++PI) {</div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span>      <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">B2</a> = *PI;</div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span>      <span class="keywordflow">if</span> (Visited.insert(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">B2</a>).second)</div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span>        Predecessors[<a class="code hl_class" href="classB1.html">B1</a>].push_back(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">B2</a>);</div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span>    }</div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span> </div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span>    <span class="comment">// Add successors for B1.</span></div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span>    Visited.clear();</div>
<div class="line"><a id="l01931" name="l01931"></a><span class="lineno"> 1931</span>    <span class="keywordflow">if</span> (!Successors[<a class="code hl_class" href="classB1.html">B1</a>].<a class="code hl_function" href="namespacellvm.html#a824f3e0d9eb261d9345fcc96b36852f5">empty</a>())</div>
<div class="line"><a id="l01932" name="l01932"></a><span class="lineno"> 1932</span>      <a class="code hl_define" href="llvm_2Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Found a stale successors list in a basic block.&quot;</span>);</div>
<div class="line"><a id="l01933" name="l01933"></a><span class="lineno"> 1933</span>    <span class="keywordflow">for</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">succ_iterator</a> SI = <a class="code hl_function" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(<a class="code hl_class" href="classB1.html">B1</a>), SE = <a class="code hl_function" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(<a class="code hl_class" href="classB1.html">B1</a>); <a class="code hl_enumvalue" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> != SE; ++<a class="code hl_enumvalue" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a id="l01934" name="l01934"></a><span class="lineno"> 1934</span>      <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">B2</a> = *<a class="code hl_enumvalue" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>;</div>
<div class="line"><a id="l01935" name="l01935"></a><span class="lineno"> 1935</span>      <span class="keywordflow">if</span> (Visited.insert(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">B2</a>).second)</div>
<div class="line"><a id="l01936" name="l01936"></a><span class="lineno"> 1936</span>        Successors[<a class="code hl_class" href="classB1.html">B1</a>].push_back(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">B2</a>);</div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span>    }</div>
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"> 1938</span>  }</div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span>}</div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span><span class="comment"></span> </div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span><span class="comment">/// Returns the sorted CallTargetMap \p M by count in descending order.</span></div>
<div class="foldopen" id="foldopen01942" data-start="{" data-end="}">
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#aaf55fbc9b8550957ceb81da6a13f54e4"> 1942</a></span><span class="comment"></span><span class="keyword">static</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;InstrProfValueData, 2&gt;</a> <a class="code hl_function" href="SampleProfile_8cpp.html#aaf55fbc9b8550957ceb81da6a13f54e4">GetSortedValueDataFromCallTargets</a>(</div>
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"> 1943</span>    <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1StringMap.html">SampleRecord::CallTargetMap</a> &amp; M) {</div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;InstrProfValueData, 2&gt;</a> R;</div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleRecord.html#ab818a10bb93f9f5b08f1f85ed4733b3c">SampleRecord::SortCallTargets</a>(M)) {</div>
<div class="line"><a id="l01946" name="l01946"></a><span class="lineno"> 1946</span>    R.emplace_back(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InstrProfValueData</a>{<a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#a2b2898e95dd1947ace149447cb9ef137">FunctionSamples::getGUID</a>(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.first), <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second});</div>
<div class="line"><a id="l01947" name="l01947"></a><span class="lineno"> 1947</span>  }</div>
<div class="line"><a id="l01948" name="l01948"></a><span class="lineno"> 1948</span>  <span class="keywordflow">return</span> R;</div>
<div class="line"><a id="l01949" name="l01949"></a><span class="lineno"> 1949</span>}</div>
</div>
<div class="line"><a id="l01950" name="l01950"></a><span class="lineno"> 1950</span><span class="comment"></span> </div>
<div class="line"><a id="l01951" name="l01951"></a><span class="lineno"> 1951</span><span class="comment">/// Propagate weights into edges</span></div>
<div class="line"><a id="l01952" name="l01952"></a><span class="lineno"> 1952</span><span class="comment">///</span></div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span><span class="comment">/// The following rules are applied to every block BB in the CFG:</span></div>
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"> 1954</span><span class="comment">///</span></div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span><span class="comment">/// - If BB has a single predecessor/successor, then the weight</span></div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span><span class="comment">///   of that edge is the weight of the block.</span></div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span><span class="comment">///</span></div>
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"> 1958</span><span class="comment">/// - If all incoming or outgoing edges are known except one, and the</span></div>
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"> 1959</span><span class="comment">///   weight of the block is already known, the weight of the unknown</span></div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span><span class="comment">///   edge will be the weight of the block minus the sum of all the known</span></div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span><span class="comment">///   edges. If the sum of all the known edges is larger than BB&#39;s weight,</span></div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span><span class="comment">///   we set the unknown edge weight to zero.</span></div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span><span class="comment">///</span></div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span><span class="comment">/// - If there is a self-referential edge, and the weight of the block is</span></div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span><span class="comment">///   known, the weight for that edge is set to the weight of the block</span></div>
<div class="line"><a id="l01966" name="l01966"></a><span class="lineno"> 1966</span><span class="comment">///   minus the weight of the other incoming edges to that block (if</span></div>
<div class="line"><a id="l01967" name="l01967"></a><span class="lineno"> 1967</span><span class="comment">///   known).</span></div>
<div class="line"><a id="l01968" name="l01968"></a><span class="lineno"> 1968</span><span class="comment"></span><span class="keywordtype">void</span> SampleProfileLoader::propagateWeights(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l01969" name="l01969"></a><span class="lineno"> 1969</span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span>  <span class="keywordtype">unsigned</span> <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0;</div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span> </div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span>  <span class="comment">// If BB weight is larger than its corresponding loop&#39;s header BB weight,</span></div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span>  <span class="comment">// use the BB weight to replace the loop header BB weight.</span></div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;BI : <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span>    <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB = &amp;BI;</div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span>    <a class="code hl_class" href="classllvm_1_1Loop.html">Loop</a> *L = LI-&gt;getLoopFor(BB);</div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span>    <span class="keywordflow">if</span> (!L) {</div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span>    }</div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span>    <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Header = L-&gt;<a class="code hl_function" href="classllvm_1_1LoopBase.html#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>();</div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span>    <span class="keywordflow">if</span> (Header &amp;&amp; BlockWeights[BB] &gt; BlockWeights[Header]) {</div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span>      BlockWeights[Header] = BlockWeights[BB];</div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span>    }</div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span>  }</div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span> </div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span>  <span class="comment">// Before propagation starts, build, for each block, a list of</span></div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span>  <span class="comment">// unique predecessors and successors. This is necessary to handle</span></div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span>  <span class="comment">// identical edges in multiway branches. Since we visit all blocks and all</span></div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span>  <span class="comment">// edges of the CFG, it is cleaner to build these lists once at the start</span></div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span>  <span class="comment">// of the pass.</span></div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span>  buildEdges(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span> </div>
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"> 1993</span>  <span class="comment">// Propagate until we converge or we go past the iteration limit.</span></div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span>  <span class="keywordflow">while</span> (<a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> &amp;&amp; <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++ &lt; <a class="code hl_variable" href="SampleProfile_8cpp.html#aade7b2da98de69a3231e8205e9770963">SampleProfileMaxPropagateIterations</a>) {</div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span>    <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">propagateThroughEdges</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span>  }</div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span> </div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span>  <span class="comment">// The first propagation propagates BB counts from annotated BBs to unknown</span></div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span>  <span class="comment">// BBs. The 2nd propagation pass resets edges weights, and use all BB weights</span></div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span>  <span class="comment">// to propagate edge weights.</span></div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span>  VisitedEdges.clear();</div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span>  <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span>  <span class="keywordflow">while</span> (<a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> &amp;&amp; <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++ &lt; <a class="code hl_variable" href="SampleProfile_8cpp.html#aade7b2da98de69a3231e8205e9770963">SampleProfileMaxPropagateIterations</a>) {</div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span>    <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">propagateThroughEdges</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span>  }</div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span> </div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span>  <span class="comment">// The 3rd propagation pass allows adjust annotated BB weights that are</span></div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span>  <span class="comment">// obviously wrong.</span></div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span>  <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span>  <span class="keywordflow">while</span> (<a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> &amp;&amp; <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++ &lt; <a class="code hl_variable" href="SampleProfile_8cpp.html#aade7b2da98de69a3231e8205e9770963">SampleProfileMaxPropagateIterations</a>) {</div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span>    <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">propagateThroughEdges</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span>  }</div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span> </div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span>  <span class="comment">// Generate MD_prof metadata for every branch instruction using the</span></div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span>  <span class="comment">// edge weights computed during propagation.</span></div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span>  <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\nPropagation complete. Setting branch weights\n&quot;</span>);</div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span>  <a class="code hl_class" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext();</div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span>  <a class="code hl_class" href="classllvm_1_1MDBuilder.html">MDBuilder</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">MDB</a>(Ctx);</div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;BI : <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span>    <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB = &amp;BI;</div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span> </div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span>    <span class="keywordflow">if</span> (BlockWeights[BB]) {</div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB-&gt;getInstList()) {</div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span>        <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;CallInst&gt;</a>(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;InvokeInst&gt;</a>(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span>        <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">cast&lt;CallBase&gt;</a>(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>).<a class="code hl_function" href="MemoryBuiltins_8cpp.html#ae600683abe0d417d21ad0a25f42de205">getCalledFunction</a>()) {</div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span>          <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1DebugLoc.html">DebugLoc</a> &amp;DLoc = <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDebugLoc();</div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span>          <span class="keywordflow">if</span> (!DLoc)</div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span>          <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1DILocation.html">DILocation</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a> = DLoc;</div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span>          <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *<a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a> = findFunctionSamples(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l02032" name="l02032"></a><span class="lineno"> 2032</span>          <span class="keywordflow">if</span> (!FS)</div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"> 2034</span>          <span class="keyword">auto</span> <a class="code hl_enumvalue" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bad7a2c9c146ac9c6636e1a009ca1e9413">CallSite</a> = <a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#ad38ceb01e0a46ee074bf51d9fb136d8f">FunctionSamples::getCallSiteIdentifier</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DIL</a>);</div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span>          <span class="keyword">auto</span> <a class="code hl_class" href="classT.html">T</a> = <a class="code hl_enumvalue" href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">FS</a>-&gt;findCallTargetMapAt(CallSite);</div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span>          <span class="keywordflow">if</span> (!<a class="code hl_class" href="classT.html">T</a> || <a class="code hl_class" href="classT.html">T</a>.get().empty())</div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span>          <span class="comment">// Prorate the callsite counts to reflect what is already done to the</span></div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span>          <span class="comment">// callsite, such as ICP or calliste cloning.</span></div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa37fe7429ffcf70c306c27a55d714d31">FunctionSamples::ProfileIsProbeBased</a>) {</div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span>            <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Optional&lt;PseudoProbe&gt;</a> Probe = <a class="code hl_function" href="namespacellvm.html#a00fba4013f1a5b882b91cad397791f9f">extractProbe</a>(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span>              <span class="keywordflow">if</span> (Probe-&gt;Factor &lt; 1)</div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span>                <a class="code hl_class" href="classT.html">T</a> = <a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleRecord.html#abfed1f1dfd251457d62aa20c4c4e95eb">SampleRecord::adjustCallTargets</a>(<a class="code hl_class" href="classT.html">T</a>.get(), Probe-&gt;Factor);</div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span>            }</div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span>          }</div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span>          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;InstrProfValueData, 2&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SortedCallTargets</a> =</div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span>              <a class="code hl_function" href="SampleProfile_8cpp.html#aaf55fbc9b8550957ceb81da6a13f54e4">GetSortedValueDataFromCallTargets</a>(<a class="code hl_class" href="classT.html">T</a>.get());</div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span>          uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>;</div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span>          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findIndirectCallFunctionSamples</a>(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>);</div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span>          <a class="code hl_function" href="namespacellvm.html#a68ee9c22fcc77e40d4ae44e5b37c7998">annotateValueSite</a>(*<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getParent()-&gt;getParent()-&gt;getParent(), <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span>                            <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SortedCallTargets</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sum</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">IPVK_IndirectCallTarget</a>,</div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span>                            <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SortedCallTargets</a>.size());</div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;IntrinsicInst&gt;</a>(&amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span>          <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setMetadata(LLVMContext::MD_prof,</div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>                        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">MDB</a>.createBranchWeights(</div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span>                            {static_cast&lt;uint32_t&gt;(BlockWeights[BB])}));</div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span>        }</div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span>      }</div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span>    }</div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span>    <a class="code hl_class" href="classllvm_1_1Instruction.html">Instruction</a> *TI = BB-&gt;getTerminator();</div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span>    <span class="keywordflow">if</span> (TI-&gt;<a class="code hl_function" href="classllvm_1_1Instruction.html#ad449a11cc9b14b0ac93bd61bd0bd9293">getNumSuccessors</a>() == 1)</div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span>    <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;BranchInst&gt;</a>(TI) &amp;&amp; !<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">isa&lt;SwitchInst&gt;</a>(TI))</div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span> </div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span>    <a class="code hl_class" href="classllvm_1_1DebugLoc.html">DebugLoc</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BranchLoc</a> = TI-&gt;<a class="code hl_function" href="classllvm_1_1Instruction.html#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>();</div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span>    <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\nGetting weights for branch at line &quot;</span></div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span>                      &lt;&lt; ((<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BranchLoc</a>) ? <a class="code hl_class" href="classllvm_1_1Twine.html">Twine</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BranchLoc</a>.getLine())</div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span>                                      : <a class="code hl_class" href="classllvm_1_1Twine.html">Twine</a>(<span class="stringliteral">&quot;&lt;UNKNOWN LOCATION&gt;&quot;</span>))</div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span>                      &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">SmallVector&lt;uint32_t, 4&gt;</a> Weights;</div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span>    <a class="code hl_class" href="classuint32__t.html">uint32_t</a> MaxWeight = 0;</div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span>    <a class="code hl_class" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">MaxDestInst</a>;</div>
<div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; TI-&gt;<a class="code hl_function" href="classllvm_1_1Instruction.html#ad449a11cc9b14b0ac93bd61bd0bd9293">getNumSuccessors</a>(); ++<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"> 2075</span>      <a class="code hl_class" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = TI-&gt;<a class="code hl_function" href="classllvm_1_1Instruction.html#a944c50b4f5440b3914f5e2a157bb0fd3">getSuccessor</a>(<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l02076" name="l02076"></a><span class="lineno"> 2076</span>      Edge <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a> = std::make_pair(BB, Succ);</div>
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span>      uint64_t Weight = EdgeWeights[<a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>];</div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span>      <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span>; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">printEdgeWeight</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), <a class="code hl_variable" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>));</div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span>      <span class="comment">// Use uint32_t saturated arithmetic to adjust the incoming weights,</span></div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span>      <span class="comment">// if needed. Sample counts in profiles are 64-bit unsigned values,</span></div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span>      <span class="comment">// but internally branch weights are expressed as 32-bit values.</span></div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span>      <span class="keywordflow">if</span> (Weight &gt; std::numeric_limits&lt;uint32_t&gt;::max()) {</div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span>        <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot; (saturated due to uint32_t overflow)&quot;</span>);</div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span>        Weight = std::numeric_limits&lt;uint32_t&gt;::max();</div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span>      }</div>
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span>      <span class="comment">// Weight is added by one to avoid propagation errors introduced by</span></div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span>      <span class="comment">// 0 weights.</span></div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span>      Weights.push_back(<span class="keyword">static_cast&lt;</span><a class="code hl_class" href="classuint32__t.html">uint32_t</a><span class="keyword">&gt;</span>(Weight + 1));</div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span>      <span class="keywordflow">if</span> (Weight != 0) {</div>
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"> 2090</span>        <span class="keywordflow">if</span> (Weight &gt; MaxWeight) {</div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span>          MaxWeight = Weight;</div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span>          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">MaxDestInst</a> = Succ-&gt;<a class="code hl_function" href="classllvm_1_1BasicBlock.html#abd8b410b10f28942f75e0bd4f7d5f79c">getFirstNonPHIOrDbgOrLifetime</a>();</div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span>        }</div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span>      }</div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span>    }</div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span> </div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span>    uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">TempWeight</a>;</div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span>    <span class="comment">// Only set weights if there is at least one non-zero weight.</span></div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span>    <span class="comment">// In any other case, let the analyzer set weights.</span></div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span>    <span class="comment">// Do not set weights if the weights are present. In ThinLTO, the profile</span></div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span>    <span class="comment">// annotation is done twice. If the first annotation already set the</span></div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span>    <span class="comment">// weights, the second pass does not need to set it.</span></div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span>    <span class="keywordflow">if</span> (MaxWeight &gt; 0 &amp;&amp; !TI-&gt;<a class="code hl_function" href="classllvm_1_1Instruction.html#a51d5735829e1f043630dd403f01d4219">extractProfTotalWeight</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">TempWeight</a>)) {</div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span>      <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SUCCESS. Found non-zero weights.\n&quot;</span>);</div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span>      TI-&gt;<a class="code hl_function" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD_prof,</div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span>                      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">MDB</a>.createBranchWeights(Weights));</div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span>      ORE-&gt;<a class="code hl_function" href="classllvm_1_1OptimizationRemarkEmitter.html#aae6a98aea85aa3af87357cc5448db499">emit</a>([&amp;]() {</div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span>        <span class="keywordflow">return</span> <a class="code hl_class" href="classllvm_1_1OptimizationRemark.html">OptimizationRemark</a>(<a class="code hl_define" href="BlockFrequencyInfoImpl_8h.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>, <span class="stringliteral">&quot;PopularDest&quot;</span>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">MaxDestInst</a>)</div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span>               &lt;&lt; <span class="stringliteral">&quot;most popular destination for conditional branches at &quot;</span></div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span>               &lt;&lt; <a class="code hl_typedef" href="namespacellvm_1_1ore.html#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(<span class="stringliteral">&quot;CondBranchesLoc&quot;</span>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">BranchLoc</a>);</div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span>      });</div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span>      <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SKIPPED. All branch weights are zero.\n&quot;</span>);</div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span>    }</div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span>  }</div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span>}</div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span><span class="comment"></span> </div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span><span class="comment">/// Get the line number for the function header.</span></div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span><span class="comment">///</span></div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span><span class="comment">/// This looks up function \p F in the current compilation unit and</span></div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span><span class="comment">/// retrieves the line number where the function is defined. This is</span></div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span><span class="comment">/// line 0 for all the samples read from the profile file. Every line</span></div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span><span class="comment">/// number is relative to this line.</span></div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span><span class="comment">///</span></div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span><span class="comment">/// \param F  Function object to query.</span></div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span><span class="comment">///</span></div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span><span class="comment">/// \returns the line number where \p F is defined. If it returns 0,</span></div>
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"> 2128</span><span class="comment">///          it means that there is no debug information available for \p F.</span></div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span><span class="comment"></span><span class="keywordtype">unsigned</span> SampleProfileLoader::getFunctionLoc(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"> 2130</span>  <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1DISubprogram.html">DISubprogram</a> *S = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.<a class="code hl_function" href="classllvm_1_1DILocalScope.html#a0e0b4a5906e0bc2a7fa033548c59a220">getSubprogram</a>())</div>
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"> 2131</span>    <span class="keywordflow">return</span> S-&gt;getLine();</div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"> 2132</span> </div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="SampleProfile_8cpp.html#a0200f3202920f714e0b23c4606a27192">NoWarnSampleUnused</a>)</div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span> </div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span>  <span class="comment">// If the start of \p F is missing, emit a diagnostic to inform the user</span></div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span>  <span class="comment">// about the missed opportunity.</span></div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span>  <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext().diagnose(<a class="code hl_class" href="classllvm_1_1DiagnosticInfoSampleProfile.html">DiagnosticInfoSampleProfile</a>(</div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span>      <span class="stringliteral">&quot;No debug information found in function &quot;</span> + <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() +</div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span>          <span class="stringliteral">&quot;: Function profile not used&quot;</span>,</div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span>      <a class="code hl_enumvalue" href="namespacellvm.html#abfcab32516704f11d146c757f402ad5ca1cde8c8828756cdaf2a93260e247ae31">DS_Warning</a>));</div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span>}</div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span> </div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span><span class="keywordtype">void</span> SampleProfileLoader::computeDominanceAndLoopInfo(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span>  DT.reset(<span class="keyword">new</span> <a class="code hl_class" href="classllvm_1_1DominatorTree.html">DominatorTree</a>);</div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span>  DT-&gt;recalculate(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span> </div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span>  PDT.reset(<span class="keyword">new</span> <a class="code hl_class" href="classllvm_1_1PostDominatorTree.html">PostDominatorTree</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</div>
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"> 2150</span> </div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"> 2151</span>  LI.reset(<span class="keyword">new</span> <a class="code hl_class" href="classllvm_1_1LoopInfo.html">LoopInfo</a>);</div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span>  LI-&gt;analyze(*DT);</div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span>}</div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span><span class="comment"></span> </div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span><span class="comment">/// Generate branch weight metadata for all branches in \p F.</span></div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span><span class="comment">///</span></div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span><span class="comment">/// Branch weights are computed out of instruction samples using a</span></div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span><span class="comment">/// propagation heuristic. Propagation proceeds in 3 phases:</span></div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span><span class="comment">///</span></div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span><span class="comment">/// 1- Assignment of block weights. All the basic blocks in the function</span></div>
<div class="line"><a id="l02161" name="l02161"></a><span class="lineno"> 2161</span><span class="comment">///    are initial assigned the same weight as their most frequently</span></div>
<div class="line"><a id="l02162" name="l02162"></a><span class="lineno"> 2162</span><span class="comment">///    executed instruction.</span></div>
<div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span><span class="comment">///</span></div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span><span class="comment">/// 2- Creation of equivalence classes. Since samples may be missing from</span></div>
<div class="line"><a id="l02165" name="l02165"></a><span class="lineno"> 2165</span><span class="comment">///    blocks, we can fill in the gaps by setting the weights of all the</span></div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span><span class="comment">///    blocks in the same equivalence class to the same weight. To compute</span></div>
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"> 2167</span><span class="comment">///    the concept of equivalence, we use dominance and loop information.</span></div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span><span class="comment">///    Two blocks B1 and B2 are in the same equivalence class if B1</span></div>
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"> 2169</span><span class="comment">///    dominates B2, B2 post-dominates B1 and both are in the same loop.</span></div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span><span class="comment">///</span></div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span><span class="comment">/// 3- Propagation of block weights into edges. This uses a simple</span></div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span><span class="comment">///    propagation heuristic. The following rules are applied to every</span></div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span><span class="comment">///    block BB in the CFG:</span></div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span><span class="comment">///</span></div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span><span class="comment">///    - If BB has a single predecessor/successor, then the weight</span></div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span><span class="comment">///      of that edge is the weight of the block.</span></div>
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"> 2177</span><span class="comment">///</span></div>
<div class="line"><a id="l02178" name="l02178"></a><span class="lineno"> 2178</span><span class="comment">///    - If all the edges are known except one, and the weight of the</span></div>
<div class="line"><a id="l02179" name="l02179"></a><span class="lineno"> 2179</span><span class="comment">///      block is already known, the weight of the unknown edge will</span></div>
<div class="line"><a id="l02180" name="l02180"></a><span class="lineno"> 2180</span><span class="comment">///      be the weight of the block minus the sum of all the known</span></div>
<div class="line"><a id="l02181" name="l02181"></a><span class="lineno"> 2181</span><span class="comment">///      edges. If the sum of all the known edges is larger than BB&#39;s weight,</span></div>
<div class="line"><a id="l02182" name="l02182"></a><span class="lineno"> 2182</span><span class="comment">///      we set the unknown edge weight to zero.</span></div>
<div class="line"><a id="l02183" name="l02183"></a><span class="lineno"> 2183</span><span class="comment">///</span></div>
<div class="line"><a id="l02184" name="l02184"></a><span class="lineno"> 2184</span><span class="comment">///    - If there is a self-referential edge, and the weight of the block is</span></div>
<div class="line"><a id="l02185" name="l02185"></a><span class="lineno"> 2185</span><span class="comment">///      known, the weight for that edge is set to the weight of the block</span></div>
<div class="line"><a id="l02186" name="l02186"></a><span class="lineno"> 2186</span><span class="comment">///      minus the weight of the other incoming edges to that block (if</span></div>
<div class="line"><a id="l02187" name="l02187"></a><span class="lineno"> 2187</span><span class="comment">///      known).</span></div>
<div class="line"><a id="l02188" name="l02188"></a><span class="lineno"> 2188</span><span class="comment">///</span></div>
<div class="line"><a id="l02189" name="l02189"></a><span class="lineno"> 2189</span><span class="comment">/// Since this propagation is not guaranteed to finalize for every CFG, we</span></div>
<div class="line"><a id="l02190" name="l02190"></a><span class="lineno"> 2190</span><span class="comment">/// only allow it to proceed for a limited number of iterations (controlled</span></div>
<div class="line"><a id="l02191" name="l02191"></a><span class="lineno"> 2191</span><span class="comment">/// by -sample-profile-max-propagate-iterations).</span></div>
<div class="line"><a id="l02192" name="l02192"></a><span class="lineno"> 2192</span><span class="comment">///</span></div>
<div class="line"><a id="l02193" name="l02193"></a><span class="lineno"> 2193</span><span class="comment">/// FIXME: Try to replace this propagation heuristic with a scheme</span></div>
<div class="line"><a id="l02194" name="l02194"></a><span class="lineno"> 2194</span><span class="comment">/// that is guaranteed to finalize. A work-list approach similar to</span></div>
<div class="line"><a id="l02195" name="l02195"></a><span class="lineno"> 2195</span><span class="comment">/// the standard value propagation algorithm used by SSA-CCP might</span></div>
<div class="line"><a id="l02196" name="l02196"></a><span class="lineno"> 2196</span><span class="comment">/// work here.</span></div>
<div class="line"><a id="l02197" name="l02197"></a><span class="lineno"> 2197</span><span class="comment">///</span></div>
<div class="line"><a id="l02198" name="l02198"></a><span class="lineno"> 2198</span><span class="comment">/// Once all the branch weights are computed, we emit the MD_prof</span></div>
<div class="line"><a id="l02199" name="l02199"></a><span class="lineno"> 2199</span><span class="comment">/// metadata on BB using the computed values for each of its branches.</span></div>
<div class="line"><a id="l02200" name="l02200"></a><span class="lineno"> 2200</span><span class="comment">///</span></div>
<div class="line"><a id="l02201" name="l02201"></a><span class="lineno"> 2201</span><span class="comment">/// \param F The function to query.</span></div>
<div class="line"><a id="l02202" name="l02202"></a><span class="lineno"> 2202</span><span class="comment">///</span></div>
<div class="line"><a id="l02203" name="l02203"></a><span class="lineno"> 2203</span><span class="comment">/// \returns true if \p F was modified. Returns false, otherwise.</span></div>
<div class="line"><a id="l02204" name="l02204"></a><span class="lineno"> 2204</span><span class="comment"></span><span class="keywordtype">bool</span> SampleProfileLoader::emitAnnotations(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l02205" name="l02205"></a><span class="lineno"> 2205</span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02206" name="l02206"></a><span class="lineno"> 2206</span> </div>
<div class="line"><a id="l02207" name="l02207"></a><span class="lineno"> 2207</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa37fe7429ffcf70c306c27a55d714d31">FunctionSamples::ProfileIsProbeBased</a>) {</div>
<div class="line"><a id="l02208" name="l02208"></a><span class="lineno"> 2208</span>    <span class="keywordflow">if</span> (!ProbeManager-&gt;profileIsValid(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, *Samples)) {</div>
<div class="line"><a id="l02209" name="l02209"></a><span class="lineno"> 2209</span>      <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a id="l02210" name="l02210"></a><span class="lineno"> 2210</span>          <a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Profile is invalid due to CFG mismatch for Function &quot;</span></div>
<div class="line"><a id="l02211" name="l02211"></a><span class="lineno"> 2211</span>                 &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName());</div>
<div class="line"><a id="l02212" name="l02212"></a><span class="lineno"> 2212</span>      ++<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumMismatchedProfile</a>;</div>
<div class="line"><a id="l02213" name="l02213"></a><span class="lineno"> 2213</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02214" name="l02214"></a><span class="lineno"> 2214</span>    }</div>
<div class="line"><a id="l02215" name="l02215"></a><span class="lineno"> 2215</span>    ++<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NumMatchedProfile</a>;</div>
<div class="line"><a id="l02216" name="l02216"></a><span class="lineno"> 2216</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02217" name="l02217"></a><span class="lineno"> 2217</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getFunctionLoc</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) == 0)</div>
<div class="line"><a id="l02218" name="l02218"></a><span class="lineno"> 2218</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02219" name="l02219"></a><span class="lineno"> 2219</span> </div>
<div class="line"><a id="l02220" name="l02220"></a><span class="lineno"> 2220</span>    <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Line number for the first instruction in &quot;</span></div>
<div class="line"><a id="l02221" name="l02221"></a><span class="lineno"> 2221</span>                      &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getFunctionLoc</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a id="l02222" name="l02222"></a><span class="lineno"> 2222</span>  }</div>
<div class="line"><a id="l02223" name="l02223"></a><span class="lineno"> 2223</span> </div>
<div class="line"><a id="l02224" name="l02224"></a><span class="lineno"> 2224</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseSet&lt;GlobalValue::GUID&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>;</div>
<div class="line"><a id="l02225" name="l02225"></a><span class="lineno"> 2225</span>  <span class="keywordflow">if</span> (ProfileIsCS &amp;&amp; <a class="code hl_variable" href="SampleProfile_8cpp.html#a582e224bc99dcf3ca6263cdd9b25d94f">CallsitePrioritizedInline</a>)</div>
<div class="line"><a id="l02226" name="l02226"></a><span class="lineno"> 2226</span>    <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> |= <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">inlineHotFunctionsWithPriority</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>);</div>
<div class="line"><a id="l02227" name="l02227"></a><span class="lineno"> 2227</span>  <span class="keywordflow">else</span></div>
<div class="line"><a id="l02228" name="l02228"></a><span class="lineno"> 2228</span>    <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> |= <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">inlineHotFunctions</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>);</div>
<div class="line"><a id="l02229" name="l02229"></a><span class="lineno"> 2229</span> </div>
<div class="line"><a id="l02230" name="l02230"></a><span class="lineno"> 2230</span>  <span class="comment">// Compute basic block weights.</span></div>
<div class="line"><a id="l02231" name="l02231"></a><span class="lineno"> 2231</span>  <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a> |= <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">computeBlockWeights</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02232" name="l02232"></a><span class="lineno"> 2232</span> </div>
<div class="line"><a id="l02233" name="l02233"></a><span class="lineno"> 2233</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a>) {</div>
<div class="line"><a id="l02234" name="l02234"></a><span class="lineno"> 2234</span>    <span class="comment">// Add an entry count to the function using the samples gathered at the</span></div>
<div class="line"><a id="l02235" name="l02235"></a><span class="lineno"> 2235</span>    <span class="comment">// function entry.</span></div>
<div class="line"><a id="l02236" name="l02236"></a><span class="lineno"> 2236</span>    <span class="comment">// Sets the GUIDs that are inlined in the profiled binary. This is used</span></div>
<div class="line"><a id="l02237" name="l02237"></a><span class="lineno"> 2237</span>    <span class="comment">// for ThinLink to make correct liveness analysis, and also make the IR</span></div>
<div class="line"><a id="l02238" name="l02238"></a><span class="lineno"> 2238</span>    <span class="comment">// match the profiled binary before annotation.</span></div>
<div class="line"><a id="l02239" name="l02239"></a><span class="lineno"> 2239</span>    <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setEntryCount(</div>
<div class="line"><a id="l02240" name="l02240"></a><span class="lineno"> 2240</span>        <a class="code hl_typedef" href="Function_8cpp.html#ac57dae906fe8ac64efe52571121b0fe1">ProfileCount</a>(Samples-&gt;getHeadSamples() + 1, <a class="code hl_enumvalue" href="classllvm_1_1Function.html#a438d2f246b76817114ade2a005a6bcabac7dbc704eba08842e6acdde9cf6379ba">Function::PCT_Real</a>),</div>
<div class="line"><a id="l02241" name="l02241"></a><span class="lineno"> 2241</span>        &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedGUIDs</a>);</div>
<div class="line"><a id="l02242" name="l02242"></a><span class="lineno"> 2242</span> </div>
<div class="line"><a id="l02243" name="l02243"></a><span class="lineno"> 2243</span>    <span class="comment">// Compute dominance and loop info needed for propagation.</span></div>
<div class="line"><a id="l02244" name="l02244"></a><span class="lineno"> 2244</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">computeDominanceAndLoopInfo</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02245" name="l02245"></a><span class="lineno"> 2245</span> </div>
<div class="line"><a id="l02246" name="l02246"></a><span class="lineno"> 2246</span>    <span class="comment">// Find equivalence classes.</span></div>
<div class="line"><a id="l02247" name="l02247"></a><span class="lineno"> 2247</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">findEquivalenceClasses</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02248" name="l02248"></a><span class="lineno"> 2248</span> </div>
<div class="line"><a id="l02249" name="l02249"></a><span class="lineno"> 2249</span>    <span class="comment">// Propagate weights to all edges.</span></div>
<div class="line"><a id="l02250" name="l02250"></a><span class="lineno"> 2250</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">propagateWeights</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02251" name="l02251"></a><span class="lineno"> 2251</span>  }</div>
<div class="line"><a id="l02252" name="l02252"></a><span class="lineno"> 2252</span> </div>
<div class="line"><a id="l02253" name="l02253"></a><span class="lineno"> 2253</span>  <span class="comment">// If coverage checking was requested, compute it now.</span></div>
<div class="line"><a id="l02254" name="l02254"></a><span class="lineno"> 2254</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="SampleProfile_8cpp.html#a40954848b5b26403e461ce7a190243d4">SampleProfileRecordCoverage</a>) {</div>
<div class="line"><a id="l02255" name="l02255"></a><span class="lineno"> 2255</span>    <span class="keywordtype">unsigned</span> Used = CoverageTracker.countUsedRecords(Samples, PSI);</div>
<div class="line"><a id="l02256" name="l02256"></a><span class="lineno"> 2256</span>    <span class="keywordtype">unsigned</span> Total = CoverageTracker.countBodyRecords(Samples, PSI);</div>
<div class="line"><a id="l02257" name="l02257"></a><span class="lineno"> 2257</span>    <span class="keywordtype">unsigned</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Coverage</a> = CoverageTracker.computeCoverage(Used, Total);</div>
<div class="line"><a id="l02258" name="l02258"></a><span class="lineno"> 2258</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Coverage</a> &lt; <a class="code hl_variable" href="SampleProfile_8cpp.html#a40954848b5b26403e461ce7a190243d4">SampleProfileRecordCoverage</a>) {</div>
<div class="line"><a id="l02259" name="l02259"></a><span class="lineno"> 2259</span>      <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext().diagnose(<a class="code hl_class" href="classllvm_1_1DiagnosticInfoSampleProfile.html">DiagnosticInfoSampleProfile</a>(</div>
<div class="line"><a id="l02260" name="l02260"></a><span class="lineno"> 2260</span>          <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getSubprogram()-&gt;getFilename(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getFunctionLoc</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>),</div>
<div class="line"><a id="l02261" name="l02261"></a><span class="lineno"> 2261</span>          <a class="code hl_class" href="classllvm_1_1Twine.html">Twine</a>(Used) + <span class="stringliteral">&quot; of &quot;</span> + <a class="code hl_class" href="classllvm_1_1Twine.html">Twine</a>(Total) + <span class="stringliteral">&quot; available profile records (&quot;</span> +</div>
<div class="line"><a id="l02262" name="l02262"></a><span class="lineno"> 2262</span>              <a class="code hl_class" href="classllvm_1_1Twine.html">Twine</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Coverage</a>) + <span class="stringliteral">&quot;%) were applied&quot;</span>,</div>
<div class="line"><a id="l02263" name="l02263"></a><span class="lineno"> 2263</span>          <a class="code hl_enumvalue" href="namespacellvm.html#abfcab32516704f11d146c757f402ad5ca1cde8c8828756cdaf2a93260e247ae31">DS_Warning</a>));</div>
<div class="line"><a id="l02264" name="l02264"></a><span class="lineno"> 2264</span>    }</div>
<div class="line"><a id="l02265" name="l02265"></a><span class="lineno"> 2265</span>  }</div>
<div class="line"><a id="l02266" name="l02266"></a><span class="lineno"> 2266</span> </div>
<div class="line"><a id="l02267" name="l02267"></a><span class="lineno"> 2267</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="SampleProfile_8cpp.html#a8ac02d9aff84c95f5894d9f7ef8c5e4a">SampleProfileSampleCoverage</a>) {</div>
<div class="line"><a id="l02268" name="l02268"></a><span class="lineno"> 2268</span>    uint64_t Used = CoverageTracker.getTotalUsedSamples();</div>
<div class="line"><a id="l02269" name="l02269"></a><span class="lineno"> 2269</span>    uint64_t Total = CoverageTracker.countBodySamples(Samples, PSI);</div>
<div class="line"><a id="l02270" name="l02270"></a><span class="lineno"> 2270</span>    <span class="keywordtype">unsigned</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Coverage</a> = CoverageTracker.computeCoverage(Used, Total);</div>
<div class="line"><a id="l02271" name="l02271"></a><span class="lineno"> 2271</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Coverage</a> &lt; <a class="code hl_variable" href="SampleProfile_8cpp.html#a8ac02d9aff84c95f5894d9f7ef8c5e4a">SampleProfileSampleCoverage</a>) {</div>
<div class="line"><a id="l02272" name="l02272"></a><span class="lineno"> 2272</span>      <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext().diagnose(<a class="code hl_class" href="classllvm_1_1DiagnosticInfoSampleProfile.html">DiagnosticInfoSampleProfile</a>(</div>
<div class="line"><a id="l02273" name="l02273"></a><span class="lineno"> 2273</span>          <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getSubprogram()-&gt;getFilename(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getFunctionLoc</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>),</div>
<div class="line"><a id="l02274" name="l02274"></a><span class="lineno"> 2274</span>          <a class="code hl_class" href="classllvm_1_1Twine.html">Twine</a>(Used) + <span class="stringliteral">&quot; of &quot;</span> + <a class="code hl_class" href="classllvm_1_1Twine.html">Twine</a>(Total) + <span class="stringliteral">&quot; available profile samples (&quot;</span> +</div>
<div class="line"><a id="l02275" name="l02275"></a><span class="lineno"> 2275</span>              <a class="code hl_class" href="classllvm_1_1Twine.html">Twine</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Coverage</a>) + <span class="stringliteral">&quot;%) were applied&quot;</span>,</div>
<div class="line"><a id="l02276" name="l02276"></a><span class="lineno"> 2276</span>          <a class="code hl_enumvalue" href="namespacellvm.html#abfcab32516704f11d146c757f402ad5ca1cde8c8828756cdaf2a93260e247ae31">DS_Warning</a>));</div>
<div class="line"><a id="l02277" name="l02277"></a><span class="lineno"> 2277</span>    }</div>
<div class="line"><a id="l02278" name="l02278"></a><span class="lineno"> 2278</span>  }</div>
<div class="line"><a id="l02279" name="l02279"></a><span class="lineno"> 2279</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a>;</div>
<div class="line"><a id="l02280" name="l02280"></a><span class="lineno"> 2280</span>}</div>
<div class="line"><a id="l02281" name="l02281"></a><span class="lineno"> 2281</span> </div>
<div class="line"><a id="l02282" name="l02282"></a><span class="lineno"> 2282</span><span class="keywordtype">char</span> SampleProfileLoaderLegacyPass::ID = 0;</div>
<div class="line"><a id="l02283" name="l02283"></a><span class="lineno"> 2283</span> </div>
<div class="line"><a id="l02284" name="l02284"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#a9c61d2d479bce8e59a01b4095d381961"> 2284</a></span><a class="code hl_define" href="PassSupport_8h.html#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE_PASS_BEGIN</a>(SampleProfileLoaderLegacyPass, <span class="stringliteral">&quot;sample-profile&quot;</span>,</div>
<div class="line"><a id="l02285" name="l02285"></a><span class="lineno"> 2285</span>                      <span class="stringliteral">&quot;Sample Profile loader&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div>
<div class="line"><a id="l02286" name="l02286"></a><span class="lineno"> 2286</span><a class="code hl_define" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code hl_class" href="classllvm_1_1AssumptionCacheTracker.html">AssumptionCacheTracker</a>)</div>
<div class="line"><a id="l02287" name="l02287"></a><span class="lineno"> 2287</span><a class="code hl_define" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code hl_class" href="classllvm_1_1TargetTransformInfoWrapperPass.html">TargetTransformInfoWrapperPass</a>)</div>
<div class="line"><a id="l02288" name="l02288"></a><span class="lineno"> 2288</span><a class="code hl_define" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code hl_class" href="classllvm_1_1TargetLibraryInfoWrapperPass.html">TargetLibraryInfoWrapperPass</a>)</div>
<div class="line"><a id="l02289" name="l02289"></a><span class="lineno"> 2289</span><a class="code hl_define" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code hl_class" href="classllvm_1_1ProfileSummaryInfoWrapperPass.html">ProfileSummaryInfoWrapperPass</a>)</div>
<div class="line"><a id="l02290" name="l02290"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#ab9c03ccea8a95213cc02502d0a8216a2"> 2290</a></span><a class="code hl_define" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(SampleProfileLoaderLegacyPass, &quot;sample-profile&quot;,</div>
<div class="line"><a id="l02291" name="l02291"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#aea50f65dff46ad92ec79209f5167d63c"> 2291</a></span>                    &quot;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">Sample</a> Profile <a class="code hl_variable" href="SampleProfile_8cpp.html#aa6d0a32738af9bd060dcfe35c6ee4b44">loader</a>&quot;, <a class="code hl_namespace" href="namespacefalse.html">false</a>, <a class="code hl_namespace" href="namespacefalse.html">false</a>)</div>
<div class="line"><a id="l02292" name="l02292"></a><span class="lineno"> 2292</span> </div>
<div class="line"><a id="l02293" name="l02293"></a><span class="lineno"> 2293</span><span class="comment">// Add inlined profile call edges to the call graph.</span></div>
<div class="line"><a id="l02294" name="l02294"></a><span class="lineno"> 2294</span><span class="keywordtype">void</span> SampleProfileLoader::addCallGraphEdges(<a class="code hl_class" href="classllvm_1_1CallGraph.html">CallGraph</a> &amp;<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>,</div>
<div class="line"><a id="l02295" name="l02295"></a><span class="lineno"> 2295</span>                                            <a class="code hl_variable" href="AArch64PromoteConstant_8cpp.html#a90f8350fecae261c25be85d38b451bff">const</a> <a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> &amp;Samples) {</div>
<div class="line"><a id="l02296" name="l02296"></a><span class="lineno"> 2296</span>  <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *Caller = SymbolMap.<a class="code hl_function" href="classllvm_1_1DenseMapBase.html#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(Samples.getFuncName());</div>
<div class="line"><a id="l02297" name="l02297"></a><span class="lineno"> 2297</span>  <span class="keywordflow">if</span> (!Caller || Caller-&gt;isDeclaration())</div>
<div class="line"><a id="l02298" name="l02298"></a><span class="lineno"> 2298</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02299" name="l02299"></a><span class="lineno"> 2299</span> </div>
<div class="line"><a id="l02300" name="l02300"></a><span class="lineno"> 2300</span>  <span class="comment">// Skip non-inlined call edges which are not important since top down inlining</span></div>
<div class="line"><a id="l02301" name="l02301"></a><span class="lineno"> 2301</span>  <span class="comment">// for non-CS profile is to get more precise profile matching, not to enable</span></div>
<div class="line"><a id="l02302" name="l02302"></a><span class="lineno"> 2302</span>  <span class="comment">// more inlining.</span></div>
<div class="line"><a id="l02303" name="l02303"></a><span class="lineno"> 2303</span> </div>
<div class="line"><a id="l02304" name="l02304"></a><span class="lineno"> 2304</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;CallsiteSamples : Samples.getCallsiteSamples()) {</div>
<div class="line"><a id="l02305" name="l02305"></a><span class="lineno"> 2305</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedSamples</a> : CallsiteSamples.second) {</div>
<div class="line"><a id="l02306" name="l02306"></a><span class="lineno"> 2306</span>      <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> = SymbolMap.<a class="code hl_function" href="classllvm_1_1DenseMapBase.html#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedSamples</a>.first);</div>
<div class="line"><a id="l02307" name="l02307"></a><span class="lineno"> 2307</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> &amp;&amp; !<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>-&gt;isDeclaration())</div>
<div class="line"><a id="l02308" name="l02308"></a><span class="lineno"> 2308</span>        <a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>[Caller]-&gt;addCalledFunction(<span class="keyword">nullptr</span>, <a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>[<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>]);</div>
<div class="line"><a id="l02309" name="l02309"></a><span class="lineno"> 2309</span>      addCallGraphEdges(<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">InlinedSamples</a>.second);</div>
<div class="line"><a id="l02310" name="l02310"></a><span class="lineno"> 2310</span>    }</div>
<div class="line"><a id="l02311" name="l02311"></a><span class="lineno"> 2311</span>  }</div>
<div class="line"><a id="l02312" name="l02312"></a><span class="lineno"> 2312</span>}</div>
<div class="line"><a id="l02313" name="l02313"></a><span class="lineno"> 2313</span> </div>
<div class="line"><a id="l02314" name="l02314"></a><span class="lineno"> 2314</span><span class="comment">// Replace call graph edges with dynamic call edges from the profile.</span></div>
<div class="line"><a id="l02315" name="l02315"></a><span class="lineno"> 2315</span><span class="keywordtype">void</span> SampleProfileLoader::replaceCallGraphEdges(</div>
<div class="line"><a id="l02316" name="l02316"></a><span class="lineno"> 2316</span>    <a class="code hl_class" href="classllvm_1_1CallGraph.html">CallGraph</a> &amp;<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>, <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">StringMap&lt;Function *&gt;</a> &amp;SymbolMap) {</div>
<div class="line"><a id="l02317" name="l02317"></a><span class="lineno"> 2317</span>  <span class="comment">// Remove static call edges from the call graph except for the ones from the</span></div>
<div class="line"><a id="l02318" name="l02318"></a><span class="lineno"> 2318</span>  <span class="comment">// root which make the call graph connected.</span></div>
<div class="line"><a id="l02319" name="l02319"></a><span class="lineno"> 2319</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_class" href="classNode.html">Node</a> : <a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>)</div>
<div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span>    <a class="code hl_function" href="AArch64AdvSIMDScalarPass_8cpp.html#afb944a33b354e4709fb99864f82b9c16">if</a> (<a class="code hl_class" href="classNode.html">Node</a>.second.get() != <a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>.getExternalCallingNode())</div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span>      <a class="code hl_class" href="classNode.html">Node</a>.second-&gt;removeAllCalledFunctions();</div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span> </div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span>  <span class="comment">// Add profile call edges to the call graph.</span></div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span>  <span class="keywordflow">if</span> (ProfileIsCS) {</div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span>    ContextTracker-&gt;addCallGraphEdges(<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>, SymbolMap);</div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"> 2327</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Samples : Reader-&gt;getProfiles())</div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span>      addCallGraphEdges(<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>, Samples.second);</div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span>  }</div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span>}</div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span> </div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span>std::vector&lt;Function *&gt;</div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span>SampleProfileLoader::buildFunctionOrder(<a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;M, <a class="code hl_class" href="classllvm_1_1CallGraph.html">CallGraph</a> *<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>) {</div>
<div class="line"><a id="l02334" name="l02334"></a><span class="lineno"> 2334</span>  std::vector&lt;Function *&gt; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>;</div>
<div class="line"><a id="l02335" name="l02335"></a><span class="lineno"> 2335</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>.reserve(M.size());</div>
<div class="line"><a id="l02336" name="l02336"></a><span class="lineno"> 2336</span> </div>
<div class="line"><a id="l02337" name="l02337"></a><span class="lineno"> 2337</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SampleProfile_8cpp.html#aeeed05c14d5103af2df4ef16b3d12674">ProfileTopDownLoad</a> || <a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a> == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l02338" name="l02338"></a><span class="lineno"> 2338</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="SampleProfile_8cpp.html#a8b16dbb3ebefd05908afe3a7874d6353">ProfileMergeInlinee</a>) {</div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span>      <span class="comment">// Disable ProfileMergeInlinee if profile is not loaded in top down order,</span></div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span>      <span class="comment">// because the profile for a function may be used for the profile</span></div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span>      <span class="comment">// annotation of its outline copy before the profile merging of its</span></div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span>      <span class="comment">// non-inlined inline instances, and that is not the way how</span></div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span>      <span class="comment">// ProfileMergeInlinee is supposed to work.</span></div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span>      <a class="code hl_variable" href="SampleProfile_8cpp.html#a8b16dbb3ebefd05908afe3a7874d6353">ProfileMergeInlinee</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span>    }</div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span> </div>
<div class="line"><a id="l02347" name="l02347"></a><span class="lineno"> 2347</span>    <span class="keywordflow">for</span> (<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : M)</div>
<div class="line"><a id="l02348" name="l02348"></a><span class="lineno"> 2348</span>      <a class="code hl_function" href="AArch64AdvSIMDScalarPass_8cpp.html#afb944a33b354e4709fb99864f82b9c16">if</a> (!<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration() &amp;&amp; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(<span class="stringliteral">&quot;use-sample-profile&quot;</span>))</div>
<div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>.push_back(&amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span>    <span class="keywordflow">return</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>;</div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span>  }</div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span> </div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span>  <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&amp;<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>-&gt;getModule() == &amp;M);</div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"> 2354</span> </div>
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"> 2355</span>  <span class="comment">// Add indirect call edges from profile to augment the static call graph.</span></div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"> 2356</span>  <span class="comment">// Functions will be processed in a top-down order defined by the static call</span></div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span>  <span class="comment">// graph. Adjusting the order by considering indirect call edges from the</span></div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span>  <span class="comment">// profile (which don&#39;t exist in the static call graph) can enable the</span></div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span>  <span class="comment">// inlining of indirect call targets by processing the caller before them.</span></div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span>  <span class="comment">// TODO: enable this for non-CS profile and fix the counts returning logic to</span></div>
<div class="line"><a id="l02361" name="l02361"></a><span class="lineno"> 2361</span>  <span class="comment">// have a full support for indirect calls.</span></div>
<div class="line"><a id="l02362" name="l02362"></a><span class="lineno"> 2362</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="SampleProfile_8cpp.html#a4e4de7b815d127b5177401937420c294">UseProfileIndirectCallEdges</a> &amp;&amp; ProfileIsCS) {</div>
<div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Entry : *<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>) {</div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span>      <span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = Entry.first;</div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span>      <span class="keywordflow">if</span> (!<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> || <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isDeclaration() || !<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasFnAttribute(<span class="stringliteral">&quot;use-sample-profile&quot;</span>))</div>
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"> 2366</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02367" name="l02367"></a><span class="lineno"> 2367</span>      <span class="keyword">auto</span> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">AllContexts</a> = ContextTracker-&gt;getAllContextSamplesFor(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName());</div>
<div class="line"><a id="l02368" name="l02368"></a><span class="lineno"> 2368</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">AllContexts</a>.empty())</div>
<div class="line"><a id="l02369" name="l02369"></a><span class="lineno"> 2369</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02370" name="l02370"></a><span class="lineno"> 2370</span> </div>
<div class="line"><a id="l02371" name="l02371"></a><span class="lineno"> 2371</span>      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;BB : *<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a id="l02372" name="l02372"></a><span class="lineno"> 2372</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB.getInstList()) {</div>
<div class="line"><a id="l02373" name="l02373"></a><span class="lineno"> 2373</span>          <span class="keyword">const</span> <span class="keyword">auto</span> *CB = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">dyn_cast&lt;CallBase&gt;</a>(&amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a id="l02374" name="l02374"></a><span class="lineno"> 2374</span>          <span class="keywordflow">if</span> (!CB || !CB-&gt;<a class="code hl_function" href="classllvm_1_1CallBase.html#a574efc7d85ff014d5f15e077f3c82e6b">isIndirectCall</a>())</div>
<div class="line"><a id="l02375" name="l02375"></a><span class="lineno"> 2375</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02376" name="l02376"></a><span class="lineno"> 2376</span>          <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1DebugLoc.html">DebugLoc</a> &amp;DLoc = <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDebugLoc();</div>
<div class="line"><a id="l02377" name="l02377"></a><span class="lineno"> 2377</span>          <span class="keywordflow">if</span> (!DLoc)</div>
<div class="line"><a id="l02378" name="l02378"></a><span class="lineno"> 2378</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02379" name="l02379"></a><span class="lineno"> 2379</span>          <span class="keyword">auto</span> <a class="code hl_enumvalue" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bad7a2c9c146ac9c6636e1a009ca1e9413">CallSite</a> = <a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#ad38ceb01e0a46ee074bf51d9fb136d8f">FunctionSamples::getCallSiteIdentifier</a>(DLoc);</div>
<div class="line"><a id="l02380" name="l02380"></a><span class="lineno"> 2380</span>          <span class="keywordflow">for</span> (<a class="code hl_class" href="classllvm_1_1sampleprof_1_1FunctionSamples.html">FunctionSamples</a> *Samples : <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">AllContexts</a>) {</div>
<div class="line"><a id="l02381" name="l02381"></a><span class="lineno"> 2381</span>            <span class="keywordflow">if</span> (<span class="keyword">auto</span> CallTargets = Samples-&gt;findCallTargetMapAt(CallSite)) {</div>
<div class="line"><a id="l02382" name="l02382"></a><span class="lineno"> 2382</span>              <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_class" href="classllvm_1_1Target.html">Target</a> : CallTargets.get()) {</div>
<div class="line"><a id="l02383" name="l02383"></a><span class="lineno"> 2383</span>                <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> = <a class="code hl_typedef" href="namespacellvm_1_1orc.html#a6a31d56a05a94b79b1c5eb0b85ae0283">SymbolMap</a>.<a class="code hl_function" href="classllvm_1_1DenseMapBase.html#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(<a class="code hl_class" href="classllvm_1_1Target.html">Target</a>.first());</div>
<div class="line"><a id="l02384" name="l02384"></a><span class="lineno"> 2384</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> &amp;&amp; !<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>-&gt;isDeclaration())</div>
<div class="line"><a id="l02385" name="l02385"></a><span class="lineno"> 2385</span>                  Entry.second-&gt;addCalledFunction(<span class="keyword">nullptr</span>, (*<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>)[<a class="code hl_variable" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>]);</div>
<div class="line"><a id="l02386" name="l02386"></a><span class="lineno"> 2386</span>              }</div>
<div class="line"><a id="l02387" name="l02387"></a><span class="lineno"> 2387</span>            }</div>
<div class="line"><a id="l02388" name="l02388"></a><span class="lineno"> 2388</span>          }</div>
<div class="line"><a id="l02389" name="l02389"></a><span class="lineno"> 2389</span>        }</div>
<div class="line"><a id="l02390" name="l02390"></a><span class="lineno"> 2390</span>      }</div>
<div class="line"><a id="l02391" name="l02391"></a><span class="lineno"> 2391</span>    }</div>
<div class="line"><a id="l02392" name="l02392"></a><span class="lineno"> 2392</span>  }</div>
<div class="line"><a id="l02393" name="l02393"></a><span class="lineno"> 2393</span> </div>
<div class="line"><a id="l02394" name="l02394"></a><span class="lineno"> 2394</span>  <span class="comment">// Compute a top-down order the profile which is used to sort functions in</span></div>
<div class="line"><a id="l02395" name="l02395"></a><span class="lineno"> 2395</span>  <span class="comment">// one SCC later. The static processing order computed for an SCC may not</span></div>
<div class="line"><a id="l02396" name="l02396"></a><span class="lineno"> 2396</span>  <span class="comment">// reflect the call contexts in the context-sensitive profile, thus may cause</span></div>
<div class="line"><a id="l02397" name="l02397"></a><span class="lineno"> 2397</span>  <span class="comment">// potential inlining to be overlooked. The function order in one SCC is being</span></div>
<div class="line"><a id="l02398" name="l02398"></a><span class="lineno"> 2398</span>  <span class="comment">// adjusted to a top-down order based on the profile to favor more inlining.</span></div>
<div class="line"><a id="l02399" name="l02399"></a><span class="lineno"> 2399</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">DenseMap&lt;Function *, uint64_t&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ProfileOrderMap</a>;</div>
<div class="line"><a id="l02400" name="l02400"></a><span class="lineno"> 2400</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="SampleProfile_8cpp.html#a3e3a587b7e1abc61882cb48ed0b5b3d2">UseProfileTopDownOrder</a> ||</div>
<div class="line"><a id="l02401" name="l02401"></a><span class="lineno"> 2401</span>      (ProfileIsCS &amp;&amp; !<a class="code hl_variable" href="SampleProfile_8cpp.html#a3e3a587b7e1abc61882cb48ed0b5b3d2">UseProfileTopDownOrder</a>.getNumOccurrences())) {</div>
<div class="line"><a id="l02402" name="l02402"></a><span class="lineno"> 2402</span>    <span class="comment">// Create a static call graph. The call edges are not important since they</span></div>
<div class="line"><a id="l02403" name="l02403"></a><span class="lineno"> 2403</span>    <span class="comment">// will be replaced by dynamic edges from the profile.</span></div>
<div class="line"><a id="l02404" name="l02404"></a><span class="lineno"> 2404</span>    <a class="code hl_class" href="classllvm_1_1CallGraph.html">CallGraph</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ProfileCG</a>(M);</div>
<div class="line"><a id="l02405" name="l02405"></a><span class="lineno"> 2405</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">replaceCallGraphEdges</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ProfileCG</a>, SymbolMap);</div>
<div class="line"><a id="l02406" name="l02406"></a><span class="lineno"> 2406</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">scc_iterator&lt;CallGraph *&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CGI</a> = <a class="code hl_function" href="namespacellvm.html#a3c1a67796e24a843db8a6766baa54c21">scc_begin</a>(&amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ProfileCG</a>);</div>
<div class="line"><a id="l02407" name="l02407"></a><span class="lineno"> 2407</span>    uint64_t <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0;</div>
<div class="line"><a id="l02408" name="l02408"></a><span class="lineno"> 2408</span>    <span class="keywordflow">while</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CGI</a>.isAtEnd()) {</div>
<div class="line"><a id="l02409" name="l02409"></a><span class="lineno"> 2409</span>      <span class="keywordflow">for</span> (<a class="code hl_class" href="classllvm_1_1CallGraphNode.html">CallGraphNode</a> *<a class="code hl_class" href="classNode.html">Node</a> : *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CGI</a>) {</div>
<div class="line"><a id="l02410" name="l02410"></a><span class="lineno"> 2410</span>        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code hl_class" href="classNode.html">Node</a>-&gt;getFunction())</div>
<div class="line"><a id="l02411" name="l02411"></a><span class="lineno"> 2411</span>          <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ProfileOrderMap</a>[<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>] = ++<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a id="l02412" name="l02412"></a><span class="lineno"> 2412</span>      }</div>
<div class="line"><a id="l02413" name="l02413"></a><span class="lineno"> 2413</span>      ++<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CGI</a>;</div>
<div class="line"><a id="l02414" name="l02414"></a><span class="lineno"> 2414</span>    }</div>
<div class="line"><a id="l02415" name="l02415"></a><span class="lineno"> 2415</span>  }</div>
<div class="line"><a id="l02416" name="l02416"></a><span class="lineno"> 2416</span> </div>
<div class="line"><a id="l02417" name="l02417"></a><span class="lineno"> 2417</span>  <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">scc_iterator&lt;CallGraph *&gt;</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CGI</a> = <a class="code hl_function" href="namespacellvm.html#a3c1a67796e24a843db8a6766baa54c21">scc_begin</a>(<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>);</div>
<div class="line"><a id="l02418" name="l02418"></a><span class="lineno"> 2418</span>  <span class="keywordflow">while</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CGI</a>.isAtEnd()) {</div>
<div class="line"><a id="l02419" name="l02419"></a><span class="lineno"> 2419</span>    uint64_t Start = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>.size();</div>
<div class="line"><a id="l02420" name="l02420"></a><span class="lineno"> 2420</span>    <span class="keywordflow">for</span> (<a class="code hl_class" href="classllvm_1_1CallGraphNode.html">CallGraphNode</a> *<a class="code hl_class" href="classNode.html">Node</a> : *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CGI</a>) {</div>
<div class="line"><a id="l02421" name="l02421"></a><span class="lineno"> 2421</span>      <span class="keyword">auto</span> *<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code hl_class" href="classNode.html">Node</a>-&gt;getFunction();</div>
<div class="line"><a id="l02422" name="l02422"></a><span class="lineno"> 2422</span>      <span class="keywordflow">if</span> (<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> &amp;&amp; !<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isDeclaration() &amp;&amp; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasFnAttribute(<span class="stringliteral">&quot;use-sample-profile&quot;</span>))</div>
<div class="line"><a id="l02423" name="l02423"></a><span class="lineno"> 2423</span>        <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>.push_back(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02424" name="l02424"></a><span class="lineno"> 2424</span>    }</div>
<div class="line"><a id="l02425" name="l02425"></a><span class="lineno"> 2425</span> </div>
<div class="line"><a id="l02426" name="l02426"></a><span class="lineno"> 2426</span>    <span class="comment">// Sort nodes in SCC based on the profile top-down order.</span></div>
<div class="line"><a id="l02427" name="l02427"></a><span class="lineno"> 2427</span>    <span class="keywordflow">if</span> (!<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ProfileOrderMap</a>.empty()) {</div>
<div class="line"><a id="l02428" name="l02428"></a><span class="lineno"> 2428</span>      std::stable_sort(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>.begin() + Start,</div>
<div class="line"><a id="l02429" name="l02429"></a><span class="lineno"> 2429</span>                       <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>.end(),</div>
<div class="line"><a id="l02430" name="l02430"></a><span class="lineno"> 2430</span>                       [&amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ProfileOrderMap</a>](<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_enumvalue" href="namespacellvm.html#a2554a96c67bdd7d0a62855a844ec55b0a945d5e233cf7d6240f6b783b36a374ff">Left</a>, <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_enumvalue" href="namespacellvm.html#a2554a96c67bdd7d0a62855a844ec55b0a92b09c7c48c520c3c55e497875da437c">Right</a>) {</div>
<div class="line"><a id="l02431" name="l02431"></a><span class="lineno"> 2431</span>                         return ProfileOrderMap[Left] &lt; ProfileOrderMap[Right];</div>
<div class="line"><a id="l02432" name="l02432"></a><span class="lineno"> 2432</span>                       });</div>
<div class="line"><a id="l02433" name="l02433"></a><span class="lineno"> 2433</span>    }</div>
<div class="line"><a id="l02434" name="l02434"></a><span class="lineno"> 2434</span> </div>
<div class="line"><a id="l02435" name="l02435"></a><span class="lineno"> 2435</span>    ++<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CGI</a>;</div>
<div class="line"><a id="l02436" name="l02436"></a><span class="lineno"> 2436</span>  }</div>
<div class="line"><a id="l02437" name="l02437"></a><span class="lineno"> 2437</span> </div>
<div class="line"><a id="l02438" name="l02438"></a><span class="lineno"> 2438</span>  <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>({</div>
<div class="line"><a id="l02439" name="l02439"></a><span class="lineno"> 2439</span>    <a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Function processing order:\n&quot;</span>;</div>
<div class="line"><a id="l02440" name="l02440"></a><span class="lineno"> 2440</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a class="code hl_function" href="namespacellvm.html#a469101ea87b8b432a1b4f7935c97f35c">reverse</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>)) {</div>
<div class="line"><a id="l02441" name="l02441"></a><span class="lineno"> 2441</span>      <a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l02442" name="l02442"></a><span class="lineno"> 2442</span>    }</div>
<div class="line"><a id="l02443" name="l02443"></a><span class="lineno"> 2443</span>  });</div>
<div class="line"><a id="l02444" name="l02444"></a><span class="lineno"> 2444</span> </div>
<div class="line"><a id="l02445" name="l02445"></a><span class="lineno"> 2445</span>  std::reverse(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>.begin(), <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>.end());</div>
<div class="line"><a id="l02446" name="l02446"></a><span class="lineno"> 2446</span>  <span class="keywordflow">return</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">FunctionOrderList</a>;</div>
<div class="line"><a id="l02447" name="l02447"></a><span class="lineno"> 2447</span>}</div>
<div class="line"><a id="l02448" name="l02448"></a><span class="lineno"> 2448</span> </div>
<div class="line"><a id="l02449" name="l02449"></a><span class="lineno"> 2449</span><span class="keywordtype">bool</span> SampleProfileLoader::doInitialization(<a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;M,</div>
<div class="line"><a id="l02450" name="l02450"></a><span class="lineno"> 2450</span>                                           <a class="code hl_class" href="classllvm_1_1AnalysisManager.html">FunctionAnalysisManager</a> *FAM) {</div>
<div class="line"><a id="l02451" name="l02451"></a><span class="lineno"> 2451</span>  <span class="keyword">auto</span> &amp;Ctx = M.getContext();</div>
<div class="line"><a id="l02452" name="l02452"></a><span class="lineno"> 2452</span> </div>
<div class="line"><a id="l02453" name="l02453"></a><span class="lineno"> 2453</span>  <span class="keyword">auto</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ReaderOrErr</a> =</div>
<div class="line"><a id="l02454" name="l02454"></a><span class="lineno"> 2454</span>      <a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#aa2655664be73b6f594cded1339133884">SampleProfileReader::create</a>(Filename, Ctx, RemappingFilename);</div>
<div class="line"><a id="l02455" name="l02455"></a><span class="lineno"> 2455</span>  <span class="keywordflow">if</span> (std::error_code EC = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ReaderOrErr</a>.getError()) {</div>
<div class="line"><a id="l02456" name="l02456"></a><span class="lineno"> 2456</span>    std::string Msg = <span class="stringliteral">&quot;Could not open profile: &quot;</span> + <a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>.message();</div>
<div class="line"><a id="l02457" name="l02457"></a><span class="lineno"> 2457</span>    Ctx.diagnose(<a class="code hl_class" href="classllvm_1_1DiagnosticInfoSampleProfile.html">DiagnosticInfoSampleProfile</a>(Filename, Msg));</div>
<div class="line"><a id="l02458" name="l02458"></a><span class="lineno"> 2458</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02459" name="l02459"></a><span class="lineno"> 2459</span>  }</div>
<div class="line"><a id="l02460" name="l02460"></a><span class="lineno"> 2460</span>  Reader = std::move(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">ReaderOrErr</a>.get());</div>
<div class="line"><a id="l02461" name="l02461"></a><span class="lineno"> 2461</span>  Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#ac2c3cd528ebcb5fbe487fe9e0b3a9de6">setSkipFlatProf</a>(LTOPhase == ThinOrFullLTOPhase::ThinLTOPostLink);</div>
<div class="line"><a id="l02462" name="l02462"></a><span class="lineno"> 2462</span>  Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a4a145ddd60f5f52607c969dc45c32c44">collectFuncsFrom</a>(M);</div>
<div class="line"><a id="l02463" name="l02463"></a><span class="lineno"> 2463</span>  <span class="keywordflow">if</span> (std::error_code EC = Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a3bdbf84fa8e3f0e789653587d5c85515">read</a>()) {</div>
<div class="line"><a id="l02464" name="l02464"></a><span class="lineno"> 2464</span>    std::string Msg = <span class="stringliteral">&quot;profile reading failed: &quot;</span> + <a class="code hl_enumvalue" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>.message();</div>
<div class="line"><a id="l02465" name="l02465"></a><span class="lineno"> 2465</span>    Ctx.diagnose(<a class="code hl_class" href="classllvm_1_1DiagnosticInfoSampleProfile.html">DiagnosticInfoSampleProfile</a>(Filename, Msg));</div>
<div class="line"><a id="l02466" name="l02466"></a><span class="lineno"> 2466</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02467" name="l02467"></a><span class="lineno"> 2467</span>  }</div>
<div class="line"><a id="l02468" name="l02468"></a><span class="lineno"> 2468</span> </div>
<div class="line"><a id="l02469" name="l02469"></a><span class="lineno"> 2469</span>  PSL = Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#af9976cd2d8ddf787f19d5dbca4530fa6">getProfileSymbolList</a>();</div>
<div class="line"><a id="l02470" name="l02470"></a><span class="lineno"> 2470</span> </div>
<div class="line"><a id="l02471" name="l02471"></a><span class="lineno"> 2471</span>  <span class="comment">// While profile-sample-accurate is on, ignore symbol list.</span></div>
<div class="line"><a id="l02472" name="l02472"></a><span class="lineno"> 2472</span>  ProfAccForSymsInList =</div>
<div class="line"><a id="l02473" name="l02473"></a><span class="lineno"> 2473</span>      <a class="code hl_variable" href="SampleProfile_8cpp.html#a8aa89f0866c6f65d2395b74e851e73f7">ProfileAccurateForSymsInList</a> &amp;&amp; PSL &amp;&amp; !<a class="code hl_variable" href="SampleProfile_8cpp.html#af00e1c8a074b97aedd1a2db33dea6753">ProfileSampleAccurate</a>;</div>
<div class="line"><a id="l02474" name="l02474"></a><span class="lineno"> 2474</span>  <span class="keywordflow">if</span> (ProfAccForSymsInList) {</div>
<div class="line"><a id="l02475" name="l02475"></a><span class="lineno"> 2475</span>    NamesInProfile.<a class="code hl_function" href="classllvm_1_1StringMap.html#a132b998e118193914fa4e2b694005b2c">clear</a>();</div>
<div class="line"><a id="l02476" name="l02476"></a><span class="lineno"> 2476</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> NameTable = Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a6dd2d2051faff77f927c11a25a851b81">getNameTable</a>())</div>
<div class="line"><a id="l02477" name="l02477"></a><span class="lineno"> 2477</span>      NamesInProfile.<a class="code hl_function" href="classllvm_1_1StringSet.html#add93efa62e06c599f1734f3b206232a0">insert</a>(NameTable-&gt;begin(), NameTable-&gt;end());</div>
<div class="line"><a id="l02478" name="l02478"></a><span class="lineno"> 2478</span>  }</div>
<div class="line"><a id="l02479" name="l02479"></a><span class="lineno"> 2479</span> </div>
<div class="line"><a id="l02480" name="l02480"></a><span class="lineno"> 2480</span>  <span class="keywordflow">if</span> (FAM &amp;&amp; !<a class="code hl_variable" href="SampleProfile_8cpp.html#a732d61bd469914910adee6ed8c8c4a38">ProfileInlineReplayFile</a>.empty()) {</div>
<div class="line"><a id="l02481" name="l02481"></a><span class="lineno"> 2481</span>    ExternalInlineAdvisor = std::make_unique&lt;ReplayInlineAdvisor&gt;(</div>
<div class="line"><a id="l02482" name="l02482"></a><span class="lineno"> 2482</span>        M, *FAM, Ctx, <span class="comment">/*OriginalAdvisor=*/</span><span class="keyword">nullptr</span>, <a class="code hl_variable" href="SampleProfile_8cpp.html#a732d61bd469914910adee6ed8c8c4a38">ProfileInlineReplayFile</a>,</div>
<div class="line"><a id="l02483" name="l02483"></a><span class="lineno"> 2483</span>        <span class="comment">/*EmitRemarks=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a id="l02484" name="l02484"></a><span class="lineno"> 2484</span>    <span class="keywordflow">if</span> (!ExternalInlineAdvisor-&gt;areReplayRemarksLoaded())</div>
<div class="line"><a id="l02485" name="l02485"></a><span class="lineno"> 2485</span>      ExternalInlineAdvisor.reset();</div>
<div class="line"><a id="l02486" name="l02486"></a><span class="lineno"> 2486</span>  }</div>
<div class="line"><a id="l02487" name="l02487"></a><span class="lineno"> 2487</span> </div>
<div class="line"><a id="l02488" name="l02488"></a><span class="lineno"> 2488</span>  <span class="comment">// Apply tweaks if context-sensitive profile is available.</span></div>
<div class="line"><a id="l02489" name="l02489"></a><span class="lineno"> 2489</span>  <span class="keywordflow">if</span> (Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#ab2258ff0986bd6227697d76e9001406d">profileIsCS</a>()) {</div>
<div class="line"><a id="l02490" name="l02490"></a><span class="lineno"> 2490</span>    ProfileIsCS = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02491" name="l02491"></a><span class="lineno"> 2491</span>    <a class="code hl_variable" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#a67e19eb484a5eaa31b22894398e258c0">FunctionSamples::ProfileIsCS</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02492" name="l02492"></a><span class="lineno"> 2492</span> </div>
<div class="line"><a id="l02493" name="l02493"></a><span class="lineno"> 2493</span>    <span class="comment">// Enable priority-base inliner and size inline by default for CSSPGO.</span></div>
<div class="line"><a id="l02494" name="l02494"></a><span class="lineno"> 2494</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SampleProfile_8cpp.html#ada8f2c564085d598909fb28464614812">ProfileSizeInline</a>.getNumOccurrences())</div>
<div class="line"><a id="l02495" name="l02495"></a><span class="lineno"> 2495</span>      <a class="code hl_variable" href="SampleProfile_8cpp.html#ada8f2c564085d598909fb28464614812">ProfileSizeInline</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02496" name="l02496"></a><span class="lineno"> 2496</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SampleProfile_8cpp.html#a582e224bc99dcf3ca6263cdd9b25d94f">CallsitePrioritizedInline</a>.getNumOccurrences())</div>
<div class="line"><a id="l02497" name="l02497"></a><span class="lineno"> 2497</span>      <a class="code hl_variable" href="SampleProfile_8cpp.html#a582e224bc99dcf3ca6263cdd9b25d94f">CallsitePrioritizedInline</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02498" name="l02498"></a><span class="lineno"> 2498</span> </div>
<div class="line"><a id="l02499" name="l02499"></a><span class="lineno"> 2499</span>    <span class="comment">// Tracker for profiles under different context</span></div>
<div class="line"><a id="l02500" name="l02500"></a><span class="lineno"> 2500</span>    ContextTracker =</div>
<div class="line"><a id="l02501" name="l02501"></a><span class="lineno"> 2501</span>        std::make_unique&lt;SampleContextTracker&gt;(Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#ad952aa920c1dbb730341fc614a01403f">getProfiles</a>());</div>
<div class="line"><a id="l02502" name="l02502"></a><span class="lineno"> 2502</span>  }</div>
<div class="line"><a id="l02503" name="l02503"></a><span class="lineno"> 2503</span> </div>
<div class="line"><a id="l02504" name="l02504"></a><span class="lineno"> 2504</span>  <span class="comment">// Load pseudo probe descriptors for probe-based function samples.</span></div>
<div class="line"><a id="l02505" name="l02505"></a><span class="lineno"> 2505</span>  <span class="keywordflow">if</span> (Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a1f372a7784eaec8c761af0ed7c38b1b2">profileIsProbeBased</a>()) {</div>
<div class="line"><a id="l02506" name="l02506"></a><span class="lineno"> 2506</span>    ProbeManager = std::make_unique&lt;PseudoProbeManager&gt;(M);</div>
<div class="line"><a id="l02507" name="l02507"></a><span class="lineno"> 2507</span>    <span class="keywordflow">if</span> (!ProbeManager-&gt;moduleIsProbed(M)) {</div>
<div class="line"><a id="l02508" name="l02508"></a><span class="lineno"> 2508</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *Msg =</div>
<div class="line"><a id="l02509" name="l02509"></a><span class="lineno"> 2509</span>          <span class="stringliteral">&quot;Pseudo-probe-based profile requires SampleProfileProbePass&quot;</span>;</div>
<div class="line"><a id="l02510" name="l02510"></a><span class="lineno"> 2510</span>      Ctx.diagnose(<a class="code hl_class" href="classllvm_1_1DiagnosticInfoSampleProfile.html">DiagnosticInfoSampleProfile</a>(Filename, Msg));</div>
<div class="line"><a id="l02511" name="l02511"></a><span class="lineno"> 2511</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02512" name="l02512"></a><span class="lineno"> 2512</span>    }</div>
<div class="line"><a id="l02513" name="l02513"></a><span class="lineno"> 2513</span>  }</div>
<div class="line"><a id="l02514" name="l02514"></a><span class="lineno"> 2514</span> </div>
<div class="line"><a id="l02515" name="l02515"></a><span class="lineno"> 2515</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02516" name="l02516"></a><span class="lineno"> 2516</span>}</div>
<div class="line"><a id="l02517" name="l02517"></a><span class="lineno"> 2517</span> </div>
<div class="foldopen" id="foldopen02518" data-start="{" data-end="}">
<div class="line"><a id="l02518" name="l02518"></a><span class="lineno"><a class="line" href="namespacellvm.html#a2f18b256797f90ed7933e51e26fa6505"> 2518</a></span><a class="code hl_class" href="classllvm_1_1ModulePass.html">ModulePass</a> *<a class="code hl_function" href="namespacellvm.html#a2f18b256797f90ed7933e51e26fa6505">llvm::createSampleProfileLoaderPass</a>() {</div>
<div class="line"><a id="l02519" name="l02519"></a><span class="lineno"> 2519</span>  <span class="keywordflow">return</span> <span class="keyword">new</span> SampleProfileLoaderLegacyPass();</div>
<div class="line"><a id="l02520" name="l02520"></a><span class="lineno"> 2520</span>}</div>
</div>
<div class="line"><a id="l02521" name="l02521"></a><span class="lineno"> 2521</span> </div>
<div class="foldopen" id="foldopen02522" data-start="{" data-end="}">
<div class="line"><a id="l02522" name="l02522"></a><span class="lineno"><a class="line" href="namespacellvm.html#a1c459f35b286c450385b372ce814da97"> 2522</a></span><a class="code hl_class" href="classllvm_1_1ModulePass.html">ModulePass</a> *<a class="code hl_function" href="namespacellvm.html#a2f18b256797f90ed7933e51e26fa6505">llvm::createSampleProfileLoaderPass</a>(<a class="code hl_class" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code hl_variable" href="ELFObjHandler_8cpp.html#adc852f586959ce13117d737cf3f14899">Name</a>) {</div>
<div class="line"><a id="l02523" name="l02523"></a><span class="lineno"> 2523</span>  <span class="keywordflow">return</span> <span class="keyword">new</span> SampleProfileLoaderLegacyPass(<a class="code hl_variable" href="ELFObjHandler_8cpp.html#adc852f586959ce13117d737cf3f14899">Name</a>);</div>
<div class="line"><a id="l02524" name="l02524"></a><span class="lineno"> 2524</span>}</div>
</div>
<div class="line"><a id="l02525" name="l02525"></a><span class="lineno"> 2525</span> </div>
<div class="line"><a id="l02526" name="l02526"></a><span class="lineno"> 2526</span><span class="keywordtype">bool</span> SampleProfileLoader::runOnModule(<a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;M, <a class="code hl_class" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> *AM,</div>
<div class="line"><a id="l02527" name="l02527"></a><span class="lineno"> 2527</span>                                      <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">_PSI</a>, <a class="code hl_class" href="classllvm_1_1CallGraph.html">CallGraph</a> *<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>) {</div>
<div class="line"><a id="l02528" name="l02528"></a><span class="lineno"> 2528</span>  GUIDToFuncNameMapper Mapper(M, *Reader, GUIDToFuncNameMap);</div>
<div class="line"><a id="l02529" name="l02529"></a><span class="lineno"> 2529</span> </div>
<div class="line"><a id="l02530" name="l02530"></a><span class="lineno"> 2530</span>  PSI = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">_PSI</a>;</div>
<div class="line"><a id="l02531" name="l02531"></a><span class="lineno"> 2531</span>  <span class="keywordflow">if</span> (M.getProfileSummary(<span class="comment">/* IsCS */</span> <span class="keyword">false</span>) == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l02532" name="l02532"></a><span class="lineno"> 2532</span>    M.setProfileSummary(Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a7870bf43f8e5b80b21caea5ea2e23977">getSummary</a>().<a class="code hl_function" href="classllvm_1_1ProfileSummary.html#a59f76c736c482a9d03fbb0f5c42b3992">getMD</a>(M.getContext()),</div>
<div class="line"><a id="l02533" name="l02533"></a><span class="lineno"> 2533</span>                        <a class="code hl_enumvalue" href="classllvm_1_1ProfileSummary.html#aa5aa682b3904e88749fa973b3da370c2a0c86eaeebf5b6120b601ecc93a1c2e3a">ProfileSummary::PSK_Sample</a>);</div>
<div class="line"><a id="l02534" name="l02534"></a><span class="lineno"> 2534</span>    PSI-&gt;<a class="code hl_function" href="classllvm_1_1ProfileSummaryInfo.html#a2600478d8188a85a14af8787024e1831">refresh</a>();</div>
<div class="line"><a id="l02535" name="l02535"></a><span class="lineno"> 2535</span>  }</div>
<div class="line"><a id="l02536" name="l02536"></a><span class="lineno"> 2536</span>  <span class="comment">// Compute the total number of samples collected in this profile.</span></div>
<div class="line"><a id="l02537" name="l02537"></a><span class="lineno"> 2537</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Reader-&gt;getProfiles())</div>
<div class="line"><a id="l02538" name="l02538"></a><span class="lineno"> 2538</span>    TotalCollectedSamples += <a class="code hl_define" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second.getTotalSamples();</div>
<div class="line"><a id="l02539" name="l02539"></a><span class="lineno"> 2539</span> </div>
<div class="line"><a id="l02540" name="l02540"></a><span class="lineno"> 2540</span>  <span class="keyword">auto</span> Remapper = Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a530222c3b645acc9170003d046753e94">getRemapper</a>();</div>
<div class="line"><a id="l02541" name="l02541"></a><span class="lineno"> 2541</span>  <span class="comment">// Populate the symbol map.</span></div>
<div class="line"><a id="l02542" name="l02542"></a><span class="lineno"> 2542</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">N_F</a> : M.getValueSymbolTable()) {</div>
<div class="line"><a id="l02543" name="l02543"></a><span class="lineno"> 2543</span>    <a class="code hl_class" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OrigName</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">N_F</a>.getKey();</div>
<div class="line"><a id="l02544" name="l02544"></a><span class="lineno"> 2544</span>    <a class="code hl_class" href="classllvm_1_1Function.html">Function</a> *<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">dyn_cast&lt;Function&gt;</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">N_F</a>.getValue());</div>
<div class="line"><a id="l02545" name="l02545"></a><span class="lineno"> 2545</span>    <span class="keywordflow">if</span> (<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> == <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l02546" name="l02546"></a><span class="lineno"> 2546</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02547" name="l02547"></a><span class="lineno"> 2547</span>    <a class="code hl_typedef" href="namespacellvm_1_1orc.html#a6a31d56a05a94b79b1c5eb0b85ae0283">SymbolMap</a>[<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OrigName</a>] = <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</div>
<div class="line"><a id="l02548" name="l02548"></a><span class="lineno"> 2548</span>    <span class="keyword">auto</span> pos = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OrigName</a>.find(<span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line"><a id="l02549" name="l02549"></a><span class="lineno"> 2549</span>    <span class="keywordflow">if</span> (pos != <a class="code hl_variable" href="classllvm_1_1StringRef.html#ad0f54a163ac500b144590640c6f1eb6b">StringRef::npos</a>) {</div>
<div class="line"><a id="l02550" name="l02550"></a><span class="lineno"> 2550</span>      <a class="code hl_class" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewName</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OrigName</a>.substr(0, pos);</div>
<div class="line"><a id="l02551" name="l02551"></a><span class="lineno"> 2551</span>      <span class="keyword">auto</span> r = <a class="code hl_typedef" href="namespacellvm_1_1orc.html#a6a31d56a05a94b79b1c5eb0b85ae0283">SymbolMap</a>.<a class="code hl_function" href="classllvm_1_1DenseMapBase.html#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make_pair(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewName</a>, <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</div>
<div class="line"><a id="l02552" name="l02552"></a><span class="lineno"> 2552</span>      <span class="comment">// Failiing to insert means there is already an entry in SymbolMap,</span></div>
<div class="line"><a id="l02553" name="l02553"></a><span class="lineno"> 2553</span>      <span class="comment">// thus there are multiple functions that are mapped to the same</span></div>
<div class="line"><a id="l02554" name="l02554"></a><span class="lineno"> 2554</span>      <span class="comment">// stripped name. In this case of name conflicting, set the value</span></div>
<div class="line"><a id="l02555" name="l02555"></a><span class="lineno"> 2555</span>      <span class="comment">// to nullptr to avoid confusion.</span></div>
<div class="line"><a id="l02556" name="l02556"></a><span class="lineno"> 2556</span>      <span class="keywordflow">if</span> (!r.second)</div>
<div class="line"><a id="l02557" name="l02557"></a><span class="lineno"> 2557</span>        r.first-&gt;second = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02558" name="l02558"></a><span class="lineno"> 2558</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OrigName</a> = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">NewName</a>;</div>
<div class="line"><a id="l02559" name="l02559"></a><span class="lineno"> 2559</span>    }</div>
<div class="line"><a id="l02560" name="l02560"></a><span class="lineno"> 2560</span>    <span class="comment">// Insert the remapped names into SymbolMap.</span></div>
<div class="line"><a id="l02561" name="l02561"></a><span class="lineno"> 2561</span>    <span class="keywordflow">if</span> (Remapper) {</div>
<div class="line"><a id="l02562" name="l02562"></a><span class="lineno"> 2562</span>      <span class="keywordflow">if</span> (<span class="keyword">auto</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">MapName</a> = Remapper-&gt;lookUpNameInProfile(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OrigName</a>)) {</div>
<div class="line"><a id="l02563" name="l02563"></a><span class="lineno"> 2563</span>        <span class="keywordflow">if</span> (*<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">MapName</a> == <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OrigName</a>)</div>
<div class="line"><a id="l02564" name="l02564"></a><span class="lineno"> 2564</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02565" name="l02565"></a><span class="lineno"> 2565</span>        <a class="code hl_typedef" href="namespacellvm_1_1orc.html#a6a31d56a05a94b79b1c5eb0b85ae0283">SymbolMap</a>.<a class="code hl_function" href="classllvm_1_1DenseMapBase.html#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make_pair(*<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">MapName</a>, <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</div>
<div class="line"><a id="l02566" name="l02566"></a><span class="lineno"> 2566</span>      }</div>
<div class="line"><a id="l02567" name="l02567"></a><span class="lineno"> 2567</span>    }</div>
<div class="line"><a id="l02568" name="l02568"></a><span class="lineno"> 2568</span>  }</div>
<div class="line"><a id="l02569" name="l02569"></a><span class="lineno"> 2569</span> </div>
<div class="line"><a id="l02570" name="l02570"></a><span class="lineno"> 2570</span>  <span class="keywordtype">bool</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">retval</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02571" name="l02571"></a><span class="lineno"> 2571</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">buildFunctionOrder</a>(M, <a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>)) {</div>
<div class="line"><a id="l02572" name="l02572"></a><span class="lineno"> 2572</span>    <a class="code hl_function" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isDeclaration());</div>
<div class="line"><a id="l02573" name="l02573"></a><span class="lineno"> 2573</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">clearFunctionData</a>();</div>
<div class="line"><a id="l02574" name="l02574"></a><span class="lineno"> 2574</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">retval</a> |= <a class="code hl_function" href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a>(*<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, AM);</div>
<div class="line"><a id="l02575" name="l02575"></a><span class="lineno"> 2575</span>  }</div>
<div class="line"><a id="l02576" name="l02576"></a><span class="lineno"> 2576</span> </div>
<div class="line"><a id="l02577" name="l02577"></a><span class="lineno"> 2577</span>  <span class="comment">// Account for cold calls not inlined....</span></div>
<div class="line"><a id="l02578" name="l02578"></a><span class="lineno"> 2578</span>  <span class="keywordflow">if</span> (!ProfileIsCS)</div>
<div class="line"><a id="l02579" name="l02579"></a><span class="lineno"> 2579</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> std::pair&lt;Function *, NotInlinedProfileInfo&gt; &amp;pair :</div>
<div class="line"><a id="l02580" name="l02580"></a><span class="lineno"> 2580</span>         notInlinedCallInfo)</div>
<div class="line"><a id="l02581" name="l02581"></a><span class="lineno"> 2581</span>      <a class="code hl_function" href="namespacellvm.html#af0b7d20135171ab4df56bb70fe0d9dca">updateProfileCallee</a>(pair.first, pair.second.entryCount);</div>
<div class="line"><a id="l02582" name="l02582"></a><span class="lineno"> 2582</span> </div>
<div class="line"><a id="l02583" name="l02583"></a><span class="lineno"> 2583</span>  <span class="keywordflow">return</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">retval</a>;</div>
<div class="line"><a id="l02584" name="l02584"></a><span class="lineno"> 2584</span>}</div>
<div class="line"><a id="l02585" name="l02585"></a><span class="lineno"> 2585</span> </div>
<div class="line"><a id="l02586" name="l02586"></a><span class="lineno"> 2586</span><span class="keywordtype">bool</span> SampleProfileLoaderLegacyPass::runOnModule(<a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;M) {</div>
<div class="line"><a id="l02587" name="l02587"></a><span class="lineno"> 2587</span>  ACT = &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getAnalysis&lt;AssumptionCacheTracker&gt;</a>();</div>
<div class="line"><a id="l02588" name="l02588"></a><span class="lineno"> 2588</span>  TTIWP = &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getAnalysis&lt;TargetTransformInfoWrapperPass&gt;</a>();</div>
<div class="line"><a id="l02589" name="l02589"></a><span class="lineno"> 2589</span>  TLIWP = &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getAnalysis&lt;TargetLibraryInfoWrapperPass&gt;</a>();</div>
<div class="line"><a id="l02590" name="l02590"></a><span class="lineno"> 2590</span>  <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI =</div>
<div class="line"><a id="l02591" name="l02591"></a><span class="lineno"> 2591</span>      &amp;<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">getAnalysis&lt;ProfileSummaryInfoWrapperPass&gt;</a>().getPSI();</div>
<div class="line"><a id="l02592" name="l02592"></a><span class="lineno"> 2592</span>  <span class="keywordflow">return</span> SampleLoader.runOnModule(M, <span class="keyword">nullptr</span>, PSI, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l02593" name="l02593"></a><span class="lineno"> 2593</span>}</div>
<div class="line"><a id="l02594" name="l02594"></a><span class="lineno"> 2594</span> </div>
<div class="line"><a id="l02595" name="l02595"></a><span class="lineno"> 2595</span><span class="keywordtype">bool</span> SampleProfileLoader::runOnFunction(<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code hl_class" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> *AM) {</div>
<div class="line"><a id="l02596" name="l02596"></a><span class="lineno"> 2596</span>  <a class="code hl_define" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code hl_function" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n\nProcessing Function &quot;</span> &lt;&lt; <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a id="l02597" name="l02597"></a><span class="lineno"> 2597</span>  DILocation2SampleMap.clear();</div>
<div class="line"><a id="l02598" name="l02598"></a><span class="lineno"> 2598</span>  <span class="comment">// By default the entry count is initialized to -1, which will be treated</span></div>
<div class="line"><a id="l02599" name="l02599"></a><span class="lineno"> 2599</span>  <span class="comment">// conservatively by getEntryCount as the same as unknown (None). This is</span></div>
<div class="line"><a id="l02600" name="l02600"></a><span class="lineno"> 2600</span>  <span class="comment">// to avoid newly added code to be treated as cold. If we have samples</span></div>
<div class="line"><a id="l02601" name="l02601"></a><span class="lineno"> 2601</span>  <span class="comment">// this will be overwritten in emitAnnotations.</span></div>
<div class="line"><a id="l02602" name="l02602"></a><span class="lineno"> 2602</span>  uint64_t <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">initialEntryCount</a> = -1;</div>
<div class="line"><a id="l02603" name="l02603"></a><span class="lineno"> 2603</span> </div>
<div class="line"><a id="l02604" name="l02604"></a><span class="lineno"> 2604</span>  ProfAccForSymsInList = <a class="code hl_variable" href="SampleProfile_8cpp.html#a8aa89f0866c6f65d2395b74e851e73f7">ProfileAccurateForSymsInList</a> &amp;&amp; PSL;</div>
<div class="line"><a id="l02605" name="l02605"></a><span class="lineno"> 2605</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="SampleProfile_8cpp.html#af00e1c8a074b97aedd1a2db33dea6753">ProfileSampleAccurate</a> || <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(<span class="stringliteral">&quot;profile-sample-accurate&quot;</span>)) {</div>
<div class="line"><a id="l02606" name="l02606"></a><span class="lineno"> 2606</span>    <span class="comment">// initialize all the function entry counts to 0. It means all the</span></div>
<div class="line"><a id="l02607" name="l02607"></a><span class="lineno"> 2607</span>    <span class="comment">// functions without profile will be regarded as cold.</span></div>
<div class="line"><a id="l02608" name="l02608"></a><span class="lineno"> 2608</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">initialEntryCount</a> = 0;</div>
<div class="line"><a id="l02609" name="l02609"></a><span class="lineno"> 2609</span>    <span class="comment">// profile-sample-accurate is a user assertion which has a higher precedence</span></div>
<div class="line"><a id="l02610" name="l02610"></a><span class="lineno"> 2610</span>    <span class="comment">// than symbol list. When profile-sample-accurate is on, ignore symbol list.</span></div>
<div class="line"><a id="l02611" name="l02611"></a><span class="lineno"> 2611</span>    ProfAccForSymsInList = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02612" name="l02612"></a><span class="lineno"> 2612</span>  }</div>
<div class="line"><a id="l02613" name="l02613"></a><span class="lineno"> 2613</span> </div>
<div class="line"><a id="l02614" name="l02614"></a><span class="lineno"> 2614</span>  <span class="comment">// PSL -- profile symbol list include all the symbols in sampled binary.</span></div>
<div class="line"><a id="l02615" name="l02615"></a><span class="lineno"> 2615</span>  <span class="comment">// If ProfileAccurateForSymsInList is enabled, PSL is used to treat</span></div>
<div class="line"><a id="l02616" name="l02616"></a><span class="lineno"> 2616</span>  <span class="comment">// old functions without samples being cold, without having to worry</span></div>
<div class="line"><a id="l02617" name="l02617"></a><span class="lineno"> 2617</span>  <span class="comment">// about new and hot functions being mistakenly treated as cold.</span></div>
<div class="line"><a id="l02618" name="l02618"></a><span class="lineno"> 2618</span>  <span class="keywordflow">if</span> (ProfAccForSymsInList) {</div>
<div class="line"><a id="l02619" name="l02619"></a><span class="lineno"> 2619</span>    <span class="comment">// Initialize the entry count to 0 for functions in the list.</span></div>
<div class="line"><a id="l02620" name="l02620"></a><span class="lineno"> 2620</span>    <span class="keywordflow">if</span> (PSL-&gt;contains(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()))</div>
<div class="line"><a id="l02621" name="l02621"></a><span class="lineno"> 2621</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">initialEntryCount</a> = 0;</div>
<div class="line"><a id="l02622" name="l02622"></a><span class="lineno"> 2622</span> </div>
<div class="line"><a id="l02623" name="l02623"></a><span class="lineno"> 2623</span>    <span class="comment">// Function in the symbol list but without sample will be regarded as</span></div>
<div class="line"><a id="l02624" name="l02624"></a><span class="lineno"> 2624</span>    <span class="comment">// cold. To minimize the potential negative performance impact it could</span></div>
<div class="line"><a id="l02625" name="l02625"></a><span class="lineno"> 2625</span>    <span class="comment">// have, we want to be a little conservative here saying if a function</span></div>
<div class="line"><a id="l02626" name="l02626"></a><span class="lineno"> 2626</span>    <span class="comment">// shows up in the profile, no matter as outline function, inline instance</span></div>
<div class="line"><a id="l02627" name="l02627"></a><span class="lineno"> 2627</span>    <span class="comment">// or call targets, treat the function as not being cold. This will handle</span></div>
<div class="line"><a id="l02628" name="l02628"></a><span class="lineno"> 2628</span>    <span class="comment">// the cases such as most callsites of a function are inlined in sampled</span></div>
<div class="line"><a id="l02629" name="l02629"></a><span class="lineno"> 2629</span>    <span class="comment">// binary but not inlined in current build (because of source code drift,</span></div>
<div class="line"><a id="l02630" name="l02630"></a><span class="lineno"> 2630</span>    <span class="comment">// imprecise debug information, or the callsites are all cold individually</span></div>
<div class="line"><a id="l02631" name="l02631"></a><span class="lineno"> 2631</span>    <span class="comment">// but not cold accumulatively...), so the outline function showing up as</span></div>
<div class="line"><a id="l02632" name="l02632"></a><span class="lineno"> 2632</span>    <span class="comment">// cold in sampled binary will actually not be cold after current build.</span></div>
<div class="line"><a id="l02633" name="l02633"></a><span class="lineno"> 2633</span>    <a class="code hl_class" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CanonName</a> = <a class="code hl_function" href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa7122a07ea48e47fc71083e68b829003">FunctionSamples::getCanonicalFnName</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02634" name="l02634"></a><span class="lineno"> 2634</span>    <span class="keywordflow">if</span> (NamesInProfile.<a class="code hl_function" href="classllvm_1_1StringMap.html#a9846bb2bc5672e7627011260772b8d09">count</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">CanonName</a>))</div>
<div class="line"><a id="l02635" name="l02635"></a><span class="lineno"> 2635</span>      <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">initialEntryCount</a> = -1;</div>
<div class="line"><a id="l02636" name="l02636"></a><span class="lineno"> 2636</span>  }</div>
<div class="line"><a id="l02637" name="l02637"></a><span class="lineno"> 2637</span> </div>
<div class="line"><a id="l02638" name="l02638"></a><span class="lineno"> 2638</span>  <span class="comment">// Initialize entry count when the function has no existing entry</span></div>
<div class="line"><a id="l02639" name="l02639"></a><span class="lineno"> 2639</span>  <span class="comment">// count value.</span></div>
<div class="line"><a id="l02640" name="l02640"></a><span class="lineno"> 2640</span>  <span class="keywordflow">if</span> (!<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryCount().hasValue())</div>
<div class="line"><a id="l02641" name="l02641"></a><span class="lineno"> 2641</span>    <a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setEntryCount(<a class="code hl_typedef" href="Function_8cpp.html#ac57dae906fe8ac64efe52571121b0fe1">ProfileCount</a>(<a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">initialEntryCount</a>, <a class="code hl_enumvalue" href="classllvm_1_1Function.html#a438d2f246b76817114ade2a005a6bcabac7dbc704eba08842e6acdde9cf6379ba">Function::PCT_Real</a>));</div>
<div class="line"><a id="l02642" name="l02642"></a><span class="lineno"> 2642</span>  std::unique_ptr&lt;OptimizationRemarkEmitter&gt; <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OwnedORE</a>;</div>
<div class="line"><a id="l02643" name="l02643"></a><span class="lineno"> 2643</span>  <span class="keywordflow">if</span> (AM) {</div>
<div class="line"><a id="l02644" name="l02644"></a><span class="lineno"> 2644</span>    <span class="keyword">auto</span> &amp;FAM =</div>
<div class="line"><a id="l02645" name="l02645"></a><span class="lineno"> 2645</span>        AM-&gt;<a class="code hl_function" href="classllvm_1_1AnalysisManager.html#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a class="code hl_class" href="classllvm_1_1InnerAnalysisManagerProxy.html">FunctionAnalysisManagerModuleProxy</a>&gt;(*<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent())</div>
<div class="line"><a id="l02646" name="l02646"></a><span class="lineno"> 2646</span>            .getManager();</div>
<div class="line"><a id="l02647" name="l02647"></a><span class="lineno"> 2647</span>    ORE = &amp;FAM.<a class="code hl_function" href="classllvm_1_1AnalysisManager.html#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a class="code hl_class" href="classllvm_1_1OptimizationRemarkEmitterAnalysis.html">OptimizationRemarkEmitterAnalysis</a>&gt;(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02648" name="l02648"></a><span class="lineno"> 2648</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02649" name="l02649"></a><span class="lineno"> 2649</span>    <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OwnedORE</a> = std::make_unique&lt;OptimizationRemarkEmitter&gt;(&amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02650" name="l02650"></a><span class="lineno"> 2650</span>    ORE = <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">OwnedORE</a>.get();</div>
<div class="line"><a id="l02651" name="l02651"></a><span class="lineno"> 2651</span>  }</div>
<div class="line"><a id="l02652" name="l02652"></a><span class="lineno"> 2652</span> </div>
<div class="line"><a id="l02653" name="l02653"></a><span class="lineno"> 2653</span>  <span class="keywordflow">if</span> (ProfileIsCS)</div>
<div class="line"><a id="l02654" name="l02654"></a><span class="lineno"> 2654</span>    Samples = ContextTracker-&gt;getBaseSamplesFor(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02655" name="l02655"></a><span class="lineno"> 2655</span>  <span class="keywordflow">else</span></div>
<div class="line"><a id="l02656" name="l02656"></a><span class="lineno"> 2656</span>    Samples = Reader-&gt;<a class="code hl_function" href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a231496cee212bad0c2b9fa7877dc0cb4">getSamplesFor</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02657" name="l02657"></a><span class="lineno"> 2657</span> </div>
<div class="line"><a id="l02658" name="l02658"></a><span class="lineno"> 2658</span>  <span class="keywordflow">if</span> (Samples &amp;&amp; !Samples-&gt;empty())</div>
<div class="line"><a id="l02659" name="l02659"></a><span class="lineno"> 2659</span>    <span class="keywordflow">return</span> <a class="code hl_class" href="classllvm_1_1ilist__node__impl.html">emitAnnotations</a>(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02660" name="l02660"></a><span class="lineno"> 2660</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02661" name="l02661"></a><span class="lineno"> 2661</span>}</div>
<div class="line"><a id="l02662" name="l02662"></a><span class="lineno"> 2662</span> </div>
<div class="foldopen" id="foldopen02663" data-start="{" data-end="}">
<div class="line"><a id="l02663" name="l02663"></a><span class="lineno"><a class="line" href="classllvm_1_1SampleProfileLoaderPass.html#a324d3696b255beea7cfd1e8b901b2363"> 2663</a></span><a class="code hl_class" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a> <a class="code hl_function" href="classllvm_1_1SampleProfileLoaderPass.html#a324d3696b255beea7cfd1e8b901b2363">SampleProfileLoaderPass::run</a>(<a class="code hl_class" href="classllvm_1_1Module.html">Module</a> &amp;M,</div>
<div class="line"><a id="l02664" name="l02664"></a><span class="lineno"> 2664</span>                                               <a class="code hl_class" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> &amp;AM) {</div>
<div class="line"><a id="l02665" name="l02665"></a><span class="lineno"> 2665</span>  <a class="code hl_class" href="classllvm_1_1AnalysisManager.html">FunctionAnalysisManager</a> &amp;FAM =</div>
<div class="line"><a id="l02666" name="l02666"></a><span class="lineno"> 2666</span>      AM.<a class="code hl_function" href="classllvm_1_1AnalysisManager.html#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a class="code hl_class" href="classllvm_1_1InnerAnalysisManagerProxy.html">FunctionAnalysisManagerModuleProxy</a>&gt;(M).getManager();</div>
<div class="line"><a id="l02667" name="l02667"></a><span class="lineno"> 2667</span> </div>
<div class="line"><a id="l02668" name="l02668"></a><span class="lineno"> 2668</span>  <span class="keyword">auto</span> GetAssumptionCache = [&amp;](<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a class="code hl_class" href="classllvm_1_1AssumptionCache.html">AssumptionCache</a> &amp; {</div>
<div class="line"><a id="l02669" name="l02669"></a><span class="lineno"> 2669</span>    <span class="keywordflow">return</span> FAM.<a class="code hl_function" href="classllvm_1_1AnalysisManager.html#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a class="code hl_class" href="classllvm_1_1AssumptionAnalysis.html">AssumptionAnalysis</a>&gt;(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02670" name="l02670"></a><span class="lineno"> 2670</span>  };</div>
<div class="line"><a id="l02671" name="l02671"></a><span class="lineno"> 2671</span>  <span class="keyword">auto</span> GetTTI = [&amp;](<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a class="code hl_class" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp; {</div>
<div class="line"><a id="l02672" name="l02672"></a><span class="lineno"> 2672</span>    <span class="keywordflow">return</span> FAM.<a class="code hl_function" href="classllvm_1_1AnalysisManager.html#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a class="code hl_class" href="classllvm_1_1TargetIRAnalysis.html">TargetIRAnalysis</a>&gt;(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02673" name="l02673"></a><span class="lineno"> 2673</span>  };</div>
<div class="line"><a id="l02674" name="l02674"></a><span class="lineno"> 2674</span>  <span class="keyword">auto</span> GetTLI = [&amp;](<a class="code hl_class" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <span class="keyword">const</span> <a class="code hl_class" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp; {</div>
<div class="line"><a id="l02675" name="l02675"></a><span class="lineno"> 2675</span>    <span class="keywordflow">return</span> FAM.<a class="code hl_function" href="classllvm_1_1AnalysisManager.html#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a class="code hl_class" href="classllvm_1_1TargetLibraryAnalysis.html">TargetLibraryAnalysis</a>&gt;(<a class="code hl_define" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a id="l02676" name="l02676"></a><span class="lineno"> 2676</span>  };</div>
<div class="line"><a id="l02677" name="l02677"></a><span class="lineno"> 2677</span> </div>
<div class="line"><a id="l02678" name="l02678"></a><span class="lineno"> 2678</span>  SampleProfileLoader SampleLoader(</div>
<div class="line"><a id="l02679" name="l02679"></a><span class="lineno"> 2679</span>      ProfileFileName.empty() ? <a class="code hl_variable" href="SampleProfile_8cpp.html#a055c6b7054a94b338830b3da8ecc4023">SampleProfileFile</a> : ProfileFileName,</div>
<div class="line"><a id="l02680" name="l02680"></a><span class="lineno"> 2680</span>      ProfileRemappingFileName.empty() ? <a class="code hl_variable" href="SampleProfile_8cpp.html#af8d3791537a44c00b699d28c4d978d82">SampleProfileRemappingFile</a></div>
<div class="line"><a id="l02681" name="l02681"></a><span class="lineno"> 2681</span>                                       : ProfileRemappingFileName,</div>
<div class="line"><a id="l02682" name="l02682"></a><span class="lineno"> 2682</span>      LTOPhase, GetAssumptionCache, GetTTI, GetTLI);</div>
<div class="line"><a id="l02683" name="l02683"></a><span class="lineno"> 2683</span> </div>
<div class="line"><a id="l02684" name="l02684"></a><span class="lineno"> 2684</span>  <span class="keywordflow">if</span> (!SampleLoader.doInitialization(M, &amp;FAM))</div>
<div class="line"><a id="l02685" name="l02685"></a><span class="lineno"> 2685</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</div>
<div class="line"><a id="l02686" name="l02686"></a><span class="lineno"> 2686</span> </div>
<div class="line"><a id="l02687" name="l02687"></a><span class="lineno"> 2687</span>  <a class="code hl_class" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI = &amp;AM.<a class="code hl_function" href="classllvm_1_1AnalysisManager.html#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a class="code hl_class" href="classllvm_1_1ProfileSummaryAnalysis.html">ProfileSummaryAnalysis</a>&gt;(M);</div>
<div class="line"><a id="l02688" name="l02688"></a><span class="lineno"> 2688</span>  <a class="code hl_class" href="classllvm_1_1CallGraph.html">CallGraph</a> &amp;<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a> = AM.<a class="code hl_function" href="classllvm_1_1AnalysisManager.html#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a class="code hl_class" href="classllvm_1_1CallGraphAnalysis.html">CallGraphAnalysis</a>&gt;(M);</div>
<div class="line"><a id="l02689" name="l02689"></a><span class="lineno"> 2689</span>  <span class="keywordflow">if</span> (!SampleLoader.runOnModule(M, &amp;AM, PSI, &amp;<a class="code hl_variable" href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a>))</div>
<div class="line"><a id="l02690" name="l02690"></a><span class="lineno"> 2690</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</div>
<div class="line"><a id="l02691" name="l02691"></a><span class="lineno"> 2691</span> </div>
<div class="line"><a id="l02692" name="l02692"></a><span class="lineno"> 2692</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="classllvm_1_1PreservedAnalyses.html#a03797a73044a81cbc6a3409d6c72ee8f">PreservedAnalyses::none</a>();</div>
<div class="line"><a id="l02693" name="l02693"></a><span class="lineno"> 2693</span>}</div>
</div>
<div class="ttc" id="aAArch64AdvSIMDScalarPass_8cpp_html_afb944a33b354e4709fb99864f82b9c16"><div class="ttname"><a href="AArch64AdvSIMDScalarPass_8cpp.html#afb944a33b354e4709fb99864f82b9c16">if</a></div><div class="ttdeci">if(Register::isVirtualRegister(Reg)) return MRI -&gt; getRegClass(Reg) -&gt;hasSuperClassEq(&amp;AArch64::GPR64RegClass)</div></div>
<div class="ttc" id="aAArch64PromoteConstant_8cpp_html_a90f8350fecae261c25be85d38b451bff"><div class="ttname"><a href="AArch64PromoteConstant_8cpp.html#a90f8350fecae261c25be85d38b451bff">const</a></div><div class="ttdeci">aarch64 promote const</div><div class="ttdef"><b>Definition</b> <a href="AArch64PromoteConstant_8cpp_source.html#l00232">AArch64PromoteConstant.cpp:232</a></div></div>
<div class="ttc" id="aAMDGPULibCalls_8cpp_html_a537c835c34f0b44b6ad2696643754390"><div class="ttname"><a href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a></div><div class="ttdeci">amdgpu Simplify well known AMD library false FunctionCallee Callee</div><div class="ttdef"><b>Definition</b> <a href="AMDGPULibCalls_8cpp_source.html#l00205">AMDGPULibCalls.cpp:205</a></div></div>
<div class="ttc" id="aArrayRef_8h_html"><div class="ttname"><a href="ArrayRef_8h.html">ArrayRef.h</a></div></div>
<div class="ttc" id="aAssumptionCache_8h_html"><div class="ttname"><a href="AssumptionCache_8h.html">AssumptionCache.h</a></div></div>
<div class="ttc" id="aBasicBlockSections_8cpp_html_a5e5c642a0309c0657f3efa8a8b687008"><div class="ttname"><a href="BasicBlockSections_8cpp.html#a5e5c642a0309c0657f3efa8a8b687008">for</a></div><div class="ttdeci">for(auto &amp;MBB :MF)</div><div class="ttdef"><b>Definition</b> <a href="BasicBlockSections_8cpp_source.html#l00162">BasicBlockSections.cpp:162</a></div></div>
<div class="ttc" id="aBasicBlock_8h_html"><div class="ttname"><a href="BasicBlock_8h.html">BasicBlock.h</a></div></div>
<div class="ttc" id="aBlockFrequencyInfoImpl_8h_html_ad78e062f62e0d6e453941fb4ca843e4d"><div class="ttname"><a href="BlockFrequencyInfoImpl_8h.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a></div><div class="ttdeci">#define DEBUG_TYPE</div><div class="ttdef"><b>Definition</b> <a href="BlockFrequencyInfoImpl_8h_source.html#l00049">BlockFrequencyInfoImpl.h:49</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_ab5899ca200d34e3cc6bb09ebce5e5b3c"><div class="ttname"><a href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a></div><div class="ttdeci">static GCRegistry::Add&lt; CoreCLRGC &gt; E(&quot;coreclr&quot;, &quot;CoreCLR-compatible GC&quot;)</div></div>
<div class="ttc" id="aCallGraphSCCPass_8h_html"><div class="ttname"><a href="CallGraphSCCPass_8h.html">CallGraphSCCPass.h</a></div></div>
<div class="ttc" id="aCallGraph_8h_html"><div class="ttname"><a href="CallGraph_8h.html">CallGraph.h</a></div><div class="ttdoc">This file provides interfaces used to build and manipulate a call graph, which is a very useful tool ...</div></div>
<div class="ttc" id="aCallPromotionUtils_8h_html"><div class="ttname"><a href="CallPromotionUtils_8h.html">CallPromotionUtils.h</a></div></div>
<div class="ttc" id="aCasting_8h_html"><div class="ttname"><a href="Casting_8h.html">Casting.h</a></div></div>
<div class="ttc" id="aCloning_8h_html"><div class="ttname"><a href="Cloning_8h.html">Cloning.h</a></div></div>
<div class="ttc" id="aCommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="aCoroSplit_8cpp_html_a1b7259e431066a500b6b6e7267fad8c3"><div class="ttname"><a href="CoroSplit_8cpp.html#a1b7259e431066a500b6b6e7267fad8c3">Changed</a></div><div class="ttdeci">return Changed</div><div class="ttdef"><b>Definition</b> <a href="CoroSplit_8cpp_source.html#l01999">CoroSplit.cpp:1999</a></div></div>
<div class="ttc" id="aCoroSplit_8cpp_html_a870dde7776fd5695fbfa39d3c6396fc6"><div class="ttname"><a href="CoroSplit_8cpp.html#a870dde7776fd5695fbfa39d3c6396fc6">CG</a></div><div class="ttdeci">Remove calls to llvm coro prepare a barrier meant to prevent IPO from operating on calls to a retcon coroutine before it s been split This is only safe to do after we ve split all retcon coroutines in the module We can do that this in this pass because this pass does promise to split all retcon CallGraph &amp; CG</div><div class="ttdef"><b>Definition</b> <a href="CoroSplit_8cpp_source.html#l01989">CoroSplit.cpp:1989</a></div></div>
<div class="ttc" id="aCoroutines_8cpp_html_ac781ce96aa25ba7f6fd38f72de665450"><div class="ttname"><a href="Coroutines_8cpp.html#ac781ce96aa25ba7f6fd38f72de665450">clear</a></div><div class="ttdeci">static void clear(coro::Shape &amp;Shape)</div><div class="ttdef"><b>Definition</b> <a href="Coroutines_8cpp_source.html#l00232">Coroutines.cpp:232</a></div></div>
<div class="ttc" id="aDebugInfoMetadata_8h_html"><div class="ttname"><a href="DebugInfoMetadata_8h.html">DebugInfoMetadata.h</a></div></div>
<div class="ttc" id="aDebugLoc_8h_html"><div class="ttname"><a href="DebugLoc_8h.html">DebugLoc.h</a></div></div>
<div class="ttc" id="aDebug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="aDebug_8h_html_a08efc68d15935eb8889400a46c3749ba"><div class="ttname"><a href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a></div><div class="ttdeci">#define LLVM_DEBUG(X)</div><div class="ttdef"><b>Definition</b> <a href="Debug_8h_source.html#l00122">Debug.h:122</a></div></div>
<div class="ttc" id="aDenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="aDenseSet_8h_html"><div class="ttname"><a href="DenseSet_8h.html">DenseSet.h</a></div></div>
<div class="ttc" id="aDiagnosticInfo_8h_html"><div class="ttname"><a href="DiagnosticInfo_8h.html">DiagnosticInfo.h</a></div></div>
<div class="ttc" id="aDominators_8h_html"><div class="ttname"><a href="Dominators_8h.html">Dominators.h</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_adc852f586959ce13117d737cf3f14899"><div class="ttname"><a href="ELFObjHandler_8cpp.html#adc852f586959ce13117d737cf3f14899">Name</a></div><div class="ttdeci">std::string Name</div><div class="ttdef"><b>Definition</b> <a href="ELFObjHandler_8cpp_source.html#l00078">ELFObjHandler.cpp:78</a></div></div>
<div class="ttc" id="aEntryExitInstrumenter_8cpp_html_a3985f1f39349428d17f0d2b81ebc6349"><div class="ttname"><a href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a></div><div class="ttdeci">static bool runOnFunction(Function &amp;F, bool PostInlining)</div><div class="ttdef"><b>Definition</b> <a href="EntryExitInstrumenter_8cpp_source.html#l00067">EntryExitInstrumenter.cpp:67</a></div></div>
<div class="ttc" id="aErrorOr_8h_html"><div class="ttname"><a href="ErrorOr_8h.html">ErrorOr.h</a></div><div class="ttdoc">Provides ErrorOr&lt;T&gt; smart pointer.</div></div>
<div class="ttc" id="aFunction_8cpp_html_ac57dae906fe8ac64efe52571121b0fe1"><div class="ttname"><a href="Function_8cpp.html#ac57dae906fe8ac64efe52571121b0fe1">ProfileCount</a></div><div class="ttdeci">Function::ProfileCount ProfileCount</div><div class="ttdef"><b>Definition</b> <a href="Function_8cpp_source.html#l00071">Function.cpp:71</a></div></div>
<div class="ttc" id="aFunction_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="aGenericDomTree_8h_html"><div class="ttname"><a href="GenericDomTree_8h.html">GenericDomTree.h</a></div><div class="ttdoc">This file defines a set of templates that efficiently compute a dominator tree over a generic graph.</div></div>
<div class="ttc" id="aGlobalValue_8h_html"><div class="ttname"><a href="GlobalValue_8h.html">GlobalValue.h</a></div></div>
<div class="ttc" id="aHexagonEarlyIfConv_8cpp_html_a69e1845bcbb3948c6e36bbbfb71e8024"><div class="ttname"><a href="HexagonEarlyIfConv_8cpp.html#a69e1845bcbb3948c6e36bbbfb71e8024">SizeLimit</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; SizeLimit(&quot;eif-limit&quot;, cl::init(6), cl::Hidden, cl::desc(&quot;Size limit in Hexagon early if-conversion&quot;))</div></div>
<div class="ttc" id="aIR_2CFG_8h_html"><div class="ttname"><a href="IR_2CFG_8h.html">CFG.h</a></div><div class="ttdoc">This file provides various utilities for inspecting and working with the control flow graph in LLVM I...</div></div>
<div class="ttc" id="aIR_2Instruction_8h_html"><div class="ttname"><a href="IR_2Instruction_8h.html">Instruction.h</a></div></div>
<div class="ttc" id="aInitializePasses_8h_html"><div class="ttname"><a href="InitializePasses_8h.html">InitializePasses.h</a></div></div>
<div class="ttc" id="aInlineAdvisor_8h_html"><div class="ttname"><a href="InlineAdvisor_8h.html">InlineAdvisor.h</a></div></div>
<div class="ttc" id="aInlineCost_8h_html"><div class="ttname"><a href="InlineCost_8h.html">InlineCost.h</a></div></div>
<div class="ttc" id="aInstrProf_8h_html"><div class="ttname"><a href="InstrProf_8h.html">InstrProf.h</a></div></div>
<div class="ttc" id="aInstrTypes_8h_html"><div class="ttname"><a href="InstrTypes_8h.html">InstrTypes.h</a></div></div>
<div class="ttc" id="aInstructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="aInstrumentation_8h_html"><div class="ttname"><a href="Instrumentation_8h.html">Instrumentation.h</a></div></div>
<div class="ttc" id="aIntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="aLLVMContext_8h_html"><div class="ttname"><a href="LLVMContext_8h.html">LLVMContext.h</a></div></div>
<div class="ttc" id="aLoopInfo_8h_html"><div class="ttname"><a href="LoopInfo_8h.html">LoopInfo.h</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition</b> <a href="MD5_8cpp_source.html#l00056">MD5.cpp:56</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition</b> <a href="MD5_8cpp_source.html#l00059">MD5.cpp:59</a></div></div>
<div class="ttc" id="aMDBuilder_8h_html"><div class="ttname"><a href="MDBuilder_8h.html">MDBuilder.h</a></div></div>
<div class="ttc" id="aMemoryBuiltins_8cpp_html_ae600683abe0d417d21ad0a25f42de205"><div class="ttname"><a href="MemoryBuiltins_8cpp.html#ae600683abe0d417d21ad0a25f42de205">getCalledFunction</a></div><div class="ttdeci">static const Function * getCalledFunction(const Value *V, bool LookThroughBitCast, bool &amp;IsNoBuiltin)</div><div class="ttdef"><b>Definition</b> <a href="MemoryBuiltins_8cpp_source.html#l00116">MemoryBuiltins.cpp:116</a></div></div>
<div class="ttc" id="aModule_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div><div class="ttdoc">Module.h This file contains the declarations for the Module class.</div></div>
<div class="ttc" id="aNone_8h_html"><div class="ttname"><a href="None_8h.html">None.h</a></div></div>
<div class="ttc" id="aOptimizationRemarkEmitter_8h_html"><div class="ttname"><a href="OptimizationRemarkEmitter_8h.html">OptimizationRemarkEmitter.h</a></div></div>
<div class="ttc" id="aPassManager_8h_html"><div class="ttname"><a href="PassManager_8h.html">PassManager.h</a></div><div class="ttdoc">This header defines various interfaces for pass management in LLVM.</div></div>
<div class="ttc" id="aPassSupport_8h_html_a14724f1ccf528e73bb29bc9230737967"><div class="ttname"><a href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">#define INITIALIZE_PASS_DEPENDENCY(depName)</div><div class="ttdef"><b>Definition</b> <a href="PassSupport_8h_source.html#l00054">PassSupport.h:54</a></div></div>
<div class="ttc" id="aPassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition</b> <a href="PassSupport_8h_source.html#l00058">PassSupport.h:58</a></div></div>
<div class="ttc" id="aPassSupport_8h_html_aaa970fc931c1c63037a8182e028d04b1"><div class="ttname"><a href="PassSupport_8h.html#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">#define INITIALIZE_PASS_BEGIN(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition</b> <a href="PassSupport_8h_source.html#l00051">PassSupport.h:51</a></div></div>
<div class="ttc" id="aPass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="aPostDominators_8h_html"><div class="ttname"><a href="PostDominators_8h.html">PostDominators.h</a></div></div>
<div class="ttc" id="aPriorityQueue_8h_html"><div class="ttname"><a href="PriorityQueue_8h.html">PriorityQueue.h</a></div></div>
<div class="ttc" id="aProfileSummaryInfo_8h_html"><div class="ttname"><a href="ProfileSummaryInfo_8h.html">ProfileSummaryInfo.h</a></div></div>
<div class="ttc" id="aProvenanceAnalysisEvaluator_8cpp_html_a2ee79648e8bce3ddbb26358ff10e3e82"><div class="ttname"><a href="ProvenanceAnalysisEvaluator_8cpp.html#a2ee79648e8bce3ddbb26358ff10e3e82">getName</a></div><div class="ttdeci">static StringRef getName(Value *V)</div><div class="ttdef"><b>Definition</b> <a href="ProvenanceAnalysisEvaluator_8cpp_source.html#l00042">ProvenanceAnalysisEvaluator.cpp:42</a></div></div>
<div class="ttc" id="aReplayInlineAdvisor_8h_html"><div class="ttname"><a href="ReplayInlineAdvisor_8h.html">ReplayInlineAdvisor.h</a></div></div>
<div class="ttc" id="aSCCIterator_8h_html"><div class="ttname"><a href="SCCIterator_8h.html">SCCIterator.h</a></div><div class="ttdoc">This builds on the llvm/ADT/GraphTraits.h file to find the strongly connected components (SCCs) of a ...</div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a></div><div class="ttdeci">@ SI</div><div class="ttdef"><b>Definition</b> <a href="SIInstrInfo_8cpp_source.html#l07065">SIInstrInfo.cpp:7065</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="aSampleContextTracker_8h_html"><div class="ttname"><a href="SampleContextTracker_8h.html">SampleContextTracker.h</a></div><div class="ttdoc">This file provides the interface for context-sensitive profile tracker used by CSSPGO.</div></div>
<div class="ttc" id="aSampleProfReader_8h_html"><div class="ttname"><a href="SampleProfReader_8h.html">SampleProfReader.h</a></div></div>
<div class="ttc" id="aSampleProf_8h_html"><div class="ttname"><a href="SampleProf_8h.html">SampleProf.h</a></div></div>
<div class="ttc" id="aSampleProfileProbe_8h_html"><div class="ttname"><a href="SampleProfileProbe_8h.html">SampleProfileProbe.h</a></div><div class="ttdoc">This file provides the interface for the pseudo probe implementation for AutoFDO.</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a0200f3202920f714e0b23c4606a27192"><div class="ttname"><a href="SampleProfile_8cpp.html#a0200f3202920f714e0b23c4606a27192">NoWarnSampleUnused</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; NoWarnSampleUnused(&quot;no-warn-sample-unused&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Use this option to turn off/on warnings about function with &quot; &quot;samples but without debug information to use those samples. &quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a033aa3e7e3e183cec38f5a5e36e212c7"><div class="ttname"><a href="SampleProfile_8cpp.html#a033aa3e7e3e183cec38f5a5e36e212c7">SampleHotCallSiteThreshold</a></div><div class="ttdeci">static cl::opt&lt; int &gt; SampleHotCallSiteThreshold(&quot;sample-profile-hot-inline-threshold&quot;, cl::Hidden, cl::init(3000), cl::desc(&quot;Hot callsite threshold for proirity-based sample profile loader &quot; &quot;inlining.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a055c6b7054a94b338830b3da8ecc4023"><div class="ttname"><a href="SampleProfile_8cpp.html#a055c6b7054a94b338830b3da8ecc4023">SampleProfileFile</a></div><div class="ttdeci">static cl::opt&lt; std::string &gt; SampleProfileFile(&quot;sample-profile-file&quot;, cl::init(&quot;&quot;), cl::value_desc(&quot;filename&quot;), cl::desc(&quot;Profile file loaded by -sample-profile&quot;), cl::Hidden)</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a1fbf05aa3c19fb9ce58e03dcca69e493"><div class="ttname"><a href="SampleProfile_8cpp.html#a1fbf05aa3c19fb9ce58e03dcca69e493">ProfileInlineLimitMax</a></div><div class="ttdeci">static cl::opt&lt; int &gt; ProfileInlineLimitMax(&quot;sample-profile-inline-limit-max&quot;, cl::Hidden, cl::init(10000), cl::desc(&quot;The upper bound of size growth limit for &quot; &quot;proirity-based sample profile loader inlining.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a3e3a587b7e1abc61882cb48ed0b5b3d2"><div class="ttname"><a href="SampleProfile_8cpp.html#a3e3a587b7e1abc61882cb48ed0b5b3d2">UseProfileTopDownOrder</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; UseProfileTopDownOrder(&quot;use-profile-top-down-order&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Process functions in one SCC in a top-down order &quot; &quot;based on the input profile.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a40954848b5b26403e461ce7a190243d4"><div class="ttname"><a href="SampleProfile_8cpp.html#a40954848b5b26403e461ce7a190243d4">SampleProfileRecordCoverage</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; SampleProfileRecordCoverage(&quot;sample-profile-check-record-coverage&quot;, cl::init(0), cl::value_desc(&quot;N&quot;), cl::desc(&quot;Emit a warning if less than N% of records in the input profile &quot; &quot;are matched to the IR.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a4e4de7b815d127b5177401937420c294"><div class="ttname"><a href="SampleProfile_8cpp.html#a4e4de7b815d127b5177401937420c294">UseProfileIndirectCallEdges</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; UseProfileIndirectCallEdges(&quot;use-profile-indirect-call-edges&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Considering indirect call samples from profile when top-down &quot; &quot;processing functions. Only CSSPGO is supported.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a582e224bc99dcf3ca6263cdd9b25d94f"><div class="ttname"><a href="SampleProfile_8cpp.html#a582e224bc99dcf3ca6263cdd9b25d94f">CallsitePrioritizedInline</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; CallsitePrioritizedInline(&quot;sample-profile-prioritized-inline&quot;, cl::Hidden, cl::ZeroOrMore, cl::init(false), cl::desc(&quot;Use call site prioritized inlining for sample profile loader.&quot; &quot;Currently only CSSPGO is supported.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a6c063cf654bf13a20d00365c2ef7b1da"><div class="ttname"><a href="SampleProfile_8cpp.html#a6c063cf654bf13a20d00365c2ef7b1da">SampleColdCallSiteThreshold</a></div><div class="ttdeci">static cl::opt&lt; int &gt; SampleColdCallSiteThreshold(&quot;sample-profile-cold-inline-threshold&quot;, cl::Hidden, cl::init(45), cl::desc(&quot;Threshold for inlining cold callsites&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a6f2891ea30bbf02e93cc94ca385d8d91"><div class="ttname"><a href="SampleProfile_8cpp.html#a6f2891ea30bbf02e93cc94ca385d8d91">ProfileInlineGrowthLimit</a></div><div class="ttdeci">static cl::opt&lt; int &gt; ProfileInlineGrowthLimit(&quot;sample-profile-inline-growth-limit&quot;, cl::Hidden, cl::init(12), cl::desc(&quot;The size growth ratio limit for proirity-based sample profile &quot; &quot;loader inlining.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a732d61bd469914910adee6ed8c8c4a38"><div class="ttname"><a href="SampleProfile_8cpp.html#a732d61bd469914910adee6ed8c8c4a38">ProfileInlineReplayFile</a></div><div class="ttdeci">static cl::opt&lt; std::string &gt; ProfileInlineReplayFile(&quot;sample-profile-inline-replay&quot;, cl::init(&quot;&quot;), cl::value_desc(&quot;filename&quot;), cl::desc(&quot;Optimization remarks file containing inline remarks to be replayed &quot; &quot;by inlining from sample profile loader.&quot;), cl::Hidden)</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a8aa89f0866c6f65d2395b74e851e73f7"><div class="ttname"><a href="SampleProfile_8cpp.html#a8aa89f0866c6f65d2395b74e851e73f7">ProfileAccurateForSymsInList</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ProfileAccurateForSymsInList(&quot;profile-accurate-for-symsinlist&quot;, cl::Hidden, cl::ZeroOrMore, cl::init(true), cl::desc(&quot;For symbols in profile symbol list, regard their profiles to &quot; &quot;be accurate. It may be overriden by profile-sample-accurate. &quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a8ac02d9aff84c95f5894d9f7ef8c5e4a"><div class="ttname"><a href="SampleProfile_8cpp.html#a8ac02d9aff84c95f5894d9f7ef8c5e4a">SampleProfileSampleCoverage</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; SampleProfileSampleCoverage(&quot;sample-profile-check-sample-coverage&quot;, cl::init(0), cl::value_desc(&quot;N&quot;), cl::desc(&quot;Emit a warning if less than N% of samples in the input profile &quot; &quot;are matched to the IR.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a8b16dbb3ebefd05908afe3a7874d6353"><div class="ttname"><a href="SampleProfile_8cpp.html#a8b16dbb3ebefd05908afe3a7874d6353">ProfileMergeInlinee</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ProfileMergeInlinee(&quot;sample-profile-merge-inlinee&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Merge past inlinee's profile to outline version if sample &quot; &quot;profile loader decided not to inline a call site. It will &quot; &quot;only be enabled when top-down order of profile loading is &quot; &quot;enabled. &quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_a9248a6cbd185564d6817d671ddc29c90"><div class="ttname"><a href="SampleProfile_8cpp.html#a9248a6cbd185564d6817d671ddc29c90">ProfileICPThreshold</a></div><div class="ttdeci">static cl::opt&lt; int &gt; ProfileICPThreshold(&quot;sample-profile-icp-threshold&quot;, cl::Hidden, cl::init(5), cl::desc(&quot;Relative hotness threshold for indirect &quot; &quot;call promotion in proirity-based sample profile loader inlining.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_aa6d0a32738af9bd060dcfe35c6ee4b44"><div class="ttname"><a href="SampleProfile_8cpp.html#aa6d0a32738af9bd060dcfe35c6ee4b44">loader</a></div><div class="ttdeci">sample Sample Profile loader</div><div class="ttdef"><b>Definition</b> <a href="#l02291">SampleProfile.cpp:2291</a></div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_aade7b2da98de69a3231e8205e9770963"><div class="ttname"><a href="SampleProfile_8cpp.html#aade7b2da98de69a3231e8205e9770963">SampleProfileMaxPropagateIterations</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; SampleProfileMaxPropagateIterations(&quot;sample-profile-max-propagate-iterations&quot;, cl::init(100), cl::desc(&quot;Maximum number of iterations to go through when propagating &quot; &quot;sample block/edge weights through the CFG.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_aaf55fbc9b8550957ceb81da6a13f54e4"><div class="ttname"><a href="SampleProfile_8cpp.html#aaf55fbc9b8550957ceb81da6a13f54e4">GetSortedValueDataFromCallTargets</a></div><div class="ttdeci">static SmallVector&lt; InstrProfValueData, 2 &gt; GetSortedValueDataFromCallTargets(const SampleRecord::CallTargetMap &amp;M)</div><div class="ttdoc">Returns the sorted CallTargetMap M by count in descending order.</div><div class="ttdef"><b>Definition</b> <a href="#l01942">SampleProfile.cpp:1942</a></div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_ab4932d7673e6e1138d8a2671f16865d1"><div class="ttname"><a href="SampleProfile_8cpp.html#ab4932d7673e6e1138d8a2671f16865d1">CSINLINE_DEBUG</a></div><div class="ttdeci">#define CSINLINE_DEBUG</div><div class="ttdef"><b>Definition</b> <a href="#l00102">SampleProfile.cpp:102</a></div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_ada8f2c564085d598909fb28464614812"><div class="ttname"><a href="SampleProfile_8cpp.html#ada8f2c564085d598909fb28464614812">ProfileSizeInline</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ProfileSizeInline(&quot;sample-profile-inline-size&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Inline cold call sites in profile loader if it's beneficial &quot; &quot;for code size.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_ae2b46e6b1f93e3b18b20d0c0c0ac6151"><div class="ttname"><a href="SampleProfile_8cpp.html#ae2b46e6b1f93e3b18b20d0c0c0ac6151">ProfileInlineLimitMin</a></div><div class="ttdeci">static cl::opt&lt; int &gt; ProfileInlineLimitMin(&quot;sample-profile-inline-limit-min&quot;, cl::Hidden, cl::init(100), cl::desc(&quot;The lower bound of size growth limit for &quot; &quot;proirity-based sample profile loader inlining.&quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_aeeed05c14d5103af2df4ef16b3d12674"><div class="ttname"><a href="SampleProfile_8cpp.html#aeeed05c14d5103af2df4ef16b3d12674">ProfileTopDownLoad</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ProfileTopDownLoad(&quot;sample-profile-top-down-load&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Do profile annotation and inlining for functions in top-down &quot; &quot;order of call graph during sample profile loading. It only &quot; &quot;works for new pass manager. &quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_af00e1c8a074b97aedd1a2db33dea6753"><div class="ttname"><a href="SampleProfile_8cpp.html#af00e1c8a074b97aedd1a2db33dea6753">ProfileSampleAccurate</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ProfileSampleAccurate(&quot;profile-sample-accurate&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;If the sample profile is accurate, we will mark all un-sampled &quot; &quot;callsite and function as having 0 samples. Otherwise, treat &quot; &quot;un-sampled callsites and functions conservatively as unknown. &quot;))</div></div>
<div class="ttc" id="aSampleProfile_8cpp_html_af8d3791537a44c00b699d28c4d978d82"><div class="ttname"><a href="SampleProfile_8cpp.html#af8d3791537a44c00b699d28c4d978d82">SampleProfileRemappingFile</a></div><div class="ttdeci">static cl::opt&lt; std::string &gt; SampleProfileRemappingFile(&quot;sample-profile-remapping-file&quot;, cl::init(&quot;&quot;), cl::value_desc(&quot;filename&quot;), cl::desc(&quot;Profile remapping file loaded by -sample-profile&quot;), cl::Hidden)</div></div>
<div class="ttc" id="aSampleProfile_8h_html"><div class="ttname"><a href="SampleProfile_8h.html">SampleProfile.h</a></div><div class="ttdoc">This file provides the interface for the sampled PGO loader pass.</div></div>
<div class="ttc" id="aSmallPtrSet_8h_html"><div class="ttname"><a href="SmallPtrSet_8h.html">SmallPtrSet.h</a></div></div>
<div class="ttc" id="aSmallSet_8h_html"><div class="ttname"><a href="SmallSet_8h.html">SmallSet.h</a></div></div>
<div class="ttc" id="aSmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="aStatistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="aStatistic_8h_html_ad6117415b93e5675d5a6c8e1855b3b2f"><div class="ttname"><a href="Statistic_8h.html#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a></div><div class="ttdeci">#define STATISTIC(VARNAME, DESC)</div><div class="ttdef"><b>Definition</b> <a href="Statistic_8h_source.html#l00169">Statistic.h:169</a></div></div>
<div class="ttc" id="aStringMap_8h_html"><div class="ttname"><a href="StringMap_8h.html">StringMap.h</a></div></div>
<div class="ttc" id="aStringRef_8h_html"><div class="ttname"><a href="StringRef_8h.html">StringRef.h</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8h_html"><div class="ttname"><a href="TargetLibraryInfo_8h.html">TargetLibraryInfo.h</a></div></div>
<div class="ttc" id="aTargetTransformInfo_8h_html"><div class="ttname"><a href="TargetTransformInfo_8h.html">TargetTransformInfo.h</a></div><div class="ttdoc">This pass exposes codegen information to IR-level passes.</div></div>
<div class="ttc" id="aTwine_8h_html"><div class="ttname"><a href="Twine_8h.html">Twine.h</a></div></div>
<div class="ttc" id="aValueSymbolTable_8h_html"><div class="ttname"><a href="ValueSymbolTable_8h.html">ValueSymbolTable.h</a></div></div>
<div class="ttc" id="aclassB1_html"><div class="ttname"><a href="classB1.html">B1</a></div></div>
<div class="ttc" id="aclassNode_html"><div class="ttname"><a href="classNode.html">Node</a></div><div class="ttdef"><b>Definition</b> <a href="ItaniumDemangle_8h_source.html#l00114">ItaniumDemangle.h:114</a></div></div>
<div class="ttc" id="aclassT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html">llvm::AnalysisManager</a></div><div class="ttdoc">A container for analyses that lazily runs them and caches their results.</div><div class="ttdef"><b>Definition</b> <a href="PassManager_8h_source.html#l00629">PassManager.h:629</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html_aaab1fad63e4f3b8679469720a873fedd"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html#aaab1fad63e4f3b8679469720a873fedd">llvm::AnalysisManager::getResult</a></div><div class="ttdeci">PassT::Result &amp; getResult(IRUnitT &amp;IR, ExtraArgTs... ExtraArgs)</div><div class="ttdoc">Get the result of an analysis pass for a given IR unit.</div><div class="ttdef"><b>Definition</b> <a href="PassManager_8h_source.html#l00785">PassManager.h:785</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdoc">Represent the analysis usage information of a pass.</div><div class="ttdef"><b>Definition</b> <a href="PassAnalysisSupport_8h_source.html#l00047">PassAnalysisSupport.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_ae0adcccca08fb686c9ce00f9397b660c"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae0adcccca08fb686c9ce00f9397b660c">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition</b> <a href="PassAnalysisSupport_8h_source.html#l00075">PassAnalysisSupport.h:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1AssumptionAnalysis_html"><div class="ttname"><a href="classllvm_1_1AssumptionAnalysis.html">llvm::AssumptionAnalysis</a></div><div class="ttdoc">A function analysis which provides an AssumptionCache.</div><div class="ttdef"><b>Definition</b> <a href="AssumptionCache_8h_source.html#l00169">AssumptionCache.h:169</a></div></div>
<div class="ttc" id="aclassllvm_1_1AssumptionCacheTracker_html"><div class="ttname"><a href="classllvm_1_1AssumptionCacheTracker.html">llvm::AssumptionCacheTracker</a></div><div class="ttdoc">An immutable pass that tracks lazily created AssumptionCache objects.</div><div class="ttdef"><b>Definition</b> <a href="AssumptionCache_8h_source.html#l00200">AssumptionCache.h:200</a></div></div>
<div class="ttc" id="aclassllvm_1_1AssumptionCache_html"><div class="ttname"><a href="classllvm_1_1AssumptionCache.html">llvm::AssumptionCache</a></div><div class="ttdoc">A cache of @llvm.assume calls within a function.</div><div class="ttdef"><b>Definition</b> <a href="AssumptionCache_8h_source.html#l00041">AssumptionCache.h:41</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation.</div><div class="ttdef"><b>Definition</b> <a href="BasicBlock_8h_source.html#l00058">BasicBlock.h:59</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a80069e261aca5e34cffcc2ef67cfa29b"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a80069e261aca5e34cffcc2ef67cfa29b">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const</div><div class="ttdoc">Return the enclosing method, or null if none.</div><div class="ttdef"><b>Definition</b> <a href="BasicBlock_8h_source.html#l00107">BasicBlock.h:107</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_abd8b410b10f28942f75e0bd4f7d5f79c"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#abd8b410b10f28942f75e0bd4f7d5f79c">llvm::BasicBlock::getFirstNonPHIOrDbgOrLifetime</a></div><div class="ttdeci">const Instruction * getFirstNonPHIOrDbgOrLifetime(bool SkipPseudoOp=false) const</div><div class="ttdoc">Returns a pointer to the first instruction in this block that is not a PHINode, a debug intrinsic,...</div><div class="ttdef"><b>Definition</b> <a href="BasicBlock_8cpp_source.html#l00233">BasicBlock.cpp:233</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html"><div class="ttname"><a href="classllvm_1_1CallBase.html">llvm::CallBase</a></div><div class="ttdoc">Base class for all callable instructions (InvokeInst and CallInst) Holds everything related to callin...</div><div class="ttdef"><b>Definition</b> <a href="InstrTypes_8h_source.html#l01164">InstrTypes.h:1164</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a2b1ae7cf1bafdd43d1fee4c6ad0a2913"><div class="ttname"><a href="classllvm_1_1CallBase.html#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">llvm::CallBase::getCalledFunction</a></div><div class="ttdeci">Function * getCalledFunction() const</div><div class="ttdoc">Returns the function called, or null if this is an indirect function invocation.</div><div class="ttdef"><b>Definition</b> <a href="InstrTypes_8h_source.html#l01378">InstrTypes.h:1378</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a574efc7d85ff014d5f15e077f3c82e6b"><div class="ttname"><a href="classllvm_1_1CallBase.html#a574efc7d85ff014d5f15e077f3c82e6b">llvm::CallBase::isIndirectCall</a></div><div class="ttdeci">bool isIndirectCall() const</div><div class="ttdoc">Return true if the callsite is an indirect call.</div><div class="ttdef"><b>Definition</b> <a href="Instructions_8cpp_source.html#l00272">Instructions.cpp:272</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallGraphAnalysis_html"><div class="ttname"><a href="classllvm_1_1CallGraphAnalysis.html">llvm::CallGraphAnalysis</a></div><div class="ttdoc">An analysis pass to compute the CallGraph for a Module.</div><div class="ttdef"><b>Definition</b> <a href="CallGraph_8h_source.html#l00305">CallGraph.h:305</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallGraphNode_html"><div class="ttname"><a href="classllvm_1_1CallGraphNode.html">llvm::CallGraphNode</a></div><div class="ttdoc">A node in the call graph for a module.</div><div class="ttdef"><b>Definition</b> <a href="CallGraph_8h_source.html#l00167">CallGraph.h:167</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallGraph_html"><div class="ttname"><a href="classllvm_1_1CallGraph.html">llvm::CallGraph</a></div><div class="ttdoc">The basic data container for the call graph of a Module of IR.</div><div class="ttdef"><b>Definition</b> <a href="CallGraph_8h_source.html#l00073">CallGraph.h:73</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdoc">This class represents a function call, abstracting a target machine's calling convention.</div><div class="ttdef"><b>Definition</b> <a href="Instructions_8h_source.html#l01450">Instructions.h:1450</a></div></div>
<div class="ttc" id="aclassllvm_1_1DILocalScope_html_a0e0b4a5906e0bc2a7fa033548c59a220"><div class="ttname"><a href="classllvm_1_1DILocalScope.html#a0e0b4a5906e0bc2a7fa033548c59a220">llvm::DILocalScope::getSubprogram</a></div><div class="ttdeci">DISubprogram * getSubprogram() const</div><div class="ttdoc">Get the subprogram for this scope.</div><div class="ttdef"><b>Definition</b> <a href="DebugInfoMetadata_8cpp_source.html#l00797">DebugInfoMetadata.cpp:797</a></div></div>
<div class="ttc" id="aclassllvm_1_1DILocation_html"><div class="ttname"><a href="classllvm_1_1DILocation.html">llvm::DILocation</a></div><div class="ttdoc">Debug location.</div><div class="ttdef"><b>Definition</b> <a href="DebugInfoMetadata_8h_source.html#l01554">DebugInfoMetadata.h:1554</a></div></div>
<div class="ttc" id="aclassllvm_1_1DISubprogram_html"><div class="ttname"><a href="classllvm_1_1DISubprogram.html">llvm::DISubprogram</a></div><div class="ttdoc">Subprogram description.</div><div class="ttdef"><b>Definition</b> <a href="DebugInfoMetadata_8h_source.html#l01811">DebugInfoMetadata.h:1811</a></div></div>
<div class="ttc" id="aclassllvm_1_1DebugLoc_html"><div class="ttname"><a href="classllvm_1_1DebugLoc.html">llvm::DebugLoc</a></div><div class="ttdoc">A debug info location.</div><div class="ttdef"><b>Definition</b> <a href="DebugLoc_8h_source.html#l00033">DebugLoc.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1DebugLoc_html_a427c256af834975c7869ad28fac00563"><div class="ttname"><a href="classllvm_1_1DebugLoc.html#a427c256af834975c7869ad28fac00563">llvm::DebugLoc::getLine</a></div><div class="ttdeci">unsigned getLine() const</div><div class="ttdef"><b>Definition</b> <a href="DebugLoc_8cpp_source.html#l00025">DebugLoc.cpp:25</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a0b2ca98dc28c61793ff5c90d23e5f14e"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a0b2ca98dc28c61793ff5c90d23e5f14e">llvm::DenseMapBase::lookup</a></div><div class="ttdeci">ValueT lookup(const_arg_type_t&lt; KeyT &gt; Val) const</div><div class="ttdoc">lookup - Return the entry for the specified key, or a default constructed value if no such entry exis...</div><div class="ttdef"><b>Definition</b> <a href="DenseMap_8h_source.html#l00197">DenseMap.h:197</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_adb33f3ede2f5bfc9b3ee658aaf648492"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#adb33f3ede2f5bfc9b3ee658aaf648492">llvm::DenseMapBase::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition</b> <a href="DenseMap_8h_source.html#l00207">DenseMap.h:207</a></div></div>
<div class="ttc" id="aclassllvm_1_1DiagnosticInfoSampleProfile_html"><div class="ttname"><a href="classllvm_1_1DiagnosticInfoSampleProfile.html">llvm::DiagnosticInfoSampleProfile</a></div><div class="ttdoc">Diagnostic information for the sample profiler.</div><div class="ttdef"><b>Definition</b> <a href="DiagnosticInfo_8h_source.html#l00284">DiagnosticInfo.h:284</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTree_html"><div class="ttname"><a href="classllvm_1_1DominatorTree.html">llvm::DominatorTree</a></div><div class="ttdoc">Concrete subclass of DominatorTreeBase that is used to compute a normal dominator tree.</div><div class="ttdef"><b>Definition</b> <a href="Dominators_8h_source.html#l00151">Dominators.h:151</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_1_1ProfileCount_html"><div class="ttname"><a href="classllvm_1_1Function_1_1ProfileCount.html">llvm::Function::ProfileCount</a></div><div class="ttdoc">Class to represent profile counts.</div><div class="ttdef"><b>Definition</b> <a href="Function_8h_source.html#l00282">Function.h:282</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition</b> <a href="Function_8h_source.html#l00061">Function.h:61</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html_a438d2f246b76817114ade2a005a6bcabac7dbc704eba08842e6acdde9cf6379ba"><div class="ttname"><a href="classllvm_1_1Function.html#a438d2f246b76817114ade2a005a6bcabac7dbc704eba08842e6acdde9cf6379ba">llvm::Function::PCT_Real</a></div><div class="ttdeci">@ PCT_Real</div><div class="ttdef"><b>Definition</b> <a href="Function_8h_source.html#l00277">Function.h:277</a></div></div>
<div class="ttc" id="aclassllvm_1_1InlineCost_html"><div class="ttname"><a href="classllvm_1_1InlineCost.html">llvm::InlineCost</a></div><div class="ttdoc">Represents the cost of inlining a function.</div><div class="ttdef"><b>Definition</b> <a href="InlineCost_8h_source.html#l00067">InlineCost.h:67</a></div></div>
<div class="ttc" id="aclassllvm_1_1InlineCost_html_a7a81805a6584dbd95ea13ecd57ec7b9a"><div class="ttname"><a href="classllvm_1_1InlineCost.html#a7a81805a6584dbd95ea13ecd57ec7b9a">llvm::InlineCost::getNever</a></div><div class="ttdeci">static InlineCost getNever(const char *Reason)</div><div class="ttdef"><b>Definition</b> <a href="InlineCost_8h_source.html#l00095">InlineCost.h:95</a></div></div>
<div class="ttc" id="aclassllvm_1_1InlineCost_html_ac7c62ec9e2cd5d974f662038b8c8951f"><div class="ttname"><a href="classllvm_1_1InlineCost.html#ac7c62ec9e2cd5d974f662038b8c8951f">llvm::InlineCost::get</a></div><div class="ttdeci">static InlineCost get(int Cost, int Threshold)</div><div class="ttdef"><b>Definition</b> <a href="InlineCost_8h_source.html#l00087">InlineCost.h:87</a></div></div>
<div class="ttc" id="aclassllvm_1_1InlineCost_html_afbef5b1bdefbcd81cbd1bab57f83ed45"><div class="ttname"><a href="classllvm_1_1InlineCost.html#afbef5b1bdefbcd81cbd1bab57f83ed45">llvm::InlineCost::getAlways</a></div><div class="ttdeci">static InlineCost getAlways(const char *Reason)</div><div class="ttdef"><b>Definition</b> <a href="InlineCost_8h_source.html#l00092">InlineCost.h:92</a></div></div>
<div class="ttc" id="aclassllvm_1_1InlineFunctionInfo_html"><div class="ttname"><a href="classllvm_1_1InlineFunctionInfo.html">llvm::InlineFunctionInfo</a></div><div class="ttdoc">This class captures the data input to the InlineFunction call, and records the auxiliary results prod...</div><div class="ttdef"><b>Definition</b> <a href="Cloning_8h_source.html#l00172">Cloning.h:172</a></div></div>
<div class="ttc" id="aclassllvm_1_1InnerAnalysisManagerProxy_html"><div class="ttname"><a href="classllvm_1_1InnerAnalysisManagerProxy.html">llvm::InnerAnalysisManagerProxy</a></div><div class="ttdoc">An analysis over an &quot;outer&quot; IR unit that provides access to an analysis manager over an &quot;inner&quot; IR un...</div><div class="ttdef"><b>Definition</b> <a href="PassManager_8h_source.html#l00969">PassManager.h:971</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition</b> <a href="IR_2Instruction_8h_source.html#l00045">Instruction.h:46</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a4b8faae4ff9e7434a1d226d03d15dcd2"><div class="ttname"><a href="classllvm_1_1Instruction.html#a4b8faae4ff9e7434a1d226d03d15dcd2">llvm::Instruction::getDebugLoc</a></div><div class="ttdeci">const DebugLoc &amp; getDebugLoc() const</div><div class="ttdoc">Return the debug location for this node as a DebugLoc.</div><div class="ttdef"><b>Definition</b> <a href="IR_2Instruction_8h_source.html#l00365">Instruction.h:365</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a51d5735829e1f043630dd403f01d4219"><div class="ttname"><a href="classllvm_1_1Instruction.html#a51d5735829e1f043630dd403f01d4219">llvm::Instruction::extractProfTotalWeight</a></div><div class="ttdeci">bool extractProfTotalWeight(uint64_t &amp;TotalVal) const</div><div class="ttdoc">Retrieve total raw weight values of a branch.</div><div class="ttdef"><b>Definition</b> <a href="Metadata_8cpp_source.html#l01402">Metadata.cpp:1402</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a5e6364c710de3afb5449588baab260fd"><div class="ttname"><a href="classllvm_1_1Instruction.html#a5e6364c710de3afb5449588baab260fd">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const</div><div class="ttdef"><b>Definition</b> <a href="IR_2Instruction_8h_source.html#l00094">Instruction.h:94</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a9247a212ea89acc9573fa7e7f557eaba"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">llvm::Instruction::setMetadata</a></div><div class="ttdeci">void setMetadata(unsigned KindID, MDNode *Node)</div><div class="ttdoc">Set the metadata of the specified kind to the specified node.</div><div class="ttdef"><b>Definition</b> <a href="Metadata_8cpp_source.html#l01317">Metadata.cpp:1317</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a944c50b4f5440b3914f5e2a157bb0fd3"><div class="ttname"><a href="classllvm_1_1Instruction.html#a944c50b4f5440b3914f5e2a157bb0fd3">llvm::Instruction::getSuccessor</a></div><div class="ttdeci">BasicBlock * getSuccessor(unsigned Idx) const</div><div class="ttdoc">Return the specified successor. This instruction must be a terminator.</div><div class="ttdef"><b>Definition</b> <a href="IR_2Instruction_8cpp_source.html#l00708">Instruction.cpp:708</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ad449a11cc9b14b0ac93bd61bd0bd9293"><div class="ttname"><a href="classllvm_1_1Instruction.html#ad449a11cc9b14b0ac93bd61bd0bd9293">llvm::Instruction::getNumSuccessors</a></div><div class="ttdeci">unsigned getNumSuccessors() const</div><div class="ttdoc">Return the number of successors that this instruction has.</div><div class="ttdef"><b>Definition</b> <a href="IR_2Instruction_8cpp_source.html#l00696">Instruction.cpp:696</a></div></div>
<div class="ttc" id="aclassllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdoc">This is an important class for using LLVM in a threaded context.</div><div class="ttdef"><b>Definition</b> <a href="LLVMContext_8h_source.html#l00068">LLVMContext.h:68</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopBase_html_a4a75755081e9a3803d2f4ccf6f0cb1f8"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a4a75755081e9a3803d2f4ccf6f0cb1f8">llvm::LoopBase::getHeader</a></div><div class="ttdeci">BlockT * getHeader() const</div><div class="ttdef"><b>Definition</b> <a href="LoopInfo_8h_source.html#l00104">LoopInfo.h:104</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopInfo_html"><div class="ttname"><a href="classllvm_1_1LoopInfo.html">llvm::LoopInfo</a></div><div class="ttdef"><b>Definition</b> <a href="LoopInfo_8h_source.html#l01079">LoopInfo.h:1079</a></div></div>
<div class="ttc" id="aclassllvm_1_1Loop_html"><div class="ttname"><a href="classllvm_1_1Loop.html">llvm::Loop</a></div><div class="ttdoc">Represents a single loop in the control flow graph.</div><div class="ttdef"><b>Definition</b> <a href="LoopInfo_8h_source.html#l00529">LoopInfo.h:529</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDBuilder_html"><div class="ttname"><a href="classllvm_1_1MDBuilder.html">llvm::MDBuilder</a></div><div class="ttdef"><b>Definition</b> <a href="MDBuilder_8h_source.html#l00035">MDBuilder.h:35</a></div></div>
<div class="ttc" id="aclassllvm_1_1ModulePass_html"><div class="ttname"><a href="classllvm_1_1ModulePass.html">llvm::ModulePass</a></div><div class="ttdoc">ModulePass class - This class is used to implement unstructured interprocedural optimizations and ana...</div><div class="ttdef"><b>Definition</b> <a href="Pass_8h_source.html#l00238">Pass.h:238</a></div></div>
<div class="ttc" id="aclassllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">A Module instance is used to store all the information related to an LLVM module.</div><div class="ttdef"><b>Definition</b> <a href="Module_8h_source.html#l00067">Module.h:67</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemarkAnalysis_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemarkAnalysis.html">llvm::OptimizationRemarkAnalysis</a></div><div class="ttdoc">Diagnostic information for optimization analysis remarks.</div><div class="ttdef"><b>Definition</b> <a href="DiagnosticInfo_8h_source.html#l00769">DiagnosticInfo.h:769</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemarkEmitterAnalysis_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemarkEmitterAnalysis.html">llvm::OptimizationRemarkEmitterAnalysis</a></div><div class="ttdef"><b>Definition</b> <a href="OptimizationRemarkEmitter_8h_source.html#l00156">OptimizationRemarkEmitter.h:157</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemarkEmitter_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemarkEmitter.html">llvm::OptimizationRemarkEmitter</a></div><div class="ttdoc">The optimization diagnostic interface.</div><div class="ttdef"><b>Definition</b> <a href="OptimizationRemarkEmitter_8h_source.html#l00033">OptimizationRemarkEmitter.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemarkEmitter_html_aae6a98aea85aa3af87357cc5448db499"><div class="ttname"><a href="classllvm_1_1OptimizationRemarkEmitter.html#aae6a98aea85aa3af87357cc5448db499">llvm::OptimizationRemarkEmitter::emit</a></div><div class="ttdeci">void emit(DiagnosticInfoOptimizationBase &amp;OptDiag)</div><div class="ttdoc">Output the remark via the diagnostic handler and to the optimization record file.</div><div class="ttdef"><b>Definition</b> <a href="OptimizationRemarkEmitter_8cpp_source.html#l00077">OptimizationRemarkEmitter.cpp:77</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemark_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemark.html">llvm::OptimizationRemark</a></div><div class="ttdoc">Diagnostic information for applied optimization remarks.</div><div class="ttdef"><b>Definition</b> <a href="DiagnosticInfo_8h_source.html#l00683">DiagnosticInfo.h:683</a></div></div>
<div class="ttc" id="aclassllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdoc">getPassRegistry - Access the global registry object, which is automatically initialized at applicatio...</div><div class="ttdef"><b>Definition</b> <a href="PassRegistry_8cpp_source.html#l00031">PassRegistry.cpp:31</a></div></div>
<div class="ttc" id="aclassllvm_1_1PostDominatorTree_html"><div class="ttname"><a href="classllvm_1_1PostDominatorTree.html">llvm::PostDominatorTree</a></div><div class="ttdoc">PostDominatorTree Class - Concrete subclass of DominatorTree that is used to compute the post-dominat...</div><div class="ttdef"><b>Definition</b> <a href="PostDominators_8h_source.html#l00028">PostDominators.h:28</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html">llvm::PreservedAnalyses</a></div><div class="ttdoc">A set of analyses that are preserved following a run of a transformation pass.</div><div class="ttdef"><b>Definition</b> <a href="PassManager_8h_source.html#l00155">PassManager.h:155</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a03797a73044a81cbc6a3409d6c72ee8f"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a03797a73044a81cbc6a3409d6c72ee8f">llvm::PreservedAnalyses::none</a></div><div class="ttdeci">static PreservedAnalyses none()</div><div class="ttdoc">Convenience factory function for the empty preserved set.</div><div class="ttdef"><b>Definition</b> <a href="PassManager_8h_source.html#l00158">PassManager.h:158</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a1258a1ff55557c27684010ebd7283712"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">llvm::PreservedAnalyses::all</a></div><div class="ttdeci">static PreservedAnalyses all()</div><div class="ttdoc">Construct a special preserved set that preserves all passes.</div><div class="ttdef"><b>Definition</b> <a href="PassManager_8h_source.html#l00161">PassManager.h:161</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryAnalysis_html"><div class="ttname"><a href="classllvm_1_1ProfileSummaryAnalysis.html">llvm::ProfileSummaryAnalysis</a></div><div class="ttdoc">An analysis pass based on the new PM to deliver ProfileSummaryInfo.</div><div class="ttdef"><b>Definition</b> <a href="ProfileSummaryInfo_8h_source.html#l00204">ProfileSummaryInfo.h:205</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfoWrapperPass.html">llvm::ProfileSummaryInfoWrapperPass</a></div><div class="ttdoc">An analysis pass based on legacy pass manager to deliver ProfileSummaryInfo.</div><div class="ttdef"><b>Definition</b> <a href="ProfileSummaryInfo_8h_source.html#l00186">ProfileSummaryInfo.h:186</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html">llvm::ProfileSummaryInfo</a></div><div class="ttdoc">Analysis providing profile information.</div><div class="ttdef"><b>Definition</b> <a href="ProfileSummaryInfo_8h_source.html#l00039">ProfileSummaryInfo.h:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html_a2600478d8188a85a14af8787024e1831"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html#a2600478d8188a85a14af8787024e1831">llvm::ProfileSummaryInfo::refresh</a></div><div class="ttdeci">void refresh()</div><div class="ttdoc">If no summary is present, attempt to refresh.</div><div class="ttdef"><b>Definition</b> <a href="ProfileSummaryInfo_8cpp_source.html#l00094">ProfileSummaryInfo.cpp:94</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html_a5f58eb949321536363605ac9920a95cb"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html#a5f58eb949321536363605ac9920a95cb">llvm::ProfileSummaryInfo::isColdCount</a></div><div class="ttdeci">bool isColdCount(uint64_t C) const</div><div class="ttdoc">Returns true if count C is considered cold.</div><div class="ttdef"><b>Definition</b> <a href="ProfileSummaryInfo_8cpp_source.html#l00334">ProfileSummaryInfo.cpp:334</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html_abd23a0c84ddc290f08599b62968af701"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html#abd23a0c84ddc290f08599b62968af701">llvm::ProfileSummaryInfo::getHotCountThreshold</a></div><div class="ttdeci">uint64_t getHotCountThreshold() const</div><div class="ttdoc">Returns HotCountThreshold if set.</div><div class="ttdef"><b>Definition</b> <a href="ProfileSummaryInfo_8h_source.html#l00165">ProfileSummaryInfo.h:165</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html_ac46d4d55dd867977ba88d57a170e31de"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html#ac46d4d55dd867977ba88d57a170e31de">llvm::ProfileSummaryInfo::isHotCount</a></div><div class="ttdeci">bool isHotCount(uint64_t C) const</div><div class="ttdoc">Returns true if count C is considered hot.</div><div class="ttdef"><b>Definition</b> <a href="ProfileSummaryInfo_8cpp_source.html#l00330">ProfileSummaryInfo.cpp:330</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html_ae48ebfb8f85e9b59325d20cdc9299f0e"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html#ae48ebfb8f85e9b59325d20cdc9299f0e">llvm::ProfileSummaryInfo::getOrCompHotCountThreshold</a></div><div class="ttdeci">uint64_t getOrCompHotCountThreshold() const</div><div class="ttdoc">Returns HotCountThreshold if set.</div><div class="ttdef"><b>Definition</b> <a href="ProfileSummaryInfo_8cpp_source.html#l00358">ProfileSummaryInfo.cpp:358</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummary_html_a59f76c736c482a9d03fbb0f5c42b3992"><div class="ttname"><a href="classllvm_1_1ProfileSummary.html#a59f76c736c482a9d03fbb0f5c42b3992">llvm::ProfileSummary::getMD</a></div><div class="ttdeci">Metadata * getMD(LLVMContext &amp;Context, bool AddPartialField=true, bool AddPartialProfileRatioField=true)</div><div class="ttdoc">Return summary information as metadata.</div><div class="ttdef"><b>Definition</b> <a href="ProfileSummary_8cpp_source.html#l00081">ProfileSummary.cpp:81</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummary_html_aa5aa682b3904e88749fa973b3da370c2a0c86eaeebf5b6120b601ecc93a1c2e3a"><div class="ttname"><a href="classllvm_1_1ProfileSummary.html#aa5aa682b3904e88749fa973b3da370c2a0c86eaeebf5b6120b601ecc93a1c2e3a">llvm::ProfileSummary::PSK_Sample</a></div><div class="ttdeci">@ PSK_Sample</div><div class="ttdef"><b>Definition</b> <a href="ProfileSummary_8h_source.html#l00047">ProfileSummary.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1SampleProfileLoaderPass_html_a324d3696b255beea7cfd1e8b901b2363"><div class="ttname"><a href="classllvm_1_1SampleProfileLoaderPass.html#a324d3696b255beea7cfd1e8b901b2363">llvm::SampleProfileLoaderPass::run</a></div><div class="ttdeci">PreservedAnalyses run(Module &amp;M, ModuleAnalysisManager &amp;AM)</div><div class="ttdef"><b>Definition</b> <a href="#l02663">SampleProfile.cpp:2663</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringMap_html"><div class="ttname"><a href="classllvm_1_1StringMap.html">llvm::StringMap&lt; uint64_t &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringMap_html_a132b998e118193914fa4e2b694005b2c"><div class="ttname"><a href="classllvm_1_1StringMap.html#a132b998e118193914fa4e2b694005b2c">llvm::StringMap::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition</b> <a href="StringMap_8h_source.html#l00333">StringMap.h:333</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringMap_html_a9846bb2bc5672e7627011260772b8d09"><div class="ttname"><a href="classllvm_1_1StringMap.html#a9846bb2bc5672e7627011260772b8d09">llvm::StringMap::count</a></div><div class="ttdeci">size_type count(StringRef Key) const</div><div class="ttdoc">count - Return 1 if the element is in the map, 0 otherwise.</div><div class="ttdef"><b>Definition</b> <a href="StringMap_8h_source.html#l00246">StringMap.h:246</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdoc">StringRef - Represent a constant reference to a string, i.e.</div><div class="ttdef"><b>Definition</b> <a href="StringRef_8h_source.html#l00057">StringRef.h:57</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html_ad0f54a163ac500b144590640c6f1eb6b"><div class="ttname"><a href="classllvm_1_1StringRef.html#ad0f54a163ac500b144590640c6f1eb6b">llvm::StringRef::npos</a></div><div class="ttdeci">static constexpr size_t npos</div><div class="ttdef"><b>Definition</b> <a href="StringRef_8h_source.html#l00059">StringRef.h:59</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringSet_html_add93efa62e06c599f1734f3b206232a0"><div class="ttname"><a href="classllvm_1_1StringSet.html#add93efa62e06c599f1734f3b206232a0">llvm::StringSet::insert</a></div><div class="ttdeci">std::pair&lt; typename Base::iterator, bool &gt; insert(StringRef key)</div><div class="ttdef"><b>Definition</b> <a href="StringSet_8h_source.html#l00033">StringSet.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetIRAnalysis_html"><div class="ttname"><a href="classllvm_1_1TargetIRAnalysis.html">llvm::TargetIRAnalysis</a></div><div class="ttdoc">Analysis pass providing the TargetTransformInfo.</div><div class="ttdef"><b>Definition</b> <a href="TargetTransformInfo_8h_source.html#l02231">TargetTransformInfo.h:2231</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryAnalysis_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryAnalysis.html">llvm::TargetLibraryAnalysis</a></div><div class="ttdoc">Analysis pass providing the TargetLibraryInfo.</div><div class="ttdef"><b>Definition</b> <a href="TargetLibraryInfo_8h_source.html#l00426">TargetLibraryInfo.h:426</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfoWrapperPass.html">llvm::TargetLibraryInfoWrapperPass</a></div><div class="ttdef"><b>Definition</b> <a href="TargetLibraryInfo_8h_source.html#l00451">TargetLibraryInfo.h:451</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryInfo_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfo.html">llvm::TargetLibraryInfo</a></div><div class="ttdoc">Provides information about what library functions are available for the current target.</div><div class="ttdef"><b>Definition</b> <a href="TargetLibraryInfo_8h_source.html#l00213">TargetLibraryInfo.h:213</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfoWrapperPass.html">llvm::TargetTransformInfoWrapperPass</a></div><div class="ttdoc">Wrapper pass for TargetTransformInfo.</div><div class="ttdef"><b>Definition</b> <a href="TargetTransformInfo_8h_source.html#l02287">TargetTransformInfo.h:2287</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html">llvm::TargetTransformInfo</a></div><div class="ttdoc">This pass provides access to the codegen interfaces that are needed for IR-level transformations.</div><div class="ttdef"><b>Definition</b> <a href="TargetTransformInfo_8h_source.html#l00178">TargetTransformInfo.h:178</a></div></div>
<div class="ttc" id="aclassllvm_1_1Target_html"><div class="ttname"><a href="classllvm_1_1Target.html">llvm::Target</a></div><div class="ttdoc">Target - Wrapper for Target specific information.</div><div class="ttdef"><b>Definition</b> <a href="TargetRegistry_8h_source.html#l00124">TargetRegistry.h:124</a></div></div>
<div class="ttc" id="aclassllvm_1_1Twine_html"><div class="ttname"><a href="classllvm_1_1Twine.html">llvm::Twine</a></div><div class="ttdoc">Twine - A lightweight data structure for efficiently representing the concatenation of temporary valu...</div><div class="ttdef"><b>Definition</b> <a href="Twine_8h_source.html#l00080">Twine.h:80</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_adb5c319f5905c1d3ca9eb5df546388c5"><div class="ttname"><a href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const</div><div class="ttdoc">Return a constant reference to the value's name.</div><div class="ttdef"><b>Definition</b> <a href="Value_8cpp_source.html#l00295">Value.cpp:295</a></div></div>
<div class="ttc" id="aclassllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt</a></div><div class="ttdef"><b>Definition</b> <a href="CommandLine_8h_source.html#l01419">CommandLine.h:1421</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__impl_html"><div class="ttname"><a href="classllvm_1_1ilist__node__impl.html">llvm::ilist_node_impl</a></div><div class="ttdoc">Implementation for an ilist node.</div><div class="ttdef"><b>Definition</b> <a href="ilist__node_8h_source.html#l00039">ilist_node.h:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1raw__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__ostream.html">llvm::raw_ostream</a></div><div class="ttdoc">This class implements an extremely fast bulk output stream that can only output to a stream.</div><div class="ttdef"><b>Definition</b> <a href="raw__ostream_8h_source.html#l00050">raw_ostream.h:50</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1FunctionSamples_html"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1FunctionSamples.html">llvm::sampleprof::FunctionSamples</a></div><div class="ttdoc">Representation of the samples collected for a function.</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00523">SampleProf.h:523</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1FunctionSamples_html_a2b2898e95dd1947ace149447cb9ef137"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1FunctionSamples.html#a2b2898e95dd1947ace149447cb9ef137">llvm::sampleprof::FunctionSamples::getGUID</a></div><div class="ttdeci">static uint64_t getGUID(StringRef Name)</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00868">SampleProf.h:868</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1FunctionSamples_html_a67e19eb484a5eaa31b22894398e258c0"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1FunctionSamples.html#a67e19eb484a5eaa31b22894398e258c0">llvm::sampleprof::FunctionSamples::ProfileIsCS</a></div><div class="ttdeci">static bool ProfileIsCS</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00850">SampleProf.h:850</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1FunctionSamples_html_aa37fe7429ffcf70c306c27a55d714d31"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa37fe7429ffcf70c306c27a55d714d31">llvm::sampleprof::FunctionSamples::ProfileIsProbeBased</a></div><div class="ttdeci">static bool ProfileIsProbeBased</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00848">SampleProf.h:848</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1FunctionSamples_html_aa7122a07ea48e47fc71083e68b829003"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa7122a07ea48e47fc71083e68b829003">llvm::sampleprof::FunctionSamples::getCanonicalFnName</a></div><div class="ttdeci">static StringRef getCanonicalFnName(const Function &amp;F)</div><div class="ttdoc">Return the canonical name for a function, taking into account suffix elision policy attributes.</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00778">SampleProf.h:778</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1FunctionSamples_html_aa9a46c80625ff1813b321b3a1d46ee37"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aa9a46c80625ff1813b321b3a1d46ee37">llvm::sampleprof::FunctionSamples::getFuncName</a></div><div class="ttdeci">StringRef getFuncName() const</div><div class="ttdoc">Return the original function name.</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00770">SampleProf.h:770</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1FunctionSamples_html_aac9d9812a5a2e1902e92b485bbf6819b"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1FunctionSamples.html#aac9d9812a5a2e1902e92b485bbf6819b">llvm::sampleprof::FunctionSamples::getEntrySamples</a></div><div class="ttdeci">uint64_t getEntrySamples() const</div><div class="ttdoc">Return the sample count of the first instruction of the function.</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00645">SampleProf.h:645</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1FunctionSamples_html_ab6f00f222e6f6d30bc6a0fc7bf8396de"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1FunctionSamples.html#ab6f00f222e6f6d30bc6a0fc7bf8396de">llvm::sampleprof::FunctionSamples::getOffset</a></div><div class="ttdeci">static unsigned getOffset(const DILocation *DIL)</div><div class="ttdoc">Returns the line offset to the start line of the subprogram.</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8cpp_source.html#l00181">SampleProf.cpp:181</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1FunctionSamples_html_ad38ceb01e0a46ee074bf51d9fb136d8f"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1FunctionSamples.html#ad38ceb01e0a46ee074bf51d9fb136d8f">llvm::sampleprof::FunctionSamples::getCallSiteIdentifier</a></div><div class="ttdeci">static LineLocation getCallSiteIdentifier(const DILocation *DIL)</div><div class="ttdoc">Returns a unique call site identifier for a given debug location of a call instruction.</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8cpp_source.html#l00186">SampleProf.cpp:186</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1FunctionSamples_html_afb88e30fa94efb7c7f12c84b52b61b3d"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1FunctionSamples.html#afb88e30fa94efb7c7f12c84b52b61b3d">llvm::sampleprof::FunctionSamples::getName</a></div><div class="ttdeci">StringRef getName() const</div><div class="ttdoc">Return the function name.</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00760">SampleProf.h:760</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1FunctionSamples_html_afddaa81316d56f125de69793e0ddb33c"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1FunctionSamples.html#afddaa81316d56f125de69793e0ddb33c">llvm::sampleprof::FunctionSamples::UseMD5</a></div><div class="ttdeci">static bool UseMD5</div><div class="ttdoc">Whether the profile uses MD5 to represent string.</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00859">SampleProf.h:859</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html">llvm::sampleprof::SampleProfileReader</a></div><div class="ttdoc">Sample-based profile reader.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00339">SampleProfReader.h:339</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_a1f372a7784eaec8c761af0ed7c38b1b2"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a1f372a7784eaec8c761af0ed7c38b1b2">llvm::sampleprof::SampleProfileReader::profileIsProbeBased</a></div><div class="ttdeci">bool profileIsProbeBased() const</div><div class="ttdoc">Whether input profile is based on pseudo probes.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00437">SampleProfReader.h:437</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_a231496cee212bad0c2b9fa7877dc0cb4"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a231496cee212bad0c2b9fa7877dc0cb4">llvm::sampleprof::SampleProfileReader::getSamplesFor</a></div><div class="ttdeci">FunctionSamples * getSamplesFor(const Function &amp;F)</div><div class="ttdoc">Return the samples collected for function F.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00372">SampleProfReader.h:372</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_a241493be5796817782fda51d1b3fa61d"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a241493be5796817782fda51d1b3fa61d">llvm::sampleprof::SampleProfileReader::dump</a></div><div class="ttdeci">void dump(raw_ostream &amp;OS=dbgs())</div><div class="ttdoc">Print all the profiles on stream OS.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8cpp_source.html#l00057">SampleProfReader.cpp:57</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_a3af68fe6182b0855269ef3578910df4c"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a3af68fe6182b0855269ef3578910df4c">llvm::sampleprof::SampleProfileReader::getOrCreateSamplesFor</a></div><div class="ttdeci">FunctionSamples * getOrCreateSamplesFor(const Function &amp;F)</div><div class="ttdoc">Return the samples collected for function F, create empty FunctionSamples if it doesn't exist.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00382">SampleProfReader.h:382</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_a3bdbf84fa8e3f0e789653587d5c85515"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a3bdbf84fa8e3f0e789653587d5c85515">llvm::sampleprof::SampleProfileReader::read</a></div><div class="ttdeci">std::error_code read()</div><div class="ttdoc">The interface to read sample profiles from the associated file.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00351">SampleProfReader.h:351</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_a4a145ddd60f5f52607c969dc45c32c44"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a4a145ddd60f5f52607c969dc45c32c44">llvm::sampleprof::SampleProfileReader::collectFuncsFrom</a></div><div class="ttdeci">virtual void collectFuncsFrom(const Module &amp;M)</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00366">SampleProfReader.h:366</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_a530222c3b645acc9170003d046753e94"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a530222c3b645acc9170003d046753e94">llvm::sampleprof::SampleProfileReader::getRemapper</a></div><div class="ttdeci">SampleProfileReaderItaniumRemapper * getRemapper()</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00458">SampleProfReader.h:458</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_a6dd2d2051faff77f927c11a25a851b81"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a6dd2d2051faff77f927c11a25a851b81">llvm::sampleprof::SampleProfileReader::getNameTable</a></div><div class="ttdeci">virtual std::vector&lt; StringRef &gt; * getNameTable()</div><div class="ttdoc">It includes all the names that have samples either in outline instance or inline instance.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00448">SampleProfReader.h:448</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_a7870bf43f8e5b80b21caea5ea2e23977"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#a7870bf43f8e5b80b21caea5ea2e23977">llvm::sampleprof::SampleProfileReader::getSummary</a></div><div class="ttdeci">ProfileSummary &amp; getSummary() const</div><div class="ttdoc">Return the profile summary.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00429">SampleProfReader.h:429</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_aa2655664be73b6f594cded1339133884"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#aa2655664be73b6f594cded1339133884">llvm::sampleprof::SampleProfileReader::create</a></div><div class="ttdeci">static ErrorOr&lt; std::unique_ptr&lt; SampleProfileReader &gt; &gt; create(const std::string Filename, LLVMContext &amp;C, const std::string RemapFilename=&quot;&quot;)</div><div class="ttdoc">Create a sample profile reader appropriate to the file format.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8cpp_source.html#l01507">SampleProfReader.cpp:1507</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_ab2258ff0986bd6227697d76e9001406d"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#ab2258ff0986bd6227697d76e9001406d">llvm::sampleprof::SampleProfileReader::profileIsCS</a></div><div class="ttdeci">bool profileIsCS() const</div><div class="ttdoc">Whether input profile is fully context-sensitive.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00440">SampleProfReader.h:440</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_ac2c3cd528ebcb5fbe487fe9e0b3a9de6"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#ac2c3cd528ebcb5fbe487fe9e0b3a9de6">llvm::sampleprof::SampleProfileReader::setSkipFlatProf</a></div><div class="ttdeci">virtual void setSkipFlatProf(bool Skip)</div><div class="ttdoc">Don't read profile without context if the flag is set.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00456">SampleProfReader.h:456</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_ad952aa920c1dbb730341fc614a01403f"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#ad952aa920c1dbb730341fc614a01403f">llvm::sampleprof::SampleProfileReader::getProfiles</a></div><div class="ttdeci">StringMap&lt; FunctionSamples &gt; &amp; getProfiles()</div><div class="ttdoc">Return all the profiles.</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00408">SampleProfReader.h:408</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleProfileReader_html_af9976cd2d8ddf787f19d5dbca4530fa6"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleProfileReader.html#af9976cd2d8ddf787f19d5dbca4530fa6">llvm::sampleprof::SampleProfileReader::getProfileSymbolList</a></div><div class="ttdeci">virtual std::unique_ptr&lt; ProfileSymbolList &gt; getProfileSymbolList()</div><div class="ttdef"><b>Definition</b> <a href="SampleProfReader_8h_source.html#l00442">SampleProfReader.h:442</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleRecord_html_ab818a10bb93f9f5b08f1f85ed4733b3c"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleRecord.html#ab818a10bb93f9f5b08f1f85ed4733b3c">llvm::sampleprof::SampleRecord::SortCallTargets</a></div><div class="ttdeci">static const SortedCallTargetSet SortCallTargets(const CallTargetMap &amp;Targets)</div><div class="ttdoc">Sort call targets in descending order of call frequency.</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00342">SampleProf.h:342</a></div></div>
<div class="ttc" id="aclassllvm_1_1sampleprof_1_1SampleRecord_html_abfed1f1dfd251457d62aa20c4c4e95eb"><div class="ttname"><a href="classllvm_1_1sampleprof_1_1SampleRecord.html#abfed1f1dfd251457d62aa20c4c4e95eb">llvm::sampleprof::SampleRecord::adjustCallTargets</a></div><div class="ttdeci">static const CallTargetMap adjustCallTargets(const CallTargetMap &amp;Targets, float DistributionFactor)</div><div class="ttdoc">Prorate call targets by a distribution factor.</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00351">SampleProf.h:351</a></div></div>
<div class="ttc" id="aclassuint32__t_html"><div class="ttname"><a href="classuint32__t.html">uint32_t</a></div></div>
<div class="ttc" id="allvm_2Support_2ErrorHandling_8h_html"><div class="ttname"><a href="llvm_2Support_2ErrorHandling_8h.html">ErrorHandling.h</a></div></div>
<div class="ttc" id="allvm_2Support_2ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="llvm_2Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdoc">Marks that the current location is not supposed to be reachable.</div><div class="ttdef"><b>Definition</b> <a href="llvm_2Support_2ErrorHandling_8h_source.html#l00136">ErrorHandling.h:136</a></div></div>
<div class="ttc" id="allvm_2Transforms_2IPO_8h_html"><div class="ttname"><a href="llvm_2Transforms_2IPO_8h.html">IPO.h</a></div></div>
<div class="ttc" id="anamespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition</b> <a href="StackSlotColoring_8cpp_source.html#l00142">StackSlotColoring.cpp:142</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_a80add6b3b1cdaec560907995127adc16"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">llvm::Intrinsic::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdef"><b>Definition</b> <a href="TargetTransformInfo_8h_source.html#l00036">TargetTransformInfo.h:36</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RISCVFenceField_html_a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf"><div class="ttname"><a href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf">llvm::RISCVFenceField::W</a></div><div class="ttdeci">@ W</div><div class="ttdef"><b>Definition</b> <a href="RISCVBaseInfo_8h_source.html#l00132">RISCVBaseInfo.h:131</a></div></div>
<div class="ttc" id="anamespacellvm_1_1X86AS_html_a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f"><div class="ttname"><a href="namespacellvm_1_1X86AS.html#a7345d0410aa0e63d9320e8ecfadd4a99a5b3a782ccae295a254e2794ad30ad07f">llvm::X86AS::FS</a></div><div class="ttdeci">@ FS</div><div class="ttdef"><b>Definition</b> <a href="X86_8h_source.html#l00176">X86.h:176</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a492234b10e0c5918d72a3a15a6f0fa6ea61d3cb794533763159788c493ad266d9"><div class="ttname"><a href="namespacellvm_1_1cl.html#a492234b10e0c5918d72a3a15a6f0fa6ea61d3cb794533763159788c493ad266d9">llvm::cl::ZeroOrMore</a></div><div class="ttdeci">@ ZeroOrMore</div><div class="ttdef"><b>Definition</b> <a href="CommandLine_8h_source.html#l00117">CommandLine.h:117</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdeci">@ Hidden</div><div class="ttdef"><b>Definition</b> <a href="CommandLine_8h_source.html#l00140">CommandLine.h:140</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_ac12e6a8f3a1b511f0dee2ed6de0ae806"><div class="ttname"><a href="namespacellvm_1_1cl.html#ac12e6a8f3a1b511f0dee2ed6de0ae806">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition</b> <a href="CommandLine_8h_source.html#l00440">CommandLine.h:440</a></div></div>
<div class="ttc" id="anamespacellvm_1_1codeview_html_a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b"><div class="ttname"><a href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">llvm::codeview::CompileSym2Flags::EC</a></div><div class="ttdeci">@ EC</div></div>
<div class="ttc" id="anamespacellvm_1_1codeview_html_ad25a1310d512e19d2f6318e963dcb30bafc6d010fc5b3d8ff4400670e597c4e7b"><div class="ttname"><a href="namespacellvm_1_1codeview.html#ad25a1310d512e19d2f6318e963dcb30bafc6d010fc5b3d8ff4400670e597c4e7b">llvm::codeview::FrameProcedureOptions::Inlined</a></div><div class="ttdeci">@ Inlined</div></div>
<div class="ttc" id="anamespacellvm_1_1msgpack_html_afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c"><div class="ttname"><a href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">llvm::msgpack::Type::Map</a></div><div class="ttdeci">@ Map</div></div>
<div class="ttc" id="anamespacellvm_1_1orc_html_a6a31d56a05a94b79b1c5eb0b85ae0283"><div class="ttname"><a href="namespacellvm_1_1orc.html#a6a31d56a05a94b79b1c5eb0b85ae0283">llvm::orc::SymbolMap</a></div><div class="ttdeci">DenseMap&lt; SymbolStringPtr, JITEvaluatedSymbol &gt; SymbolMap</div><div class="ttdoc">A map from symbol names (as SymbolStringPtrs) to JITSymbols (address/flags pairs).</div><div class="ttdef"><b>Definition</b> <a href="llvm_2ExecutionEngine_2Orc_2Core_8h_source.html#l00110">Core.h:110</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ore_html_a5ca06dfbc998afac005414d8e9b7c234"><div class="ttname"><a href="namespacellvm_1_1ore.html#a5ca06dfbc998afac005414d8e9b7c234">llvm::ore::NV</a></div><div class="ttdeci">DiagnosticInfoOptimizationBase::Argument NV</div><div class="ttdef"><b>Definition</b> <a href="OptimizationRemarkEmitter_8h_source.html#l00128">OptimizationRemarkEmitter.h:128</a></div></div>
<div class="ttc" id="anamespacellvm_1_1pdb_html_a33e853ec74d48b1340d1d4bae772d30bad7a2c9c146ac9c6636e1a009ca1e9413"><div class="ttname"><a href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bad7a2c9c146ac9c6636e1a009ca1e9413">llvm::pdb::PDB_SymType::CallSite</a></div><div class="ttdeci">@ CallSite</div></div>
<div class="ttc" id="anamespacellvm_1_1pdb_html_a81a0fae24e6bdfe240da4249a8da5978a6a061313d22e51e0f25b7cd4dc065233"><div class="ttname"><a href="namespacellvm_1_1pdb.html#a81a0fae24e6bdfe240da4249a8da5978a6a061313d22e51e0f25b7cd4dc065233">llvm::pdb::DbgHeaderType::Max</a></div><div class="ttdeci">@ Max</div></div>
<div class="ttc" id="anamespacellvm_1_1pgo_html_ac3ab1f99a5d99ba23fcfec6044ebc805"><div class="ttname"><a href="namespacellvm_1_1pgo.html#ac3ab1f99a5d99ba23fcfec6044ebc805">llvm::pgo::promoteIndirectCall</a></div><div class="ttdeci">CallBase &amp; promoteIndirectCall(CallBase &amp;CB, Function *F, uint64_t Count, uint64_t TotalCount, bool AttachProfToDirectCall, OptimizationRemarkEmitter *ORE)</div><div class="ttdef"><b>Definition</b> <a href="IndirectCallPromotion_8cpp_source.html#l00303">IndirectCallPromotion.cpp:303</a></div></div>
<div class="ttc" id="anamespacellvm_1_1sampleprof_html_a659a52f7008b83957eb326a57a737cf9"><div class="ttname"><a href="namespacellvm_1_1sampleprof.html#a659a52f7008b83957eb326a57a737cf9">llvm::sampleprof::FunctionSamplesMap</a></div><div class="ttdeci">std::map&lt; std::string, FunctionSamples, std::less&lt;&gt; &gt; FunctionSamplesMap</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00515">SampleProf.h:515</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This class represents lattice values for constants.</div><div class="ttdef"><b>Definition</b> <a href="AllocatorList_8h_source.html#l00023">AllocatorList.h:23</a></div></div>
<div class="ttc" id="anamespacellvm_html_a00fba4013f1a5b882b91cad397791f9f"><div class="ttname"><a href="namespacellvm.html#a00fba4013f1a5b882b91cad397791f9f">llvm::extractProbe</a></div><div class="ttdeci">Optional&lt; PseudoProbe &gt; extractProbe(const Instruction &amp;Inst)</div><div class="ttdef"><b>Definition</b> <a href="PseudoProbe_8cpp_source.html#l00047">PseudoProbe.cpp:47</a></div></div>
<div class="ttc" id="anamespacellvm_html_a03503773241005f01b090b9862aad304"><div class="ttname"><a href="namespacellvm.html#a03503773241005f01b090b9862aad304">llvm::dump</a></div><div class="ttdeci">void dump(const SparseBitVector&lt; ElementSize &gt; &amp;LHS, raw_ostream &amp;out)</div><div class="ttdef"><b>Definition</b> <a href="SparseBitVector_8h_source.html#l00876">SparseBitVector.h:876</a></div></div>
<div class="ttc" id="anamespacellvm_html_a069c4ae2290101bde0f8d6a5074dc72b"><div class="ttname"><a href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">llvm::succ_end</a></div><div class="ttdeci">Interval::succ_iterator succ_end(Interval *I)</div><div class="ttdef"><b>Definition</b> <a href="Interval_8h_source.html#l00102">Interval.h:102</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0e5b9e42ea84622605acea0b0d721fda"><div class="ttname"><a href="namespacellvm.html#a0e5b9e42ea84622605acea0b0d721fda">llvm::isLegalToPromote</a></div><div class="ttdeci">bool isLegalToPromote(const CallBase &amp;CB, Function *Callee, const char **FailureReason=nullptr)</div><div class="ttdoc">Return true if the given indirect call site can be made to call Callee.</div><div class="ttdef"><b>Definition</b> <a href="CallPromotionUtils_8cpp_source.html#l00382">CallPromotionUtils.cpp:382</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2554a96c67bdd7d0a62855a844ec55b0a92b09c7c48c520c3c55e497875da437c"><div class="ttname"><a href="namespacellvm.html#a2554a96c67bdd7d0a62855a844ec55b0a92b09c7c48c520c3c55e497875da437c">llvm::AlignStyle::Right</a></div><div class="ttdeci">@ Right</div></div>
<div class="ttc" id="anamespacellvm_html_a2554a96c67bdd7d0a62855a844ec55b0a945d5e233cf7d6240f6b783b36a374ff"><div class="ttname"><a href="namespacellvm.html#a2554a96c67bdd7d0a62855a844ec55b0a945d5e233cf7d6240f6b783b36a374ff">llvm::AlignStyle::Left</a></div><div class="ttdeci">@ Left</div></div>
<div class="ttc" id="anamespacellvm_html_a2f18b256797f90ed7933e51e26fa6505"><div class="ttname"><a href="namespacellvm.html#a2f18b256797f90ed7933e51e26fa6505">llvm::createSampleProfileLoaderPass</a></div><div class="ttdeci">ModulePass * createSampleProfileLoaderPass()</div><div class="ttdef"><b>Definition</b> <a href="#l02518">SampleProfile.cpp:2518</a></div></div>
<div class="ttc" id="anamespacellvm_html_a3720211f6e6389ab53734b989bfb6fce"><div class="ttname"><a href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">llvm::succ_begin</a></div><div class="ttdeci">Interval::succ_iterator succ_begin(Interval *I)</div><div class="ttdoc">succ_begin/succ_end - define methods so that Intervals may be used just like BasicBlocks can with the...</div><div class="ttdef"><b>Definition</b> <a href="Interval_8h_source.html#l00099">Interval.h:99</a></div></div>
<div class="ttc" id="anamespacellvm_html_a3c1a67796e24a843db8a6766baa54c21"><div class="ttname"><a href="namespacellvm.html#a3c1a67796e24a843db8a6766baa54c21">llvm::scc_begin</a></div><div class="ttdeci">scc_iterator&lt; T &gt; scc_begin(const T &amp;G)</div><div class="ttdoc">Construct the begin iterator for a deduced graph type T.</div><div class="ttdef"><b>Definition</b> <a href="SCCIterator_8h_source.html#l00228">SCCIterator.h:228</a></div></div>
<div class="ttc" id="anamespacellvm_html_a469101ea87b8b432a1b4f7935c97f35c"><div class="ttname"><a href="namespacellvm.html#a469101ea87b8b432a1b4f7935c97f35c">llvm::reverse</a></div><div class="ttdeci">auto reverse(ContainerTy &amp;&amp;C, std::enable_if_t&lt; has_rbegin&lt; ContainerTy &gt;::value &gt; *=nullptr)</div><div class="ttdef"><b>Definition</b> <a href="STLExtras_8h_source.html#l00338">STLExtras.h:338</a></div></div>
<div class="ttc" id="anamespacellvm_html_a4fb32c986b105bb7a53700e5988aab6e"><div class="ttname"><a href="namespacellvm.html#a4fb32c986b105bb7a53700e5988aab6e">llvm::setProbeDistributionFactor</a></div><div class="ttdeci">void setProbeDistributionFactor(Instruction &amp;Inst, float Factor)</div><div class="ttdef"><b>Definition</b> <a href="PseudoProbe_8cpp_source.html#l00064">PseudoProbe.cpp:64</a></div></div>
<div class="ttc" id="anamespacellvm_html_a5d737fb4258bb27586a1bffd557fbb49"><div class="ttname"><a href="namespacellvm.html#a5d737fb4258bb27586a1bffd557fbb49">llvm::ThinOrFullLTOPhase</a></div><div class="ttdeci">ThinOrFullLTOPhase</div><div class="ttdoc">This enumerates the LLVM full LTO or ThinLTO optimization phases.</div><div class="ttdef"><b>Definition</b> <a href="Pass_8h_source.html#l00073">Pass.h:73</a></div></div>
<div class="ttc" id="anamespacellvm_html_a5eeaf08e96168c2cac8960f87f0ef360"><div class="ttname"><a href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">llvm::pred_end</a></div><div class="ttdeci">Interval::pred_iterator pred_end(Interval *I)</div><div class="ttdef"><b>Definition</b> <a href="Interval_8h_source.html#l00112">Interval.h:112</a></div></div>
<div class="ttc" id="anamespacellvm_html_a5f5f248d08aa55c63e5bc7a8304a7319"><div class="ttname"><a href="namespacellvm.html#a5f5f248d08aa55c63e5bc7a8304a7319">llvm::getInlineCost</a></div><div class="ttdeci">InlineCost getInlineCost(CallBase &amp;Call, const InlineParams &amp;Params, TargetTransformInfo &amp;CalleeTTI, function_ref&lt; AssumptionCache &amp;(Function &amp;)&gt; GetAssumptionCache, function_ref&lt; const TargetLibraryInfo &amp;(Function &amp;)&gt; GetTLI, function_ref&lt; BlockFrequencyInfo &amp;(Function &amp;)&gt; GetBFI=nullptr, ProfileSummaryInfo *PSI=nullptr, OptimizationRemarkEmitter *ORE=nullptr)</div><div class="ttdoc">Get an InlineCost object representing the cost of inlining this callsite.</div><div class="ttdef"><b>Definition</b> <a href="InlineCost_8cpp_source.html#l02472">InlineCost.cpp:2472</a></div></div>
<div class="ttc" id="anamespacellvm_html_a68ee9c22fcc77e40d4ae44e5b37c7998"><div class="ttname"><a href="namespacellvm.html#a68ee9c22fcc77e40d4ae44e5b37c7998">llvm::annotateValueSite</a></div><div class="ttdeci">void annotateValueSite(Module &amp;M, Instruction &amp;Inst, const InstrProfRecord &amp;InstrProfR, InstrProfValueKind ValueKind, uint32_t SiteIndx, uint32_t MaxMDCount=3)</div><div class="ttdoc">Get the value profile data for value site SiteIdx from InstrProfR and annotate the instruction Inst w...</div><div class="ttdef"><b>Definition</b> <a href="InstrProf_8cpp_source.html#l00936">InstrProf.cpp:936</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs() - This returns a reference to a raw_ostream for debugging messages.</div><div class="ttdef"><b>Definition</b> <a href="Debug_8cpp_source.html#l00132">Debug.cpp:132</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7e108932dc3da5294aed99a353aac9c4"><div class="ttname"><a href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">llvm::pred_begin</a></div><div class="ttdeci">Interval::pred_iterator pred_begin(Interval *I)</div><div class="ttdoc">pred_begin/pred_end - define methods so that Intervals may be used just like BasicBlocks can with the...</div><div class="ttdef"><b>Definition</b> <a href="Interval_8h_source.html#l00109">Interval.h:109</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7e39b6f753eab4236840973d7f6ddbfe"><div class="ttname"><a href="namespacellvm.html#a7e39b6f753eab4236840973d7f6ddbfe">llvm::InlineFunction</a></div><div class="ttdeci">InlineResult InlineFunction(CallBase &amp;CB, InlineFunctionInfo &amp;IFI, AAResults *CalleeAAR=nullptr, bool InsertLifetime=true, Function *ForwardVarArgsTo=nullptr)</div><div class="ttdoc">This function inlines the called function into the basic block of the caller.</div><div class="ttdef"><b>Definition</b> <a href="InlineFunction_8cpp_source.html#l01661">InlineFunction.cpp:1661</a></div></div>
<div class="ttc" id="anamespacellvm_html_a824f3e0d9eb261d9345fcc96b36852f5"><div class="ttname"><a href="namespacellvm.html#a824f3e0d9eb261d9345fcc96b36852f5">llvm::empty</a></div><div class="ttdeci">constexpr bool empty(const T &amp;RangeOrContainer)</div><div class="ttdoc">Test whether RangeOrContainer is empty. Similar to C++17 std::empty.</div><div class="ttdef"><b>Definition</b> <a href="STLExtras_8h_source.html#l00263">STLExtras.h:263</a></div></div>
<div class="ttc" id="anamespacellvm_html_a830041552b81a6cea1f497490d0f41d9"><div class="ttname"><a href="namespacellvm.html#a830041552b81a6cea1f497490d0f41d9">llvm::sort</a></div><div class="ttdeci">void sort(IteratorTy Start, IteratorTy End)</div><div class="ttdef"><b>Definition</b> <a href="STLExtras_8h_source.html#l01439">STLExtras.h:1439</a></div></div>
<div class="ttc" id="anamespacellvm_html_a900f3a78adcdae820536c776900726fc"><div class="ttname"><a href="namespacellvm.html#a900f3a78adcdae820536c776900726fc">llvm::emitInlinedInto</a></div><div class="ttdeci">void emitInlinedInto(OptimizationRemarkEmitter &amp;ORE, DebugLoc DLoc, const BasicBlock *Block, const Function &amp;Callee, const Function &amp;Caller, const InlineCost &amp;IC, bool ForProfileContext=false, const char *PassName=nullptr)</div><div class="ttdoc">Emit ORE message.</div><div class="ttdef"><b>Definition</b> <a href="InlineAdvisor_8cpp_source.html#l00436">InlineAdvisor.cpp:436</a></div></div>
<div class="ttc" id="anamespacellvm_html_a939bc2108d47080767f0c06ba56caec7"><div class="ttname"><a href="namespacellvm.html#a939bc2108d47080767f0c06ba56caec7">llvm::format</a></div><div class="ttdeci">format_object&lt; Ts... &gt; format(const char *Fmt, const Ts &amp;... Vals)</div><div class="ttdoc">These are helper functions used to produce formatted output.</div><div class="ttdef"><b>Definition</b> <a href="Format_8h_source.html#l00124">Format.h:124</a></div></div>
<div class="ttc" id="anamespacellvm_html_aba7063dea024346c7b70099c63703f50"><div class="ttname"><a href="namespacellvm.html#aba7063dea024346c7b70099c63703f50">llvm::getInlineParams</a></div><div class="ttdeci">InlineParams getInlineParams()</div><div class="ttdoc">Generate the parameters to tune the inline cost analysis based only on the commandline options.</div><div class="ttdef"><b>Definition</b> <a href="InlineCost_8cpp_source.html#l02732">InlineCost.cpp:2732</a></div></div>
<div class="ttc" id="anamespacellvm_html_abfc9c7ecf70f66901e439f7c04ef3dbb"><div class="ttname"><a href="namespacellvm.html#abfc9c7ecf70f66901e439f7c04ef3dbb">llvm::move</a></div><div class="ttdeci">OutputIt move(R &amp;&amp;Range, OutputIt Out)</div><div class="ttdoc">Provide wrappers to std::move which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition</b> <a href="STLExtras_8h_source.html#l01556">STLExtras.h:1556</a></div></div>
<div class="ttc" id="anamespacellvm_html_abfcab32516704f11d146c757f402ad5ca1cde8c8828756cdaf2a93260e247ae31"><div class="ttname"><a href="namespacellvm.html#abfcab32516704f11d146c757f402ad5ca1cde8c8828756cdaf2a93260e247ae31">llvm::DS_Warning</a></div><div class="ttdeci">@ DS_Warning</div><div class="ttdef"><b>Definition</b> <a href="DiagnosticInfo_8h_source.html#l00046">DiagnosticInfo.h:46</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6"><div class="ttname"><a href="namespacellvm.html#ac226f3d2b9ca090171a8e0a8cb92c343a91921ada405fd6ba65dff028df047cb6">llvm::HighlightColor::Remark</a></div><div class="ttdeci">@ Remark</div></div>
<div class="ttc" id="anamespacellvm_html_ad579b1aaccc266c26012224c61ce29da"><div class="ttname"><a href="namespacellvm.html#ad579b1aaccc266c26012224c61ce29da">llvm::initializeSampleProfileLoaderLegacyPassPass</a></div><div class="ttdeci">void initializeSampleProfileLoaderLegacyPassPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="anamespacellvm_html_af0b7d20135171ab4df56bb70fe0d9dca"><div class="ttname"><a href="namespacellvm.html#af0b7d20135171ab4df56bb70fe0d9dca">llvm::updateProfileCallee</a></div><div class="ttdeci">void updateProfileCallee(Function *Callee, int64_t entryDelta, const ValueMap&lt; const Value *, WeakTrackingVH &gt; *VMap=nullptr)</div><div class="ttdoc">Updates profile information by adjusting the entry count by adding entryDelta then scaling callsite i...</div><div class="ttdef"><b>Definition</b> <a href="InlineFunction_8cpp_source.html#l01615">InlineFunction.cpp:1615</a></div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition</b> <a href="BitVector_8h_source.html#l00941">BitVector.h:941</a></div></div>
<div class="ttc" id="araw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="astructllvm_1_1DiagnosticInfoOptimizationBase_1_1Argument_html"><div class="ttname"><a href="structllvm_1_1DiagnosticInfoOptimizationBase_1_1Argument.html">llvm::DiagnosticInfoOptimizationBase::Argument</a></div><div class="ttdoc">Used in the streaming interface as the general argument type.</div><div class="ttdef"><b>Definition</b> <a href="DiagnosticInfo_8h_source.html#l00420">DiagnosticInfo.h:420</a></div></div>
<div class="ttc" id="astructllvm_1_1InlineParams_html"><div class="ttname"><a href="structllvm_1_1InlineParams.html">llvm::InlineParams</a></div><div class="ttdoc">Thresholds to tune inline cost analysis.</div><div class="ttdef"><b>Definition</b> <a href="InlineCost_8h_source.html#l00160">InlineCost.h:160</a></div></div>
<div class="ttc" id="astructllvm_1_1InlineParams_html_afbfdb6bed9436fc13b4df5ac67f8b9f7"><div class="ttname"><a href="structllvm_1_1InlineParams.html#afbfdb6bed9436fc13b4df5ac67f8b9f7">llvm::InlineParams::ComputeFullInlineCost</a></div><div class="ttdeci">Optional&lt; bool &gt; ComputeFullInlineCost</div><div class="ttdoc">Compute inline cost even when the cost has exceeded the threshold.</div><div class="ttdef"><b>Definition</b> <a href="InlineCost_8h_source.html#l00187">InlineCost.h:187</a></div></div>
<div class="ttc" id="astructllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition</b> <a href="CommandLine_8h_source.html#l00411">CommandLine.h:411</a></div></div>
<div class="ttc" id="astructllvm_1_1cl_1_1value__desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1value__desc.html">llvm::cl::value_desc</a></div><div class="ttdef"><b>Definition</b> <a href="CommandLine_8h_source.html#l00421">CommandLine.h:421</a></div></div>
<div class="ttc" id="astructllvm_1_1sampleprof_1_1LineLocation_html"><div class="ttname"><a href="structllvm_1_1sampleprof_1_1LineLocation.html">llvm::sampleprof::LineLocation</a></div><div class="ttdoc">Represents the relative location of an instruction.</div><div class="ttdef"><b>Definition</b> <a href="SampleProf_8h_source.html#l00254">SampleProf.h:254</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Feb 20 2024 14:04:20 for LLVM by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
