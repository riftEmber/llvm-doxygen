<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: llvm::sampleprof::DefaultFunctionPruningStrategy Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LLVM<span id="projectnumber">&#160;18.1.0rc</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacellvm.html">llvm</a></li><li class="navelem"><a class="el" href="namespacellvm_1_1sampleprof.html">sampleprof</a></li><li class="navelem"><a class="el" href="classllvm_1_1sampleprof_1_1DefaultFunctionPruningStrategy.html">DefaultFunctionPruningStrategy</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classllvm_1_1sampleprof_1_1DefaultFunctionPruningStrategy-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">llvm::sampleprof::DefaultFunctionPruningStrategy Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &quot;<a class="el" href="SampleProfWriter_8h_source.html">llvm/ProfileData/SampleProfWriter.h</a>&quot;</code></p>
<div class="dynheader">
Inheritance diagram for llvm::sampleprof::DefaultFunctionPruningStrategy:</div>
<div class="dyncontent">
<div class="center"><img src="classllvm_1_1sampleprof_1_1DefaultFunctionPruningStrategy__inherit__graph.png" border="0" usemap="#allvm_1_1sampleprof_1_1DefaultFunctionPruningStrategy_inherit__map" alt="Inheritance graph"/></div>
<map name="allvm_1_1sampleprof_1_1DefaultFunctionPruningStrategy_inherit__map" id="allvm_1_1sampleprof_1_1DefaultFunctionPruningStrategy_inherit__map">
<area shape="rect" title=" " alt="" coords="9,93,180,133"/>
<area shape="rect" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html" title="When writing a profile with size limit, user may want to use a different strategy to reduce function ..." alt="" coords="5,5,184,45"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a064d283609c9be796770a8a411b0ddb1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllvm_1_1sampleprof_1_1DefaultFunctionPruningStrategy.html#a064d283609c9be796770a8a411b0ddb1">DefaultFunctionPruningStrategy</a> (<a class="el" href="classllvm_1_1sampleprof_1_1SampleProfileMap.html">SampleProfileMap</a> &amp;<a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html#a91a31cd495fea709940239ebcbb10a4c">ProfileMap</a>, size_t <a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html#ad3809dcbffabed1814b07e6add7bac2c">OutputSizeLimit</a>)</td></tr>
<tr class="separator:a064d283609c9be796770a8a411b0ddb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8abb143feff2f640ccc483ba91019c1b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllvm_1_1sampleprof_1_1DefaultFunctionPruningStrategy.html#a8abb143feff2f640ccc483ba91019c1b">Erase</a> (size_t CurrentOutputSize) override</td></tr>
<tr class="memdesc:a8abb143feff2f640ccc483ba91019c1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">In this default implementation, functions with fewest samples are dropped first.  <br /></td></tr>
<tr class="separator:a8abb143feff2f640ccc483ba91019c1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classllvm_1_1sampleprof_1_1FunctionPruningStrategy')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html">llvm::sampleprof::FunctionPruningStrategy</a></td></tr>
<tr class="memitem:a6be976c54f94894b624c258569f67bcb inherit pub_methods_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html#a6be976c54f94894b624c258569f67bcb">FunctionPruningStrategy</a> (<a class="el" href="classllvm_1_1sampleprof_1_1SampleProfileMap.html">SampleProfileMap</a> &amp;<a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html#a91a31cd495fea709940239ebcbb10a4c">ProfileMap</a>, size_t <a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html#ad3809dcbffabed1814b07e6add7bac2c">OutputSizeLimit</a>)</td></tr>
<tr class="memdesc:a6be976c54f94894b624c258569f67bcb inherit pub_methods_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="mdescLeft">&#160;</td><td class="mdescRight"><code>ProfileMap</code> A reference to the original profile map.  <br /></td></tr>
<tr class="separator:a6be976c54f94894b624c258569f67bcb inherit pub_methods_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55afaa165cb1dd2484c5d81c28d89f9d inherit pub_methods_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html#a55afaa165cb1dd2484c5d81c28d89f9d">~FunctionPruningStrategy</a> ()=default</td></tr>
<tr class="separator:a55afaa165cb1dd2484c5d81c28d89f9d inherit pub_methods_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bb7affe9c405afd71075e2e56513db4 inherit pub_methods_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html#a3bb7affe9c405afd71075e2e56513db4">Erase</a> (size_t CurrentOutputSize)=0</td></tr>
<tr class="memdesc:a3bb7affe9c405afd71075e2e56513db4 inherit pub_methods_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classllvm_1_1sampleprof_1_1SampleProfileWriter.html#a9283506633cf544e4a6163c0133fc769" title="Write sample profiles up to given size limit, using the pruning strategy to drop some functions if ne...">SampleProfileWriter::writeWithSizeLimit()</a> calls this after every write iteration if the output size still exceeds the limit.  <br /></td></tr>
<tr class="separator:a3bb7affe9c405afd71075e2e56513db4 inherit pub_methods_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="inherited" name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_attribs_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_classllvm_1_1sampleprof_1_1FunctionPruningStrategy')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html">llvm::sampleprof::FunctionPruningStrategy</a></td></tr>
<tr class="memitem:a91a31cd495fea709940239ebcbb10a4c inherit pro_attribs_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classllvm_1_1sampleprof_1_1SampleProfileMap.html">SampleProfileMap</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html#a91a31cd495fea709940239ebcbb10a4c">ProfileMap</a></td></tr>
<tr class="separator:a91a31cd495fea709940239ebcbb10a4c inherit pro_attribs_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3809dcbffabed1814b07e6add7bac2c inherit pro_attribs_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html#ad3809dcbffabed1814b07e6add7bac2c">OutputSizeLimit</a></td></tr>
<tr class="separator:ad3809dcbffabed1814b07e6add7bac2c inherit pro_attribs_classllvm_1_1sampleprof_1_1FunctionPruningStrategy"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="SampleProfWriter_8h_source.html#l00068">68</a> of file <a class="el" href="SampleProfWriter_8h_source.html">SampleProfWriter.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a064d283609c9be796770a8a411b0ddb1" name="a064d283609c9be796770a8a411b0ddb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a064d283609c9be796770a8a411b0ddb1">&#9670;&#160;</a></span>DefaultFunctionPruningStrategy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DefaultFunctionPruningStrategy::DefaultFunctionPruningStrategy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllvm_1_1sampleprof_1_1SampleProfileMap.html">SampleProfileMap</a> &amp;&#160;</td>
          <td class="paramname"><em>ProfileMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>OutputSizeLimit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="SampleProfWriter_8cpp_source.html#l00072">72</a> of file <a class="el" href="SampleProfWriter_8cpp_source.html">SampleProfWriter.cpp</a>.</p>

<p class="reference">References <a class="el" href="SampleProfWriter_8h_source.html#l00044">llvm::sampleprof::FunctionPruningStrategy::ProfileMap</a>, and <a class="el" href="SampleProf_8cpp_source.html#l00202">llvm::sampleprof::sortFuncProfiles()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a8abb143feff2f640ccc483ba91019c1b" name="a8abb143feff2f640ccc483ba91019c1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8abb143feff2f640ccc483ba91019c1b">&#9670;&#160;</a></span>Erase()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void DefaultFunctionPruningStrategy::Erase </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>CurrentOutputSize</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>In this default implementation, functions with fewest samples are dropped first. </p>
<p>Since the exact size of the output cannot be easily calculated due to compression, we use a heuristic to remove as many functions as necessary but not too many, aiming to minimize the number of write iterations. Empirically, functions with larger total sample count contain linearly more sample entries, meaning it takes linearly more space to write them. The cumulative length is therefore quadratic if all functions are sorted by total sample count. TODO: Find better heuristic. </p>

<p>Implements <a class="el" href="classllvm_1_1sampleprof_1_1FunctionPruningStrategy.html#a3bb7affe9c405afd71075e2e56513db4">llvm::sampleprof::FunctionPruningStrategy</a>.</p>

<p class="definition">Definition at line <a class="el" href="SampleProfWriter_8cpp_source.html#l00078">78</a> of file <a class="el" href="SampleProfWriter_8cpp_source.html">SampleProfWriter.cpp</a>.</p>

<p class="reference">References <a class="el" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert()</a>, <a class="el" href="BuiltinGCs_8cpp.html#a9cb3a7d37a9414f3dc2cdca773d6dee6">D</a>, <a class="el" href="STLExtras_8h_source.html#l00329">llvm::drop_begin()</a>, <a class="el" href="BuiltinGCs_8cpp.html#ab5899ca200d34e3cc6bb09ebce5e5b3c">E</a>, <a class="el" href="SampleProf_8h_source.html#l01327">llvm::sampleprof::SampleProfileMap::erase()</a>, <a class="el" href="SampleProfWriter_8h_source.html#l00045">llvm::sampleprof::FunctionPruningStrategy::OutputSizeLimit</a>, <a class="el" href="SampleProfWriter_8h_source.html#l00044">llvm::sampleprof::FunctionPruningStrategy::ProfileMap</a>, and <a class="el" href="xxhash_8cpp_source.html#l00064">round()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/llvm/ProfileData/<a class="el" href="SampleProfWriter_8h_source.html">SampleProfWriter.h</a></li>
<li>lib/ProfileData/<a class="el" href="SampleProfWriter_8cpp_source.html">SampleProfWriter.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jul 8 2024 18:10:32 for LLVM by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
